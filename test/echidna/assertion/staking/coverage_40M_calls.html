<style> code { white-space: pre-wrap; display: block; background-color: #eee; }.executed { background-color: #afa; }.reverted { background-color: #ffa; }.unexecuted { background-color: #faa; }.neutral { background-color: #eee; }</style><b>/Users/mozzer/development/blockchain/ordinalspad/ordify-contracts/lib/openzeppelin-contracts/contracts/access/Ownable.sol</b>
<code>
  1 |     | <span class='unexecuted'>// SPDX-License-Identifier: MIT</span>
  2 |     | <span class='neutral'>// OpenZeppelin Contracts (last updated v4.9.0) (access/Ownable.sol)</span>
  3 |     | <span class='neutral'></span>
  4 |     | <span class='neutral'>pragma solidity ^0.8.0;</span>
  5 |     | <span class='neutral'></span>
  6 |     | <span class='neutral'>import &quot;../utils/Context.sol&quot;;</span>
  7 |     | <span class='neutral'></span>
  8 |     | <span class='neutral'>/**</span>
  9 |     | <span class='neutral'> * @dev Contract module which provides a basic access control mechanism, where</span>
 10 |     | <span class='neutral'> * there is an account (an owner) that can be granted exclusive access to</span>
 11 |     | <span class='neutral'> * specific functions.</span>
 12 |     | <span class='neutral'> *</span>
 13 |     | <span class='neutral'> * By default, the owner account will be the one that deploys the contract. This</span>
 14 |     | <span class='neutral'> * can later be changed with {transferOwnership}.</span>
 15 |     | <span class='neutral'> *</span>
 16 |     | <span class='neutral'> * This module is used through inheritance. It will make available the modifier</span>
 17 |     | <span class='neutral'> * `onlyOwner`, which can be applied to your functions to restrict their use to</span>
 18 |     | <span class='neutral'> * the owner.</span>
 19 |     | <span class='neutral'> */</span>
 20 |     | <span class='neutral'>abstract contract Ownable is Context {</span>
 21 |     | <span class='neutral'>    address private _owner;</span>
 22 |     | <span class='neutral'></span>
 23 |     | <span class='neutral'>    event OwnershipTransferred(address indexed previousOwner, address indexed newOwner);</span>
 24 |     | <span class='neutral'></span>
 25 |     | <span class='neutral'>    /**</span>
 26 |     | <span class='neutral'>     * @dev Initializes the contract setting the deployer as the initial owner.</span>
 27 |     | <span class='neutral'>     */</span>
 28 |     | <span class='neutral'>    constructor() {</span>
 29 |     | <span class='unexecuted'>        _transferOwnership(_msgSender());</span>
 30 |     | <span class='neutral'>    }</span>
 31 |     | <span class='neutral'></span>
 32 |     | <span class='neutral'>    /**</span>
 33 |     | <span class='neutral'>     * @dev Throws if called by any account other than the owner.</span>
 34 |     | <span class='neutral'>     */</span>
 35 |     | <span class='neutral'>    modifier onlyOwner() {</span>
 36 | *   | <span class='executed'>        _checkOwner();</span>
 37 |     | <span class='neutral'>        _;</span>
 38 |     | <span class='neutral'>    }</span>
 39 |     | <span class='neutral'></span>
 40 |     | <span class='neutral'>    /**</span>
 41 |     | <span class='neutral'>     * @dev Returns the address of the current owner.</span>
 42 |     | <span class='neutral'>     */</span>
 43 | *   | <span class='executed'>    function owner() public view virtual returns (address) {</span>
 44 | *   | <span class='executed'>        return _owner;</span>
 45 |     | <span class='neutral'>    }</span>
 46 |     | <span class='neutral'></span>
 47 |     | <span class='neutral'>    /**</span>
 48 |     | <span class='neutral'>     * @dev Throws if the sender is not the owner.</span>
 49 |     | <span class='neutral'>     */</span>
 50 | *   | <span class='executed'>    function _checkOwner() internal view virtual {</span>
 51 | *   | <span class='executed'>        require(owner() == _msgSender(), &quot;Ownable: caller is not the owner&quot;);</span>
 52 |     | <span class='neutral'>    }</span>
 53 |     | <span class='neutral'></span>
 54 |     | <span class='neutral'>    /**</span>
 55 |     | <span class='neutral'>     * @dev Leaves the contract without owner. It will not be possible to call</span>
 56 |     | <span class='neutral'>     * `onlyOwner` functions. Can only be called by the current owner.</span>
 57 |     | <span class='neutral'>     *</span>
 58 |     | <span class='neutral'>     * NOTE: Renouncing ownership will leave the contract without an owner,</span>
 59 |     | <span class='neutral'>     * thereby disabling any functionality that is only available to the owner.</span>
 60 |     | <span class='neutral'>     */</span>
 61 | *   | <span class='executed'>    function renounceOwnership() public virtual onlyOwner {</span>
 62 | *   | <span class='executed'>        _transferOwnership(address(0));</span>
 63 |     | <span class='neutral'>    }</span>
 64 |     | <span class='neutral'></span>
 65 |     | <span class='neutral'>    /**</span>
 66 |     | <span class='neutral'>     * @dev Transfers ownership of the contract to a new account (`newOwner`).</span>
 67 |     | <span class='neutral'>     * Can only be called by the current owner.</span>
 68 |     | <span class='neutral'>     */</span>
 69 |     | <span class='unexecuted'>    function transferOwnership(address newOwner) public virtual onlyOwner {</span>
 70 |     | <span class='unexecuted'>        require(newOwner != address(0), &quot;Ownable: new owner is the zero address&quot;);</span>
 71 |     | <span class='unexecuted'>        _transferOwnership(newOwner);</span>
 72 |     | <span class='neutral'>    }</span>
 73 |     | <span class='neutral'></span>
 74 |     | <span class='neutral'>    /**</span>
 75 |     | <span class='neutral'>     * @dev Transfers ownership of the contract to a new account (`newOwner`).</span>
 76 |     | <span class='neutral'>     * Internal function without access restriction.</span>
 77 |     | <span class='neutral'>     */</span>
 78 |     | <span class='unexecuted'>    function _transferOwnership(address newOwner) internal virtual {</span>
 79 |     | <span class='unexecuted'>        address oldOwner = _owner;</span>
 80 |     | <span class='unexecuted'>        _owner = newOwner;</span>
 81 |     | <span class='unexecuted'>        emit OwnershipTransferred(oldOwner, newOwner);</span>
 82 |     | <span class='neutral'>    }</span>
 83 |     | <span class='neutral'>}</span>
 84 |     | <span class='neutral'></span>

</code>
<br />

<b>/Users/mozzer/development/blockchain/ordinalspad/ordify-contracts/lib/openzeppelin-contracts/contracts/security/ReentrancyGuard.sol</b>
<code>
  1 |     | <span class='neutral'>// SPDX-License-Identifier: MIT</span>
  2 |     | <span class='neutral'>// OpenZeppelin Contracts (last updated v4.9.0) (security/ReentrancyGuard.sol)</span>
  3 |     | <span class='neutral'></span>
  4 |     | <span class='neutral'>pragma solidity ^0.8.0;</span>
  5 |     | <span class='neutral'></span>
  6 |     | <span class='neutral'>/**</span>
  7 |     | <span class='neutral'> * @dev Contract module that helps prevent reentrant calls to a function.</span>
  8 |     | <span class='neutral'> *</span>
  9 |     | <span class='neutral'> * Inheriting from `ReentrancyGuard` will make the {nonReentrant} modifier</span>
 10 |     | <span class='neutral'> * available, which can be applied to functions to make sure there are no nested</span>
 11 |     | <span class='neutral'> * (reentrant) calls to them.</span>
 12 |     | <span class='neutral'> *</span>
 13 |     | <span class='neutral'> * Note that because there is a single `nonReentrant` guard, functions marked as</span>
 14 |     | <span class='neutral'> * `nonReentrant` may not call one another. This can be worked around by making</span>
 15 |     | <span class='neutral'> * those functions `private`, and then adding `external` `nonReentrant` entry</span>
 16 |     | <span class='neutral'> * points to them.</span>
 17 |     | <span class='neutral'> *</span>
 18 |     | <span class='neutral'> * TIP: If you would like to learn more about reentrancy and alternative ways</span>
 19 |     | <span class='neutral'> * to protect against it, check out our blog post</span>
 20 |     | <span class='neutral'> * https://blog.openzeppelin.com/reentrancy-after-istanbul/[Reentrancy After Istanbul].</span>
 21 |     | <span class='neutral'> */</span>
 22 |     | <span class='neutral'>abstract contract ReentrancyGuard {</span>
 23 |     | <span class='neutral'>    // Booleans are more expensive than uint256 or any type that takes up a full</span>
 24 |     | <span class='neutral'>    // word because each write operation emits an extra SLOAD to first read the</span>
 25 |     | <span class='neutral'>    // slot&#39;s contents, replace the bits taken up by the boolean, and then write</span>
 26 |     | <span class='neutral'>    // back. This is the compiler&#39;s defense against contract upgrades and</span>
 27 |     | <span class='neutral'>    // pointer aliasing, and it cannot be disabled.</span>
 28 |     | <span class='neutral'></span>
 29 |     | <span class='neutral'>    // The values being non-zero value makes deployment a bit more expensive,</span>
 30 |     | <span class='neutral'>    // but in exchange the refund on every call to nonReentrant will be lower in</span>
 31 |     | <span class='neutral'>    // amount. Since refunds are capped to a percentage of the total</span>
 32 |     | <span class='neutral'>    // transaction&#39;s gas, it is best to keep them low in cases like this one, to</span>
 33 |     | <span class='neutral'>    // increase the likelihood of the full refund coming into effect.</span>
 34 | *   | <span class='executed'>    uint256 private constant _NOT_ENTERED = 1;</span>
 35 | *   | <span class='executed'>    uint256 private constant _ENTERED = 2;</span>
 36 |     | <span class='neutral'></span>
 37 |     | <span class='neutral'>    uint256 private _status;</span>
 38 |     | <span class='neutral'></span>
 39 |     | <span class='neutral'>    constructor() {</span>
 40 |     | <span class='unexecuted'>        _status = _NOT_ENTERED;</span>
 41 |     | <span class='neutral'>    }</span>
 42 |     | <span class='neutral'></span>
 43 |     | <span class='neutral'>    /**</span>
 44 |     | <span class='neutral'>     * @dev Prevents a contract from calling itself, directly or indirectly.</span>
 45 |     | <span class='neutral'>     * Calling a `nonReentrant` function from another `nonReentrant`</span>
 46 |     | <span class='neutral'>     * function is not supported. It is possible to prevent this from happening</span>
 47 |     | <span class='neutral'>     * by making the `nonReentrant` function external, and making it call a</span>
 48 |     | <span class='neutral'>     * `private` function that does the actual work.</span>
 49 |     | <span class='neutral'>     */</span>
 50 |     | <span class='neutral'>    modifier nonReentrant() {</span>
 51 | *   | <span class='executed'>        _nonReentrantBefore();</span>
 52 | *   | <span class='executed'>        _;</span>
 53 | *   | <span class='executed'>        _nonReentrantAfter();</span>
 54 |     | <span class='neutral'>    }</span>
 55 |     | <span class='neutral'></span>
 56 | *   | <span class='executed'>    function _nonReentrantBefore() private {</span>
 57 |     | <span class='neutral'>        // On the first call to nonReentrant, _status will be _NOT_ENTERED</span>
 58 | *   | <span class='executed'>        require(_status != _ENTERED, &quot;ReentrancyGuard: reentrant call&quot;);</span>
 59 |     | <span class='neutral'></span>
 60 |     | <span class='neutral'>        // Any calls to nonReentrant after this point will fail</span>
 61 | *   | <span class='executed'>        _status = _ENTERED;</span>
 62 |     | <span class='neutral'>    }</span>
 63 |     | <span class='neutral'></span>
 64 | *   | <span class='executed'>    function _nonReentrantAfter() private {</span>
 65 |     | <span class='neutral'>        // By storing the original value once again, a refund is triggered (see</span>
 66 |     | <span class='neutral'>        // https://eips.ethereum.org/EIPS/eip-2200)</span>
 67 | *   | <span class='executed'>        _status = _NOT_ENTERED;</span>
 68 |     | <span class='neutral'>    }</span>
 69 |     | <span class='neutral'></span>
 70 |     | <span class='neutral'>    /**</span>
 71 |     | <span class='neutral'>     * @dev Returns true if the reentrancy guard is currently set to &quot;entered&quot;, which indicates there is a</span>
 72 |     | <span class='neutral'>     * `nonReentrant` function in the call stack.</span>
 73 |     | <span class='neutral'>     */</span>
 74 |     | <span class='neutral'>    function _reentrancyGuardEntered() internal view returns (bool) {</span>
 75 |     | <span class='neutral'>        return _status == _ENTERED;</span>
 76 |     | <span class='neutral'>    }</span>
 77 |     | <span class='neutral'>}</span>
 78 |     | <span class='neutral'></span>

</code>
<br />

<b>/Users/mozzer/development/blockchain/ordinalspad/ordify-contracts/lib/openzeppelin-contracts/contracts/token/ERC20/ERC20.sol</b>
<code>
   1 |     | <span class='neutral'>// SPDX-License-Identifier: MIT</span>
   2 |     | <span class='neutral'>// OpenZeppelin Contracts (last updated v4.9.0) (token/ERC20/ERC20.sol)</span>
   3 |     | <span class='neutral'></span>
   4 |     | <span class='neutral'>pragma solidity ^0.8.0;</span>
   5 |     | <span class='neutral'></span>
   6 |     | <span class='neutral'>import &quot;./IERC20.sol&quot;;</span>
   7 |     | <span class='neutral'>import &quot;./extensions/IERC20Metadata.sol&quot;;</span>
   8 |     | <span class='neutral'>import &quot;../../utils/Context.sol&quot;;</span>
   9 |     | <span class='neutral'></span>
  10 |     | <span class='neutral'>/**</span>
  11 |     | <span class='neutral'> * @dev Implementation of the {IERC20} interface.</span>
  12 |     | <span class='neutral'> *</span>
  13 |     | <span class='neutral'> * This implementation is agnostic to the way tokens are created. This means</span>
  14 |     | <span class='neutral'> * that a supply mechanism has to be added in a derived contract using {_mint}.</span>
  15 |     | <span class='neutral'> * For a generic mechanism see {ERC20PresetMinterPauser}.</span>
  16 |     | <span class='neutral'> *</span>
  17 |     | <span class='neutral'> * TIP: For a detailed writeup see our guide</span>
  18 |     | <span class='neutral'> * https://forum.openzeppelin.com/t/how-to-implement-erc20-supply-mechanisms/226[How</span>
  19 |     | <span class='neutral'> * to implement supply mechanisms].</span>
  20 |     | <span class='neutral'> *</span>
  21 |     | <span class='neutral'> * The default value of {decimals} is 18. To change this, you should override</span>
  22 |     | <span class='neutral'> * this function so it returns a different value.</span>
  23 |     | <span class='neutral'> *</span>
  24 |     | <span class='neutral'> * We have followed general OpenZeppelin Contracts guidelines: functions revert</span>
  25 |     | <span class='neutral'> * instead returning `false` on failure. This behavior is nonetheless</span>
  26 |     | <span class='neutral'> * conventional and does not conflict with the expectations of ERC20</span>
  27 |     | <span class='neutral'> * applications.</span>
  28 |     | <span class='neutral'> *</span>
  29 |     | <span class='neutral'> * Additionally, an {Approval} event is emitted on calls to {transferFrom}.</span>
  30 |     | <span class='neutral'> * This allows applications to reconstruct the allowance for all accounts just</span>
  31 |     | <span class='neutral'> * by listening to said events. Other implementations of the EIP may not emit</span>
  32 |     | <span class='neutral'> * these events, as it isn&#39;t required by the specification.</span>
  33 |     | <span class='neutral'> *</span>
  34 |     | <span class='neutral'> * Finally, the non-standard {decreaseAllowance} and {increaseAllowance}</span>
  35 |     | <span class='neutral'> * functions have been added to mitigate the well-known issues around setting</span>
  36 |     | <span class='neutral'> * allowances. See {IERC20-approve}.</span>
  37 |     | <span class='neutral'> */</span>
  38 |     | <span class='unexecuted'>contract ERC20 is Context, IERC20, IERC20Metadata {</span>
  39 |     | <span class='neutral'>    mapping(address =&gt; uint256) private _balances;</span>
  40 |     | <span class='neutral'></span>
  41 |     | <span class='neutral'>    mapping(address =&gt; mapping(address =&gt; uint256)) private _allowances;</span>
  42 |     | <span class='neutral'></span>
  43 |     | <span class='neutral'>    uint256 private _totalSupply;</span>
  44 |     | <span class='neutral'></span>
  45 |     | <span class='neutral'>    string private _name;</span>
  46 |     | <span class='neutral'>    string private _symbol;</span>
  47 |     | <span class='neutral'></span>
  48 |     | <span class='neutral'>    /**</span>
  49 |     | <span class='neutral'>     * @dev Sets the values for {name} and {symbol}.</span>
  50 |     | <span class='neutral'>     *</span>
  51 |     | <span class='neutral'>     * All two of these values are immutable: they can only be set once during</span>
  52 |     | <span class='neutral'>     * construction.</span>
  53 |     | <span class='neutral'>     */</span>
  54 |     | <span class='unexecuted'>    constructor(string memory name_, string memory symbol_) {</span>
  55 |     | <span class='unexecuted'>        _name = name_;</span>
  56 |     | <span class='unexecuted'>        _symbol = symbol_;</span>
  57 |     | <span class='neutral'>    }</span>
  58 |     | <span class='neutral'></span>
  59 |     | <span class='neutral'>    /**</span>
  60 |     | <span class='neutral'>     * @dev Returns the name of the token.</span>
  61 |     | <span class='neutral'>     */</span>
  62 |     | <span class='unexecuted'>    function name() public view virtual override returns (string memory) {</span>
  63 |     | <span class='unexecuted'>        return _name;</span>
  64 |     | <span class='neutral'>    }</span>
  65 |     | <span class='neutral'></span>
  66 |     | <span class='neutral'>    /**</span>
  67 |     | <span class='neutral'>     * @dev Returns the symbol of the token, usually a shorter version of the</span>
  68 |     | <span class='neutral'>     * name.</span>
  69 |     | <span class='neutral'>     */</span>
  70 |     | <span class='unexecuted'>    function symbol() public view virtual override returns (string memory) {</span>
  71 |     | <span class='unexecuted'>        return _symbol;</span>
  72 |     | <span class='neutral'>    }</span>
  73 |     | <span class='neutral'></span>
  74 |     | <span class='neutral'>    /**</span>
  75 |     | <span class='neutral'>     * @dev Returns the number of decimals used to get its user representation.</span>
  76 |     | <span class='neutral'>     * For example, if `decimals` equals `2`, a balance of `505` tokens should</span>
  77 |     | <span class='neutral'>     * be displayed to a user as `5.05` (`505 / 10 ** 2`).</span>
  78 |     | <span class='neutral'>     *</span>
  79 |     | <span class='neutral'>     * Tokens usually opt for a value of 18, imitating the relationship between</span>
  80 |     | <span class='neutral'>     * Ether and Wei. This is the default value returned by this function, unless</span>
  81 |     | <span class='neutral'>     * it&#39;s overridden.</span>
  82 |     | <span class='neutral'>     *</span>
  83 |     | <span class='neutral'>     * NOTE: This information is only used for _display_ purposes: it in</span>
  84 |     | <span class='neutral'>     * no way affects any of the arithmetic of the contract, including</span>
  85 |     | <span class='neutral'>     * {IERC20-balanceOf} and {IERC20-transfer}.</span>
  86 |     | <span class='neutral'>     */</span>
  87 |     | <span class='unexecuted'>    function decimals() public view virtual override returns (uint8) {</span>
  88 |     | <span class='unexecuted'>        return 18;</span>
  89 |     | <span class='neutral'>    }</span>
  90 |     | <span class='neutral'></span>
  91 |     | <span class='neutral'>    /**</span>
  92 |     | <span class='neutral'>     * @dev See {IERC20-totalSupply}.</span>
  93 |     | <span class='neutral'>     */</span>
  94 |     | <span class='unexecuted'>    function totalSupply() public view virtual override returns (uint256) {</span>
  95 |     | <span class='unexecuted'>        return _totalSupply;</span>
  96 |     | <span class='neutral'>    }</span>
  97 |     | <span class='neutral'></span>
  98 |     | <span class='neutral'>    /**</span>
  99 |     | <span class='neutral'>     * @dev See {IERC20-balanceOf}.</span>
 100 |     | <span class='neutral'>     */</span>
 101 |     | <span class='unexecuted'>    function balanceOf(address account) public view virtual override returns (uint256) {</span>
 102 |     | <span class='unexecuted'>        return _balances[account];</span>
 103 |     | <span class='neutral'>    }</span>
 104 |     | <span class='neutral'></span>
 105 |     | <span class='neutral'>    /**</span>
 106 |     | <span class='neutral'>     * @dev See {IERC20-transfer}.</span>
 107 |     | <span class='neutral'>     *</span>
 108 |     | <span class='neutral'>     * Requirements:</span>
 109 |     | <span class='neutral'>     *</span>
 110 |     | <span class='neutral'>     * - `to` cannot be the zero address.</span>
 111 |     | <span class='neutral'>     * - the caller must have a balance of at least `amount`.</span>
 112 |     | <span class='neutral'>     */</span>
 113 |     | <span class='unexecuted'>    function transfer(address to, uint256 amount) public virtual override returns (bool) {</span>
 114 |     | <span class='neutral'>        address owner = _msgSender();</span>
 115 |     | <span class='unexecuted'>        _transfer(owner, to, amount);</span>
 116 |     | <span class='neutral'>        return true;</span>
 117 |     | <span class='neutral'>    }</span>
 118 |     | <span class='neutral'></span>
 119 |     | <span class='neutral'>    /**</span>
 120 |     | <span class='neutral'>     * @dev See {IERC20-allowance}.</span>
 121 |     | <span class='neutral'>     */</span>
 122 |     | <span class='unexecuted'>    function allowance(address owner, address spender) public view virtual override returns (uint256) {</span>
 123 |     | <span class='unexecuted'>        return _allowances[owner][spender];</span>
 124 |     | <span class='neutral'>    }</span>
 125 |     | <span class='neutral'></span>
 126 |     | <span class='neutral'>    /**</span>
 127 |     | <span class='neutral'>     * @dev See {IERC20-approve}.</span>
 128 |     | <span class='neutral'>     *</span>
 129 |     | <span class='neutral'>     * NOTE: If `amount` is the maximum `uint256`, the allowance is not updated on</span>
 130 |     | <span class='neutral'>     * `transferFrom`. This is semantically equivalent to an infinite approval.</span>
 131 |     | <span class='neutral'>     *</span>
 132 |     | <span class='neutral'>     * Requirements:</span>
 133 |     | <span class='neutral'>     *</span>
 134 |     | <span class='neutral'>     * - `spender` cannot be the zero address.</span>
 135 |     | <span class='neutral'>     */</span>
 136 |     | <span class='unexecuted'>    function approve(address spender, uint256 amount) public virtual override returns (bool) {</span>
 137 |     | <span class='neutral'>        address owner = _msgSender();</span>
 138 |     | <span class='unexecuted'>        _approve(owner, spender, amount);</span>
 139 |     | <span class='unexecuted'>        return true;</span>
 140 |     | <span class='neutral'>    }</span>
 141 |     | <span class='neutral'></span>
 142 |     | <span class='neutral'>    /**</span>
 143 |     | <span class='neutral'>     * @dev See {IERC20-transferFrom}.</span>
 144 |     | <span class='neutral'>     *</span>
 145 |     | <span class='neutral'>     * Emits an {Approval} event indicating the updated allowance. This is not</span>
 146 |     | <span class='neutral'>     * required by the EIP. See the note at the beginning of {ERC20}.</span>
 147 |     | <span class='neutral'>     *</span>
 148 |     | <span class='neutral'>     * NOTE: Does not update the allowance if the current allowance</span>
 149 |     | <span class='neutral'>     * is the maximum `uint256`.</span>
 150 |     | <span class='neutral'>     *</span>
 151 |     | <span class='neutral'>     * Requirements:</span>
 152 |     | <span class='neutral'>     *</span>
 153 |     | <span class='neutral'>     * - `from` and `to` cannot be the zero address.</span>
 154 |     | <span class='neutral'>     * - `from` must have a balance of at least `amount`.</span>
 155 |     | <span class='neutral'>     * - the caller must have allowance for ``from``&#39;s tokens of at least</span>
 156 |     | <span class='neutral'>     * `amount`.</span>
 157 |     | <span class='neutral'>     */</span>
 158 |     | <span class='unexecuted'>    function transferFrom(address from, address to, uint256 amount) public virtual override returns (bool) {</span>
 159 |     | <span class='neutral'>        address spender = _msgSender();</span>
 160 |     | <span class='unexecuted'>        _spendAllowance(from, spender, amount);</span>
 161 |     | <span class='unexecuted'>        _transfer(from, to, amount);</span>
 162 |     | <span class='unexecuted'>        return true;</span>
 163 |     | <span class='neutral'>    }</span>
 164 |     | <span class='neutral'></span>
 165 |     | <span class='neutral'>    /**</span>
 166 |     | <span class='neutral'>     * @dev Atomically increases the allowance granted to `spender` by the caller.</span>
 167 |     | <span class='neutral'>     *</span>
 168 |     | <span class='neutral'>     * This is an alternative to {approve} that can be used as a mitigation for</span>
 169 |     | <span class='neutral'>     * problems described in {IERC20-approve}.</span>
 170 |     | <span class='neutral'>     *</span>
 171 |     | <span class='neutral'>     * Emits an {Approval} event indicating the updated allowance.</span>
 172 |     | <span class='neutral'>     *</span>
 173 |     | <span class='neutral'>     * Requirements:</span>
 174 |     | <span class='neutral'>     *</span>
 175 |     | <span class='neutral'>     * - `spender` cannot be the zero address.</span>
 176 |     | <span class='neutral'>     */</span>
 177 |     | <span class='unexecuted'>    function increaseAllowance(address spender, uint256 addedValue) public virtual returns (bool) {</span>
 178 |     | <span class='neutral'>        address owner = _msgSender();</span>
 179 |     | <span class='unexecuted'>        _approve(owner, spender, allowance(owner, spender) + addedValue);</span>
 180 |     | <span class='neutral'>        return true;</span>
 181 |     | <span class='neutral'>    }</span>
 182 |     | <span class='neutral'></span>
 183 |     | <span class='neutral'>    /**</span>
 184 |     | <span class='neutral'>     * @dev Atomically decreases the allowance granted to `spender` by the caller.</span>
 185 |     | <span class='neutral'>     *</span>
 186 |     | <span class='neutral'>     * This is an alternative to {approve} that can be used as a mitigation for</span>
 187 |     | <span class='neutral'>     * problems described in {IERC20-approve}.</span>
 188 |     | <span class='neutral'>     *</span>
 189 |     | <span class='neutral'>     * Emits an {Approval} event indicating the updated allowance.</span>
 190 |     | <span class='neutral'>     *</span>
 191 |     | <span class='neutral'>     * Requirements:</span>
 192 |     | <span class='neutral'>     *</span>
 193 |     | <span class='neutral'>     * - `spender` cannot be the zero address.</span>
 194 |     | <span class='neutral'>     * - `spender` must have allowance for the caller of at least</span>
 195 |     | <span class='neutral'>     * `subtractedValue`.</span>
 196 |     | <span class='neutral'>     */</span>
 197 |     | <span class='unexecuted'>    function decreaseAllowance(address spender, uint256 subtractedValue) public virtual returns (bool) {</span>
 198 |     | <span class='neutral'>        address owner = _msgSender();</span>
 199 |     | <span class='unexecuted'>        uint256 currentAllowance = allowance(owner, spender);</span>
 200 |     | <span class='unexecuted'>        require(currentAllowance &gt;= subtractedValue, &quot;ERC20: decreased allowance below zero&quot;);</span>
 201 |     | <span class='neutral'>        unchecked {</span>
 202 |     | <span class='unexecuted'>            _approve(owner, spender, currentAllowance - subtractedValue);</span>
 203 |     | <span class='neutral'>        }</span>
 204 |     | <span class='neutral'></span>
 205 |     | <span class='neutral'>        return true;</span>
 206 |     | <span class='neutral'>    }</span>
 207 |     | <span class='neutral'></span>
 208 |     | <span class='neutral'>    /**</span>
 209 |     | <span class='neutral'>     * @dev Moves `amount` of tokens from `from` to `to`.</span>
 210 |     | <span class='neutral'>     *</span>
 211 |     | <span class='neutral'>     * This internal function is equivalent to {transfer}, and can be used to</span>
 212 |     | <span class='neutral'>     * e.g. implement automatic token fees, slashing mechanisms, etc.</span>
 213 |     | <span class='neutral'>     *</span>
 214 |     | <span class='neutral'>     * Emits a {Transfer} event.</span>
 215 |     | <span class='neutral'>     *</span>
 216 |     | <span class='neutral'>     * Requirements:</span>
 217 |     | <span class='neutral'>     *</span>
 218 |     | <span class='neutral'>     * - `from` cannot be the zero address.</span>
 219 |     | <span class='neutral'>     * - `to` cannot be the zero address.</span>
 220 |     | <span class='neutral'>     * - `from` must have a balance of at least `amount`.</span>
 221 |     | <span class='neutral'>     */</span>
 222 |     | <span class='unexecuted'>    function _transfer(address from, address to, uint256 amount) internal virtual {</span>
 223 |     | <span class='unexecuted'>        require(from != address(0), &quot;ERC20: transfer from the zero address&quot;);</span>
 224 |     | <span class='unexecuted'>        require(to != address(0), &quot;ERC20: transfer to the zero address&quot;);</span>
 225 |     | <span class='neutral'></span>
 226 |     | <span class='neutral'>        _beforeTokenTransfer(from, to, amount);</span>
 227 |     | <span class='neutral'></span>
 228 |     | <span class='unexecuted'>        uint256 fromBalance = _balances[from];</span>
 229 |     | <span class='unexecuted'>        require(fromBalance &gt;= amount, &quot;ERC20: transfer amount exceeds balance&quot;);</span>
 230 |     | <span class='neutral'>        unchecked {</span>
 231 |     | <span class='unexecuted'>            _balances[from] = fromBalance - amount;</span>
 232 |     | <span class='neutral'>            // Overflow not possible: the sum of all balances is capped by totalSupply, and the sum is preserved by</span>
 233 |     | <span class='neutral'>            // decrementing then incrementing.</span>
 234 |     | <span class='unexecuted'>            _balances[to] += amount;</span>
 235 |     | <span class='neutral'>        }</span>
 236 |     | <span class='neutral'></span>
 237 |     | <span class='unexecuted'>        emit Transfer(from, to, amount);</span>
 238 |     | <span class='neutral'></span>
 239 |     | <span class='unexecuted'>        _afterTokenTransfer(from, to, amount);</span>
 240 |     | <span class='neutral'>    }</span>
 241 |     | <span class='neutral'></span>
 242 |     | <span class='neutral'>    /** @dev Creates `amount` tokens and assigns them to `account`, increasing</span>
 243 |     | <span class='neutral'>     * the total supply.</span>
 244 |     | <span class='neutral'>     *</span>
 245 |     | <span class='neutral'>     * Emits a {Transfer} event with `from` set to the zero address.</span>
 246 |     | <span class='neutral'>     *</span>
 247 |     | <span class='neutral'>     * Requirements:</span>
 248 |     | <span class='neutral'>     *</span>
 249 |     | <span class='neutral'>     * - `account` cannot be the zero address.</span>
 250 |     | <span class='neutral'>     */</span>
 251 |     | <span class='neutral'>    function _mint(address account, uint256 amount) internal virtual {</span>
 252 |     | <span class='neutral'>        require(account != address(0), &quot;ERC20: mint to the zero address&quot;);</span>
 253 |     | <span class='neutral'></span>
 254 |     | <span class='neutral'>        _beforeTokenTransfer(address(0), account, amount);</span>
 255 |     | <span class='neutral'></span>
 256 |     | <span class='neutral'>        _totalSupply += amount;</span>
 257 |     | <span class='neutral'>        unchecked {</span>
 258 |     | <span class='neutral'>            // Overflow not possible: balance + amount is at most totalSupply + amount, which is checked above.</span>
 259 |     | <span class='neutral'>            _balances[account] += amount;</span>
 260 |     | <span class='neutral'>        }</span>
 261 |     | <span class='neutral'>        emit Transfer(address(0), account, amount);</span>
 262 |     | <span class='neutral'></span>
 263 |     | <span class='neutral'>        _afterTokenTransfer(address(0), account, amount);</span>
 264 |     | <span class='neutral'>    }</span>
 265 |     | <span class='neutral'></span>
 266 |     | <span class='neutral'>    /**</span>
 267 |     | <span class='neutral'>     * @dev Destroys `amount` tokens from `account`, reducing the</span>
 268 |     | <span class='neutral'>     * total supply.</span>
 269 |     | <span class='neutral'>     *</span>
 270 |     | <span class='neutral'>     * Emits a {Transfer} event with `to` set to the zero address.</span>
 271 |     | <span class='neutral'>     *</span>
 272 |     | <span class='neutral'>     * Requirements:</span>
 273 |     | <span class='neutral'>     *</span>
 274 |     | <span class='neutral'>     * - `account` cannot be the zero address.</span>
 275 |     | <span class='neutral'>     * - `account` must have at least `amount` tokens.</span>
 276 |     | <span class='neutral'>     */</span>
 277 |     | <span class='neutral'>    function _burn(address account, uint256 amount) internal virtual {</span>
 278 |     | <span class='neutral'>        require(account != address(0), &quot;ERC20: burn from the zero address&quot;);</span>
 279 |     | <span class='neutral'></span>
 280 |     | <span class='neutral'>        _beforeTokenTransfer(account, address(0), amount);</span>
 281 |     | <span class='neutral'></span>
 282 |     | <span class='neutral'>        uint256 accountBalance = _balances[account];</span>
 283 |     | <span class='neutral'>        require(accountBalance &gt;= amount, &quot;ERC20: burn amount exceeds balance&quot;);</span>
 284 |     | <span class='neutral'>        unchecked {</span>
 285 |     | <span class='neutral'>            _balances[account] = accountBalance - amount;</span>
 286 |     | <span class='neutral'>            // Overflow not possible: amount &lt;= accountBalance &lt;= totalSupply.</span>
 287 |     | <span class='neutral'>            _totalSupply -= amount;</span>
 288 |     | <span class='neutral'>        }</span>
 289 |     | <span class='neutral'></span>
 290 |     | <span class='neutral'>        emit Transfer(account, address(0), amount);</span>
 291 |     | <span class='neutral'></span>
 292 |     | <span class='neutral'>        _afterTokenTransfer(account, address(0), amount);</span>
 293 |     | <span class='neutral'>    }</span>
 294 |     | <span class='neutral'></span>
 295 |     | <span class='neutral'>    /**</span>
 296 |     | <span class='neutral'>     * @dev Sets `amount` as the allowance of `spender` over the `owner` s tokens.</span>
 297 |     | <span class='neutral'>     *</span>
 298 |     | <span class='neutral'>     * This internal function is equivalent to `approve`, and can be used to</span>
 299 |     | <span class='neutral'>     * e.g. set automatic allowances for certain subsystems, etc.</span>
 300 |     | <span class='neutral'>     *</span>
 301 |     | <span class='neutral'>     * Emits an {Approval} event.</span>
 302 |     | <span class='neutral'>     *</span>
 303 |     | <span class='neutral'>     * Requirements:</span>
 304 |     | <span class='neutral'>     *</span>
 305 |     | <span class='neutral'>     * - `owner` cannot be the zero address.</span>
 306 |     | <span class='neutral'>     * - `spender` cannot be the zero address.</span>
 307 |     | <span class='neutral'>     */</span>
 308 |     | <span class='unexecuted'>    function _approve(address owner, address spender, uint256 amount) internal virtual {</span>
 309 |     | <span class='unexecuted'>        require(owner != address(0), &quot;ERC20: approve from the zero address&quot;);</span>
 310 |     | <span class='unexecuted'>        require(spender != address(0), &quot;ERC20: approve to the zero address&quot;);</span>
 311 |     | <span class='neutral'></span>
 312 |     | <span class='unexecuted'>        _allowances[owner][spender] = amount;</span>
 313 |     | <span class='unexecuted'>        emit Approval(owner, spender, amount);</span>
 314 |     | <span class='neutral'>    }</span>
 315 |     | <span class='neutral'></span>
 316 |     | <span class='neutral'>    /**</span>
 317 |     | <span class='neutral'>     * @dev Updates `owner` s allowance for `spender` based on spent `amount`.</span>
 318 |     | <span class='neutral'>     *</span>
 319 |     | <span class='neutral'>     * Does not update the allowance amount in case of infinite allowance.</span>
 320 |     | <span class='neutral'>     * Revert if not enough allowance is available.</span>
 321 |     | <span class='neutral'>     *</span>
 322 |     | <span class='neutral'>     * Might emit an {Approval} event.</span>
 323 |     | <span class='neutral'>     */</span>
 324 |     | <span class='unexecuted'>    function _spendAllowance(address owner, address spender, uint256 amount) internal virtual {</span>
 325 |     | <span class='unexecuted'>        uint256 currentAllowance = allowance(owner, spender);</span>
 326 |     | <span class='unexecuted'>        if (currentAllowance != type(uint256).max) {</span>
 327 |     | <span class='unexecuted'>            require(currentAllowance &gt;= amount, &quot;ERC20: insufficient allowance&quot;);</span>
 328 |     | <span class='neutral'>            unchecked {</span>
 329 |     | <span class='unexecuted'>                _approve(owner, spender, currentAllowance - amount);</span>
 330 |     | <span class='neutral'>            }</span>
 331 |     | <span class='neutral'>        }</span>
 332 |     | <span class='neutral'>    }</span>
 333 |     | <span class='neutral'></span>
 334 |     | <span class='neutral'>    /**</span>
 335 |     | <span class='neutral'>     * @dev Hook that is called before any transfer of tokens. This includes</span>
 336 |     | <span class='neutral'>     * minting and burning.</span>
 337 |     | <span class='neutral'>     *</span>
 338 |     | <span class='neutral'>     * Calling conditions:</span>
 339 |     | <span class='neutral'>     *</span>
 340 |     | <span class='neutral'>     * - when `from` and `to` are both non-zero, `amount` of ``from``&#39;s tokens</span>
 341 |     | <span class='neutral'>     * will be transferred to `to`.</span>
 342 |     | <span class='neutral'>     * - when `from` is zero, `amount` tokens will be minted for `to`.</span>
 343 |     | <span class='neutral'>     * - when `to` is zero, `amount` of ``from``&#39;s tokens will be burned.</span>
 344 |     | <span class='neutral'>     * - `from` and `to` are never both zero.</span>
 345 |     | <span class='neutral'>     *</span>
 346 |     | <span class='neutral'>     * To learn more about hooks, head to xref:ROOT:extending-contracts.adoc#using-hooks[Using Hooks].</span>
 347 |     | <span class='neutral'>     */</span>
 348 |     | <span class='unexecuted'>    function _beforeTokenTransfer(address from, address to, uint256 amount) internal virtual {}</span>
 349 |     | <span class='neutral'></span>
 350 |     | <span class='neutral'>    /**</span>
 351 |     | <span class='neutral'>     * @dev Hook that is called after any transfer of tokens. This includes</span>
 352 |     | <span class='neutral'>     * minting and burning.</span>
 353 |     | <span class='neutral'>     *</span>
 354 |     | <span class='neutral'>     * Calling conditions:</span>
 355 |     | <span class='neutral'>     *</span>
 356 |     | <span class='neutral'>     * - when `from` and `to` are both non-zero, `amount` of ``from``&#39;s tokens</span>
 357 |     | <span class='neutral'>     * has been transferred to `to`.</span>
 358 |     | <span class='neutral'>     * - when `from` is zero, `amount` tokens have been minted for `to`.</span>
 359 |     | <span class='neutral'>     * - when `to` is zero, `amount` of ``from``&#39;s tokens have been burned.</span>
 360 |     | <span class='neutral'>     * - `from` and `to` are never both zero.</span>
 361 |     | <span class='neutral'>     *</span>
 362 |     | <span class='neutral'>     * To learn more about hooks, head to xref:ROOT:extending-contracts.adoc#using-hooks[Using Hooks].</span>
 363 |     | <span class='neutral'>     */</span>
 364 |     | <span class='neutral'>    function _afterTokenTransfer(address from, address to, uint256 amount) internal virtual {}</span>
 365 |     | <span class='neutral'>}</span>
 366 |     | <span class='neutral'></span>

</code>
<br />

<b>/Users/mozzer/development/blockchain/ordinalspad/ordify-contracts/lib/openzeppelin-contracts/contracts/token/ERC20/IERC20.sol</b>
<code>
  1 |     | <span class='neutral'>// SPDX-License-Identifier: MIT</span>
  2 |     | <span class='neutral'>// OpenZeppelin Contracts (last updated v4.9.0) (token/ERC20/IERC20.sol)</span>
  3 |     | <span class='neutral'></span>
  4 |     | <span class='neutral'>pragma solidity ^0.8.0;</span>
  5 |     | <span class='neutral'></span>
  6 |     | <span class='neutral'>/**</span>
  7 |     | <span class='neutral'> * @dev Interface of the ERC20 standard as defined in the EIP.</span>
  8 |     | <span class='neutral'> */</span>
  9 |     | <span class='neutral'>interface IERC20 {</span>
 10 |     | <span class='neutral'>    /**</span>
 11 |     | <span class='neutral'>     * @dev Emitted when `value` tokens are moved from one account (`from`) to</span>
 12 |     | <span class='neutral'>     * another (`to`).</span>
 13 |     | <span class='neutral'>     *</span>
 14 |     | <span class='neutral'>     * Note that `value` may be zero.</span>
 15 |     | <span class='neutral'>     */</span>
 16 |     | <span class='neutral'>    event Transfer(address indexed from, address indexed to, uint256 value);</span>
 17 |     | <span class='neutral'></span>
 18 |     | <span class='neutral'>    /**</span>
 19 |     | <span class='neutral'>     * @dev Emitted when the allowance of a `spender` for an `owner` is set by</span>
 20 |     | <span class='neutral'>     * a call to {approve}. `value` is the new allowance.</span>
 21 |     | <span class='neutral'>     */</span>
 22 |     | <span class='neutral'>    event Approval(address indexed owner, address indexed spender, uint256 value);</span>
 23 |     | <span class='neutral'></span>
 24 |     | <span class='neutral'>    /**</span>
 25 |     | <span class='neutral'>     * @dev Returns the amount of tokens in existence.</span>
 26 |     | <span class='neutral'>     */</span>
 27 |     | <span class='neutral'>    function totalSupply() external view returns (uint256);</span>
 28 |     | <span class='neutral'></span>
 29 |     | <span class='neutral'>    /**</span>
 30 |     | <span class='neutral'>     * @dev Returns the amount of tokens owned by `account`.</span>
 31 |     | <span class='neutral'>     */</span>
 32 |     | <span class='neutral'>    function balanceOf(address account) external view returns (uint256);</span>
 33 |     | <span class='neutral'></span>
 34 |     | <span class='neutral'>    /**</span>
 35 |     | <span class='neutral'>     * @dev Moves `amount` tokens from the caller&#39;s account to `to`.</span>
 36 |     | <span class='neutral'>     *</span>
 37 |     | <span class='neutral'>     * Returns a boolean value indicating whether the operation succeeded.</span>
 38 |     | <span class='neutral'>     *</span>
 39 |     | <span class='neutral'>     * Emits a {Transfer} event.</span>
 40 |     | <span class='neutral'>     */</span>
 41 |     | <span class='neutral'>    function transfer(address to, uint256 amount) external returns (bool);</span>
 42 |     | <span class='neutral'></span>
 43 |     | <span class='neutral'>    /**</span>
 44 |     | <span class='neutral'>     * @dev Returns the remaining number of tokens that `spender` will be</span>
 45 |     | <span class='neutral'>     * allowed to spend on behalf of `owner` through {transferFrom}. This is</span>
 46 |     | <span class='neutral'>     * zero by default.</span>
 47 |     | <span class='neutral'>     *</span>
 48 |     | <span class='neutral'>     * This value changes when {approve} or {transferFrom} are called.</span>
 49 |     | <span class='neutral'>     */</span>
 50 |     | <span class='neutral'>    function allowance(address owner, address spender) external view returns (uint256);</span>
 51 |     | <span class='neutral'></span>
 52 |     | <span class='neutral'>    /**</span>
 53 |     | <span class='neutral'>     * @dev Sets `amount` as the allowance of `spender` over the caller&#39;s tokens.</span>
 54 |     | <span class='neutral'>     *</span>
 55 |     | <span class='neutral'>     * Returns a boolean value indicating whether the operation succeeded.</span>
 56 |     | <span class='neutral'>     *</span>
 57 |     | <span class='neutral'>     * IMPORTANT: Beware that changing an allowance with this method brings the risk</span>
 58 |     | <span class='neutral'>     * that someone may use both the old and the new allowance by unfortunate</span>
 59 |     | <span class='neutral'>     * transaction ordering. One possible solution to mitigate this race</span>
 60 |     | <span class='neutral'>     * condition is to first reduce the spender&#39;s allowance to 0 and set the</span>
 61 |     | <span class='neutral'>     * desired value afterwards:</span>
 62 |     | <span class='neutral'>     * https://github.com/ethereum/EIPs/issues/20#issuecomment-263524729</span>
 63 |     | <span class='neutral'>     *</span>
 64 |     | <span class='neutral'>     * Emits an {Approval} event.</span>
 65 |     | <span class='neutral'>     */</span>
 66 |     | <span class='neutral'>    function approve(address spender, uint256 amount) external returns (bool);</span>
 67 |     | <span class='neutral'></span>
 68 |     | <span class='neutral'>    /**</span>
 69 |     | <span class='neutral'>     * @dev Moves `amount` tokens from `from` to `to` using the</span>
 70 |     | <span class='neutral'>     * allowance mechanism. `amount` is then deducted from the caller&#39;s</span>
 71 |     | <span class='neutral'>     * allowance.</span>
 72 |     | <span class='neutral'>     *</span>
 73 |     | <span class='neutral'>     * Returns a boolean value indicating whether the operation succeeded.</span>
 74 |     | <span class='neutral'>     *</span>
 75 |     | <span class='neutral'>     * Emits a {Transfer} event.</span>
 76 |     | <span class='neutral'>     */</span>
 77 |     | <span class='neutral'>    function transferFrom(address from, address to, uint256 amount) external returns (bool);</span>
 78 |     | <span class='neutral'>}</span>
 79 |     | <span class='neutral'></span>

</code>
<br />

<b>/Users/mozzer/development/blockchain/ordinalspad/ordify-contracts/lib/openzeppelin-contracts/contracts/token/ERC20/extensions/IERC20Metadata.sol</b>
<code>
  1 |     | <span class='neutral'>// SPDX-License-Identifier: MIT</span>
  2 |     | <span class='neutral'>// OpenZeppelin Contracts v4.4.1 (token/ERC20/extensions/IERC20Metadata.sol)</span>
  3 |     | <span class='neutral'></span>
  4 |     | <span class='neutral'>pragma solidity ^0.8.0;</span>
  5 |     | <span class='neutral'></span>
  6 |     | <span class='neutral'>import &quot;../IERC20.sol&quot;;</span>
  7 |     | <span class='neutral'></span>
  8 |     | <span class='neutral'>/**</span>
  9 |     | <span class='neutral'> * @dev Interface for the optional metadata functions from the ERC20 standard.</span>
 10 |     | <span class='neutral'> *</span>
 11 |     | <span class='neutral'> * _Available since v4.1._</span>
 12 |     | <span class='neutral'> */</span>
 13 |     | <span class='neutral'>interface IERC20Metadata is IERC20 {</span>
 14 |     | <span class='neutral'>    /**</span>
 15 |     | <span class='neutral'>     * @dev Returns the name of the token.</span>
 16 |     | <span class='neutral'>     */</span>
 17 |     | <span class='neutral'>    function name() external view returns (string memory);</span>
 18 |     | <span class='neutral'></span>
 19 |     | <span class='neutral'>    /**</span>
 20 |     | <span class='neutral'>     * @dev Returns the symbol of the token.</span>
 21 |     | <span class='neutral'>     */</span>
 22 |     | <span class='neutral'>    function symbol() external view returns (string memory);</span>
 23 |     | <span class='neutral'></span>
 24 |     | <span class='neutral'>    /**</span>
 25 |     | <span class='neutral'>     * @dev Returns the decimals places of the token.</span>
 26 |     | <span class='neutral'>     */</span>
 27 |     | <span class='neutral'>    function decimals() external view returns (uint8);</span>
 28 |     | <span class='neutral'>}</span>
 29 |     | <span class='neutral'></span>

</code>
<br />

<b>/Users/mozzer/development/blockchain/ordinalspad/ordify-contracts/lib/openzeppelin-contracts/contracts/token/ERC20/extensions/IERC20Permit.sol</b>
<code>
  1 |     | <span class='neutral'>// SPDX-License-Identifier: MIT</span>
  2 |     | <span class='neutral'>// OpenZeppelin Contracts (last updated v4.9.0) (token/ERC20/extensions/IERC20Permit.sol)</span>
  3 |     | <span class='neutral'></span>
  4 |     | <span class='neutral'>pragma solidity ^0.8.0;</span>
  5 |     | <span class='neutral'></span>
  6 |     | <span class='neutral'>/**</span>
  7 |     | <span class='neutral'> * @dev Interface of the ERC20 Permit extension allowing approvals to be made via signatures, as defined in</span>
  8 |     | <span class='neutral'> * https://eips.ethereum.org/EIPS/eip-2612[EIP-2612].</span>
  9 |     | <span class='neutral'> *</span>
 10 |     | <span class='neutral'> * Adds the {permit} method, which can be used to change an account&#39;s ERC20 allowance (see {IERC20-allowance}) by</span>
 11 |     | <span class='neutral'> * presenting a message signed by the account. By not relying on {IERC20-approve}, the token holder account doesn&#39;t</span>
 12 |     | <span class='neutral'> * need to send a transaction, and thus is not required to hold Ether at all.</span>
 13 |     | <span class='neutral'> */</span>
 14 |     | <span class='neutral'>interface IERC20Permit {</span>
 15 |     | <span class='neutral'>    /**</span>
 16 |     | <span class='neutral'>     * @dev Sets `value` as the allowance of `spender` over ``owner``&#39;s tokens,</span>
 17 |     | <span class='neutral'>     * given ``owner``&#39;s signed approval.</span>
 18 |     | <span class='neutral'>     *</span>
 19 |     | <span class='neutral'>     * IMPORTANT: The same issues {IERC20-approve} has related to transaction</span>
 20 |     | <span class='neutral'>     * ordering also apply here.</span>
 21 |     | <span class='neutral'>     *</span>
 22 |     | <span class='neutral'>     * Emits an {Approval} event.</span>
 23 |     | <span class='neutral'>     *</span>
 24 |     | <span class='neutral'>     * Requirements:</span>
 25 |     | <span class='neutral'>     *</span>
 26 |     | <span class='neutral'>     * - `spender` cannot be the zero address.</span>
 27 |     | <span class='neutral'>     * - `deadline` must be a timestamp in the future.</span>
 28 |     | <span class='neutral'>     * - `v`, `r` and `s` must be a valid `secp256k1` signature from `owner`</span>
 29 |     | <span class='neutral'>     * over the EIP712-formatted function arguments.</span>
 30 |     | <span class='neutral'>     * - the signature must use ``owner``&#39;s current nonce (see {nonces}).</span>
 31 |     | <span class='neutral'>     *</span>
 32 |     | <span class='neutral'>     * For more information on the signature format, see the</span>
 33 |     | <span class='neutral'>     * https://eips.ethereum.org/EIPS/eip-2612#specification[relevant EIP</span>
 34 |     | <span class='neutral'>     * section].</span>
 35 |     | <span class='neutral'>     */</span>
 36 |     | <span class='neutral'>    function permit(</span>
 37 |     | <span class='neutral'>        address owner,</span>
 38 |     | <span class='neutral'>        address spender,</span>
 39 |     | <span class='neutral'>        uint256 value,</span>
 40 |     | <span class='neutral'>        uint256 deadline,</span>
 41 |     | <span class='neutral'>        uint8 v,</span>
 42 |     | <span class='neutral'>        bytes32 r,</span>
 43 |     | <span class='neutral'>        bytes32 s</span>
 44 |     | <span class='neutral'>    ) external;</span>
 45 |     | <span class='neutral'></span>
 46 |     | <span class='neutral'>    /**</span>
 47 |     | <span class='neutral'>     * @dev Returns the current nonce for `owner`. This value must be</span>
 48 |     | <span class='neutral'>     * included whenever a signature is generated for {permit}.</span>
 49 |     | <span class='neutral'>     *</span>
 50 |     | <span class='neutral'>     * Every successful call to {permit} increases ``owner``&#39;s nonce by one. This</span>
 51 |     | <span class='neutral'>     * prevents a signature from being used multiple times.</span>
 52 |     | <span class='neutral'>     */</span>
 53 |     | <span class='neutral'>    function nonces(address owner) external view returns (uint256);</span>
 54 |     | <span class='neutral'></span>
 55 |     | <span class='neutral'>    /**</span>
 56 |     | <span class='neutral'>     * @dev Returns the domain separator used in the encoding of the signature for {permit}, as defined by {EIP712}.</span>
 57 |     | <span class='neutral'>     */</span>
 58 |     | <span class='neutral'>    // solhint-disable-next-line func-name-mixedcase</span>
 59 |     | <span class='neutral'>    function DOMAIN_SEPARATOR() external view returns (bytes32);</span>
 60 |     | <span class='neutral'>}</span>
 61 |     | <span class='neutral'></span>

</code>
<br />

<b>/Users/mozzer/development/blockchain/ordinalspad/ordify-contracts/lib/openzeppelin-contracts/contracts/token/ERC20/utils/SafeERC20.sol</b>
<code>
   1 |     | <span class='neutral'>// SPDX-License-Identifier: MIT</span>
   2 |     | <span class='neutral'>// OpenZeppelin Contracts (last updated v4.9.3) (token/ERC20/utils/SafeERC20.sol)</span>
   3 |     | <span class='neutral'></span>
   4 |     | <span class='neutral'>pragma solidity ^0.8.0;</span>
   5 |     | <span class='neutral'></span>
   6 |     | <span class='neutral'>import &quot;../IERC20.sol&quot;;</span>
   7 |     | <span class='neutral'>import &quot;../extensions/IERC20Permit.sol&quot;;</span>
   8 |     | <span class='neutral'>import &quot;../../../utils/Address.sol&quot;;</span>
   9 |     | <span class='neutral'></span>
  10 |     | <span class='neutral'>/**</span>
  11 |     | <span class='neutral'> * @title SafeERC20</span>
  12 |     | <span class='neutral'> * @dev Wrappers around ERC20 operations that throw on failure (when the token</span>
  13 |     | <span class='neutral'> * contract returns false). Tokens that return no value (and instead revert or</span>
  14 |     | <span class='neutral'> * throw on failure) are also supported, non-reverting calls are assumed to be</span>
  15 |     | <span class='neutral'> * successful.</span>
  16 |     | <span class='neutral'> * To use this library you can add a `using SafeERC20 for IERC20;` statement to your contract,</span>
  17 |     | <span class='neutral'> * which allows you to call the safe operations as `token.safeTransfer(...)`, etc.</span>
  18 |     | <span class='neutral'> */</span>
  19 |     | <span class='unexecuted'>library SafeERC20 {</span>
  20 |     | <span class='neutral'>    using Address for address;</span>
  21 |     | <span class='neutral'></span>
  22 |     | <span class='neutral'>    /**</span>
  23 |     | <span class='neutral'>     * @dev Transfer `value` amount of `token` from the calling contract to `to`. If `token` returns no value,</span>
  24 |     | <span class='neutral'>     * non-reverting calls are assumed to be successful.</span>
  25 |     | <span class='neutral'>     */</span>
  26 | *   | <span class='executed'>    function safeTransfer(IERC20 token, address to, uint256 value) internal {</span>
  27 | *   | <span class='executed'>        _callOptionalReturn(token, abi.encodeWithSelector(token.transfer.selector, to, value));</span>
  28 |     | <span class='neutral'>    }</span>
  29 |     | <span class='neutral'></span>
  30 |     | <span class='neutral'>    /**</span>
  31 |     | <span class='neutral'>     * @dev Transfer `value` amount of `token` from `from` to `to`, spending the approval given by `from` to the</span>
  32 |     | <span class='neutral'>     * calling contract. If `token` returns no value, non-reverting calls are assumed to be successful.</span>
  33 |     | <span class='neutral'>     */</span>
  34 | *   | <span class='executed'>    function safeTransferFrom(IERC20 token, address from, address to, uint256 value) internal {</span>
  35 | *   | <span class='executed'>        _callOptionalReturn(token, abi.encodeWithSelector(token.transferFrom.selector, from, to, value));</span>
  36 |     | <span class='neutral'>    }</span>
  37 |     | <span class='neutral'></span>
  38 |     | <span class='neutral'>    /**</span>
  39 |     | <span class='neutral'>     * @dev Deprecated. This function has issues similar to the ones found in</span>
  40 |     | <span class='neutral'>     * {IERC20-approve}, and its usage is discouraged.</span>
  41 |     | <span class='neutral'>     *</span>
  42 |     | <span class='neutral'>     * Whenever possible, use {safeIncreaseAllowance} and</span>
  43 |     | <span class='neutral'>     * {safeDecreaseAllowance} instead.</span>
  44 |     | <span class='neutral'>     */</span>
  45 |     | <span class='neutral'>    function safeApprove(IERC20 token, address spender, uint256 value) internal {</span>
  46 |     | <span class='neutral'>        // safeApprove should only be called when setting an initial allowance,</span>
  47 |     | <span class='neutral'>        // or when resetting it to zero. To increase and decrease it, use</span>
  48 |     | <span class='neutral'>        // &#39;safeIncreaseAllowance&#39; and &#39;safeDecreaseAllowance&#39;</span>
  49 |     | <span class='neutral'>        require(</span>
  50 |     | <span class='neutral'>            (value == 0) || (token.allowance(address(this), spender) == 0),</span>
  51 |     | <span class='neutral'>            &quot;SafeERC20: approve from non-zero to non-zero allowance&quot;</span>
  52 |     | <span class='neutral'>        );</span>
  53 |     | <span class='neutral'>        _callOptionalReturn(token, abi.encodeWithSelector(token.approve.selector, spender, value));</span>
  54 |     | <span class='neutral'>    }</span>
  55 |     | <span class='neutral'></span>
  56 |     | <span class='neutral'>    /**</span>
  57 |     | <span class='neutral'>     * @dev Increase the calling contract&#39;s allowance toward `spender` by `value`. If `token` returns no value,</span>
  58 |     | <span class='neutral'>     * non-reverting calls are assumed to be successful.</span>
  59 |     | <span class='neutral'>     */</span>
  60 |     | <span class='neutral'>    function safeIncreaseAllowance(IERC20 token, address spender, uint256 value) internal {</span>
  61 |     | <span class='neutral'>        uint256 oldAllowance = token.allowance(address(this), spender);</span>
  62 |     | <span class='neutral'>        _callOptionalReturn(token, abi.encodeWithSelector(token.approve.selector, spender, oldAllowance + value));</span>
  63 |     | <span class='neutral'>    }</span>
  64 |     | <span class='neutral'></span>
  65 |     | <span class='neutral'>    /**</span>
  66 |     | <span class='neutral'>     * @dev Decrease the calling contract&#39;s allowance toward `spender` by `value`. If `token` returns no value,</span>
  67 |     | <span class='neutral'>     * non-reverting calls are assumed to be successful.</span>
  68 |     | <span class='neutral'>     */</span>
  69 |     | <span class='neutral'>    function safeDecreaseAllowance(IERC20 token, address spender, uint256 value) internal {</span>
  70 |     | <span class='neutral'>        unchecked {</span>
  71 |     | <span class='neutral'>            uint256 oldAllowance = token.allowance(address(this), spender);</span>
  72 |     | <span class='neutral'>            require(oldAllowance &gt;= value, &quot;SafeERC20: decreased allowance below zero&quot;);</span>
  73 |     | <span class='neutral'>            _callOptionalReturn(token, abi.encodeWithSelector(token.approve.selector, spender, oldAllowance - value));</span>
  74 |     | <span class='neutral'>        }</span>
  75 |     | <span class='neutral'>    }</span>
  76 |     | <span class='neutral'></span>
  77 |     | <span class='neutral'>    /**</span>
  78 |     | <span class='neutral'>     * @dev Set the calling contract&#39;s allowance toward `spender` to `value`. If `token` returns no value,</span>
  79 |     | <span class='neutral'>     * non-reverting calls are assumed to be successful. Meant to be used with tokens that require the approval</span>
  80 |     | <span class='neutral'>     * to be set to zero before setting it to a non-zero value, such as USDT.</span>
  81 |     | <span class='neutral'>     */</span>
  82 |     | <span class='neutral'>    function forceApprove(IERC20 token, address spender, uint256 value) internal {</span>
  83 |     | <span class='neutral'>        bytes memory approvalCall = abi.encodeWithSelector(token.approve.selector, spender, value);</span>
  84 |     | <span class='neutral'></span>
  85 |     | <span class='neutral'>        if (!_callOptionalReturnBool(token, approvalCall)) {</span>
  86 |     | <span class='neutral'>            _callOptionalReturn(token, abi.encodeWithSelector(token.approve.selector, spender, 0));</span>
  87 |     | <span class='neutral'>            _callOptionalReturn(token, approvalCall);</span>
  88 |     | <span class='neutral'>        }</span>
  89 |     | <span class='neutral'>    }</span>
  90 |     | <span class='neutral'></span>
  91 |     | <span class='neutral'>    /**</span>
  92 |     | <span class='neutral'>     * @dev Use a ERC-2612 signature to set the `owner` approval toward `spender` on `token`.</span>
  93 |     | <span class='neutral'>     * Revert on invalid signature.</span>
  94 |     | <span class='neutral'>     */</span>
  95 |     | <span class='neutral'>    function safePermit(</span>
  96 |     | <span class='neutral'>        IERC20Permit token,</span>
  97 |     | <span class='neutral'>        address owner,</span>
  98 |     | <span class='neutral'>        address spender,</span>
  99 |     | <span class='neutral'>        uint256 value,</span>
 100 |     | <span class='neutral'>        uint256 deadline,</span>
 101 |     | <span class='neutral'>        uint8 v,</span>
 102 |     | <span class='neutral'>        bytes32 r,</span>
 103 |     | <span class='neutral'>        bytes32 s</span>
 104 |     | <span class='neutral'>    ) internal {</span>
 105 |     | <span class='neutral'>        uint256 nonceBefore = token.nonces(owner);</span>
 106 |     | <span class='neutral'>        token.permit(owner, spender, value, deadline, v, r, s);</span>
 107 |     | <span class='neutral'>        uint256 nonceAfter = token.nonces(owner);</span>
 108 |     | <span class='neutral'>        require(nonceAfter == nonceBefore + 1, &quot;SafeERC20: permit did not succeed&quot;);</span>
 109 |     | <span class='neutral'>    }</span>
 110 |     | <span class='neutral'></span>
 111 |     | <span class='neutral'>    /**</span>
 112 |     | <span class='neutral'>     * @dev Imitates a Solidity high-level call (i.e. a regular function call to a contract), relaxing the requirement</span>
 113 |     | <span class='neutral'>     * on the return value: the return value is optional (but if data is returned, it must not be false).</span>
 114 |     | <span class='neutral'>     * @param token The token targeted by the call.</span>
 115 |     | <span class='neutral'>     * @param data The call data (encoded using abi.encode or one of its variants).</span>
 116 |     | <span class='neutral'>     */</span>
 117 | *   | <span class='executed'>    function _callOptionalReturn(IERC20 token, bytes memory data) private {</span>
 118 |     | <span class='neutral'>        // We need to perform a low level call here, to bypass Solidity&#39;s return data size checking mechanism, since</span>
 119 |     | <span class='neutral'>        // we&#39;re implementing it ourselves. We use {Address-functionCall} to perform this call, which verifies that</span>
 120 |     | <span class='neutral'>        // the target address contains contract code and also asserts for success in the low-level call.</span>
 121 |     | <span class='neutral'></span>
 122 | *   | <span class='executed'>        bytes memory returndata = address(token).functionCall(data, &quot;SafeERC20: low-level call failed&quot;);</span>
 123 | *   | <span class='executed'>        require(returndata.length == 0 || abi.decode(returndata, (bool)), &quot;SafeERC20: ERC20 operation did not succeed&quot;);</span>
 124 |     | <span class='neutral'>    }</span>
 125 |     | <span class='neutral'></span>
 126 |     | <span class='neutral'>    /**</span>
 127 |     | <span class='neutral'>     * @dev Imitates a Solidity high-level call (i.e. a regular function call to a contract), relaxing the requirement</span>
 128 |     | <span class='neutral'>     * on the return value: the return value is optional (but if data is returned, it must not be false).</span>
 129 |     | <span class='neutral'>     * @param token The token targeted by the call.</span>
 130 |     | <span class='neutral'>     * @param data The call data (encoded using abi.encode or one of its variants).</span>
 131 |     | <span class='neutral'>     *</span>
 132 |     | <span class='neutral'>     * This is a variant of {_callOptionalReturn} that silents catches all reverts and returns a bool instead.</span>
 133 |     | <span class='neutral'>     */</span>
 134 |     | <span class='neutral'>    function _callOptionalReturnBool(IERC20 token, bytes memory data) private returns (bool) {</span>
 135 |     | <span class='neutral'>        // We need to perform a low level call here, to bypass Solidity&#39;s return data size checking mechanism, since</span>
 136 |     | <span class='neutral'>        // we&#39;re implementing it ourselves. We cannot use {Address-functionCall} here since this should return false</span>
 137 |     | <span class='neutral'>        // and not revert is the subcall reverts.</span>
 138 |     | <span class='neutral'></span>
 139 |     | <span class='neutral'>        (bool success, bytes memory returndata) = address(token).call(data);</span>
 140 |     | <span class='neutral'>        return</span>
 141 |     | <span class='neutral'>            success &amp;&amp; (returndata.length == 0 || abi.decode(returndata, (bool))) &amp;&amp; Address.isContract(address(token));</span>
 142 |     | <span class='neutral'>    }</span>
 143 |     | <span class='neutral'>}</span>
 144 |     | <span class='neutral'></span>

</code>
<br />

<b>/Users/mozzer/development/blockchain/ordinalspad/ordify-contracts/lib/openzeppelin-contracts/contracts/utils/Address.sol</b>
<code>
   1 |     | <span class='neutral'>// SPDX-License-Identifier: MIT</span>
   2 |     | <span class='neutral'>// OpenZeppelin Contracts (last updated v4.9.0) (utils/Address.sol)</span>
   3 |     | <span class='neutral'></span>
   4 |     | <span class='neutral'>pragma solidity ^0.8.1;</span>
   5 |     | <span class='neutral'></span>
   6 |     | <span class='neutral'>/**</span>
   7 |     | <span class='neutral'> * @dev Collection of functions related to the address type</span>
   8 |     | <span class='neutral'> */</span>
   9 |     | <span class='unexecuted'>library Address {</span>
  10 |     | <span class='neutral'>    /**</span>
  11 |     | <span class='neutral'>     * @dev Returns true if `account` is a contract.</span>
  12 |     | <span class='neutral'>     *</span>
  13 |     | <span class='neutral'>     * [IMPORTANT]</span>
  14 |     | <span class='neutral'>     * ====</span>
  15 |     | <span class='neutral'>     * It is unsafe to assume that an address for which this function returns</span>
  16 |     | <span class='neutral'>     * false is an externally-owned account (EOA) and not a contract.</span>
  17 |     | <span class='neutral'>     *</span>
  18 |     | <span class='neutral'>     * Among others, `isContract` will return false for the following</span>
  19 |     | <span class='neutral'>     * types of addresses:</span>
  20 |     | <span class='neutral'>     *</span>
  21 |     | <span class='neutral'>     *  - an externally-owned account</span>
  22 |     | <span class='neutral'>     *  - a contract in construction</span>
  23 |     | <span class='neutral'>     *  - an address where a contract will be created</span>
  24 |     | <span class='neutral'>     *  - an address where a contract lived, but was destroyed</span>
  25 |     | <span class='neutral'>     *</span>
  26 |     | <span class='neutral'>     * Furthermore, `isContract` will also return true if the target contract within</span>
  27 |     | <span class='neutral'>     * the same transaction is already scheduled for destruction by `SELFDESTRUCT`,</span>
  28 |     | <span class='neutral'>     * which only has an effect at the end of a transaction.</span>
  29 |     | <span class='neutral'>     * ====</span>
  30 |     | <span class='neutral'>     *</span>
  31 |     | <span class='neutral'>     * [IMPORTANT]</span>
  32 |     | <span class='neutral'>     * ====</span>
  33 |     | <span class='neutral'>     * You shouldn&#39;t rely on `isContract` to protect against flash loan attacks!</span>
  34 |     | <span class='neutral'>     *</span>
  35 |     | <span class='neutral'>     * Preventing calls from contracts is highly discouraged. It breaks composability, breaks support for smart wallets</span>
  36 |     | <span class='neutral'>     * like Gnosis Safe, and does not provide security since it can be circumvented by calling from a contract</span>
  37 |     | <span class='neutral'>     * constructor.</span>
  38 |     | <span class='neutral'>     * ====</span>
  39 |     | <span class='neutral'>     */</span>
  40 |     | <span class='neutral'>    function isContract(address account) internal view returns (bool) {</span>
  41 |     | <span class='neutral'>        // This method relies on extcodesize/address.code.length, which returns 0</span>
  42 |     | <span class='neutral'>        // for contracts in construction, since the code is only stored at the end</span>
  43 |     | <span class='neutral'>        // of the constructor execution.</span>
  44 |     | <span class='neutral'></span>
  45 |     | <span class='unexecuted'>        return account.code.length &gt; 0;</span>
  46 |     | <span class='neutral'>    }</span>
  47 |     | <span class='neutral'></span>
  48 |     | <span class='neutral'>    /**</span>
  49 |     | <span class='neutral'>     * @dev Replacement for Solidity&#39;s `transfer`: sends `amount` wei to</span>
  50 |     | <span class='neutral'>     * `recipient`, forwarding all available gas and reverting on errors.</span>
  51 |     | <span class='neutral'>     *</span>
  52 |     | <span class='neutral'>     * https://eips.ethereum.org/EIPS/eip-1884[EIP1884] increases the gas cost</span>
  53 |     | <span class='neutral'>     * of certain opcodes, possibly making contracts go over the 2300 gas limit</span>
  54 |     | <span class='neutral'>     * imposed by `transfer`, making them unable to receive funds via</span>
  55 |     | <span class='neutral'>     * `transfer`. {sendValue} removes this limitation.</span>
  56 |     | <span class='neutral'>     *</span>
  57 |     | <span class='neutral'>     * https://consensys.net/diligence/blog/2019/09/stop-using-soliditys-transfer-now/[Learn more].</span>
  58 |     | <span class='neutral'>     *</span>
  59 |     | <span class='neutral'>     * IMPORTANT: because control is transferred to `recipient`, care must be</span>
  60 |     | <span class='neutral'>     * taken to not create reentrancy vulnerabilities. Consider using</span>
  61 |     | <span class='neutral'>     * {ReentrancyGuard} or the</span>
  62 |     | <span class='neutral'>     * https://solidity.readthedocs.io/en/v0.8.0/security-considerations.html#use-the-checks-effects-interactions-pattern[checks-effects-interactions pattern].</span>
  63 |     | <span class='neutral'>     */</span>
  64 |     | <span class='neutral'>    function sendValue(address payable recipient, uint256 amount) internal {</span>
  65 |     | <span class='neutral'>        require(address(this).balance &gt;= amount, &quot;Address: insufficient balance&quot;);</span>
  66 |     | <span class='neutral'></span>
  67 |     | <span class='neutral'>        (bool success, ) = recipient.call{value: amount}(&quot;&quot;);</span>
  68 |     | <span class='neutral'>        require(success, &quot;Address: unable to send value, recipient may have reverted&quot;);</span>
  69 |     | <span class='neutral'>    }</span>
  70 |     | <span class='neutral'></span>
  71 |     | <span class='neutral'>    /**</span>
  72 |     | <span class='neutral'>     * @dev Performs a Solidity function call using a low level `call`. A</span>
  73 |     | <span class='neutral'>     * plain `call` is an unsafe replacement for a function call: use this</span>
  74 |     | <span class='neutral'>     * function instead.</span>
  75 |     | <span class='neutral'>     *</span>
  76 |     | <span class='neutral'>     * If `target` reverts with a revert reason, it is bubbled up by this</span>
  77 |     | <span class='neutral'>     * function (like regular Solidity function calls).</span>
  78 |     | <span class='neutral'>     *</span>
  79 |     | <span class='neutral'>     * Returns the raw returned data. To convert to the expected return value,</span>
  80 |     | <span class='neutral'>     * use https://solidity.readthedocs.io/en/latest/units-and-global-variables.html?highlight=abi.decode#abi-encoding-and-decoding-functions[`abi.decode`].</span>
  81 |     | <span class='neutral'>     *</span>
  82 |     | <span class='neutral'>     * Requirements:</span>
  83 |     | <span class='neutral'>     *</span>
  84 |     | <span class='neutral'>     * - `target` must be a contract.</span>
  85 |     | <span class='neutral'>     * - calling `target` with `data` must not revert.</span>
  86 |     | <span class='neutral'>     *</span>
  87 |     | <span class='neutral'>     * _Available since v3.1._</span>
  88 |     | <span class='neutral'>     */</span>
  89 |     | <span class='neutral'>    function functionCall(address target, bytes memory data) internal returns (bytes memory) {</span>
  90 |     | <span class='neutral'>        return functionCallWithValue(target, data, 0, &quot;Address: low-level call failed&quot;);</span>
  91 |     | <span class='neutral'>    }</span>
  92 |     | <span class='neutral'></span>
  93 |     | <span class='neutral'>    /**</span>
  94 |     | <span class='neutral'>     * @dev Same as {xref-Address-functionCall-address-bytes-}[`functionCall`], but with</span>
  95 |     | <span class='neutral'>     * `errorMessage` as a fallback revert reason when `target` reverts.</span>
  96 |     | <span class='neutral'>     *</span>
  97 |     | <span class='neutral'>     * _Available since v3.1._</span>
  98 |     | <span class='neutral'>     */</span>
  99 | *   | <span class='executed'>    function functionCall(</span>
 100 |     | <span class='neutral'>        address target,</span>
 101 |     | <span class='neutral'>        bytes memory data,</span>
 102 |     | <span class='neutral'>        string memory errorMessage</span>
 103 | *   | <span class='executed'>    ) internal returns (bytes memory) {</span>
 104 | *   | <span class='executed'>        return functionCallWithValue(target, data, 0, errorMessage);</span>
 105 |     | <span class='neutral'>    }</span>
 106 |     | <span class='neutral'></span>
 107 |     | <span class='neutral'>    /**</span>
 108 |     | <span class='neutral'>     * @dev Same as {xref-Address-functionCall-address-bytes-}[`functionCall`],</span>
 109 |     | <span class='neutral'>     * but also transferring `value` wei to `target`.</span>
 110 |     | <span class='neutral'>     *</span>
 111 |     | <span class='neutral'>     * Requirements:</span>
 112 |     | <span class='neutral'>     *</span>
 113 |     | <span class='neutral'>     * - the calling contract must have an ETH balance of at least `value`.</span>
 114 |     | <span class='neutral'>     * - the called Solidity function must be `payable`.</span>
 115 |     | <span class='neutral'>     *</span>
 116 |     | <span class='neutral'>     * _Available since v3.1._</span>
 117 |     | <span class='neutral'>     */</span>
 118 |     | <span class='neutral'>    function functionCallWithValue(address target, bytes memory data, uint256 value) internal returns (bytes memory) {</span>
 119 |     | <span class='neutral'>        return functionCallWithValue(target, data, value, &quot;Address: low-level call with value failed&quot;);</span>
 120 |     | <span class='neutral'>    }</span>
 121 |     | <span class='neutral'></span>
 122 |     | <span class='neutral'>    /**</span>
 123 |     | <span class='neutral'>     * @dev Same as {xref-Address-functionCallWithValue-address-bytes-uint256-}[`functionCallWithValue`], but</span>
 124 |     | <span class='neutral'>     * with `errorMessage` as a fallback revert reason when `target` reverts.</span>
 125 |     | <span class='neutral'>     *</span>
 126 |     | <span class='neutral'>     * _Available since v3.1._</span>
 127 |     | <span class='neutral'>     */</span>
 128 | *   | <span class='executed'>    function functionCallWithValue(</span>
 129 |     | <span class='neutral'>        address target,</span>
 130 |     | <span class='neutral'>        bytes memory data,</span>
 131 |     | <span class='neutral'>        uint256 value,</span>
 132 |     | <span class='neutral'>        string memory errorMessage</span>
 133 | *   | <span class='executed'>    ) internal returns (bytes memory) {</span>
 134 | *   | <span class='executed'>        require(address(this).balance &gt;= value, &quot;Address: insufficient balance for call&quot;);</span>
 135 | *   | <span class='executed'>        (bool success, bytes memory returndata) = target.call{value: value}(data);</span>
 136 | *   | <span class='executed'>        return verifyCallResultFromTarget(target, success, returndata, errorMessage);</span>
 137 |     | <span class='neutral'>    }</span>
 138 |     | <span class='neutral'></span>
 139 |     | <span class='neutral'>    /**</span>
 140 |     | <span class='neutral'>     * @dev Same as {xref-Address-functionCall-address-bytes-}[`functionCall`],</span>
 141 |     | <span class='neutral'>     * but performing a static call.</span>
 142 |     | <span class='neutral'>     *</span>
 143 |     | <span class='neutral'>     * _Available since v3.3._</span>
 144 |     | <span class='neutral'>     */</span>
 145 |     | <span class='neutral'>    function functionStaticCall(address target, bytes memory data) internal view returns (bytes memory) {</span>
 146 |     | <span class='neutral'>        return functionStaticCall(target, data, &quot;Address: low-level static call failed&quot;);</span>
 147 |     | <span class='neutral'>    }</span>
 148 |     | <span class='neutral'></span>
 149 |     | <span class='neutral'>    /**</span>
 150 |     | <span class='neutral'>     * @dev Same as {xref-Address-functionCall-address-bytes-string-}[`functionCall`],</span>
 151 |     | <span class='neutral'>     * but performing a static call.</span>
 152 |     | <span class='neutral'>     *</span>
 153 |     | <span class='neutral'>     * _Available since v3.3._</span>
 154 |     | <span class='neutral'>     */</span>
 155 |     | <span class='neutral'>    function functionStaticCall(</span>
 156 |     | <span class='neutral'>        address target,</span>
 157 |     | <span class='neutral'>        bytes memory data,</span>
 158 |     | <span class='neutral'>        string memory errorMessage</span>
 159 |     | <span class='neutral'>    ) internal view returns (bytes memory) {</span>
 160 |     | <span class='neutral'>        (bool success, bytes memory returndata) = target.staticcall(data);</span>
 161 |     | <span class='neutral'>        return verifyCallResultFromTarget(target, success, returndata, errorMessage);</span>
 162 |     | <span class='neutral'>    }</span>
 163 |     | <span class='neutral'></span>
 164 |     | <span class='neutral'>    /**</span>
 165 |     | <span class='neutral'>     * @dev Same as {xref-Address-functionCall-address-bytes-}[`functionCall`],</span>
 166 |     | <span class='neutral'>     * but performing a delegate call.</span>
 167 |     | <span class='neutral'>     *</span>
 168 |     | <span class='neutral'>     * _Available since v3.4._</span>
 169 |     | <span class='neutral'>     */</span>
 170 |     | <span class='neutral'>    function functionDelegateCall(address target, bytes memory data) internal returns (bytes memory) {</span>
 171 |     | <span class='neutral'>        return functionDelegateCall(target, data, &quot;Address: low-level delegate call failed&quot;);</span>
 172 |     | <span class='neutral'>    }</span>
 173 |     | <span class='neutral'></span>
 174 |     | <span class='neutral'>    /**</span>
 175 |     | <span class='neutral'>     * @dev Same as {xref-Address-functionCall-address-bytes-string-}[`functionCall`],</span>
 176 |     | <span class='neutral'>     * but performing a delegate call.</span>
 177 |     | <span class='neutral'>     *</span>
 178 |     | <span class='neutral'>     * _Available since v3.4._</span>
 179 |     | <span class='neutral'>     */</span>
 180 |     | <span class='neutral'>    function functionDelegateCall(</span>
 181 |     | <span class='neutral'>        address target,</span>
 182 |     | <span class='neutral'>        bytes memory data,</span>
 183 |     | <span class='neutral'>        string memory errorMessage</span>
 184 |     | <span class='neutral'>    ) internal returns (bytes memory) {</span>
 185 |     | <span class='neutral'>        (bool success, bytes memory returndata) = target.delegatecall(data);</span>
 186 |     | <span class='neutral'>        return verifyCallResultFromTarget(target, success, returndata, errorMessage);</span>
 187 |     | <span class='neutral'>    }</span>
 188 |     | <span class='neutral'></span>
 189 |     | <span class='neutral'>    /**</span>
 190 |     | <span class='neutral'>     * @dev Tool to verify that a low level call to smart-contract was successful, and revert (either by bubbling</span>
 191 |     | <span class='neutral'>     * the revert reason or using the provided one) in case of unsuccessful call or if target was not a contract.</span>
 192 |     | <span class='neutral'>     *</span>
 193 |     | <span class='neutral'>     * _Available since v4.8._</span>
 194 |     | <span class='neutral'>     */</span>
 195 | *   | <span class='executed'>    function verifyCallResultFromTarget(</span>
 196 |     | <span class='neutral'>        address target,</span>
 197 |     | <span class='neutral'>        bool success,</span>
 198 |     | <span class='neutral'>        bytes memory returndata,</span>
 199 |     | <span class='neutral'>        string memory errorMessage</span>
 200 | *   | <span class='executed'>    ) internal view returns (bytes memory) {</span>
 201 | *   | <span class='executed'>        if (success) {</span>
 202 | *   | <span class='executed'>            if (returndata.length == 0) {</span>
 203 |     | <span class='neutral'>                // only check isContract if the call was successful and the return data is empty</span>
 204 |     | <span class='neutral'>                // otherwise we already know that it was a contract</span>
 205 | *   | <span class='executed'>                require(isContract(target), &quot;Address: call to non-contract&quot;);</span>
 206 |     | <span class='neutral'>            }</span>
 207 | *   | <span class='executed'>            return returndata;</span>
 208 |     | <span class='neutral'>        } else {</span>
 209 |     | <span class='unexecuted'>            _revert(returndata, errorMessage);</span>
 210 |     | <span class='neutral'>        }</span>
 211 |     | <span class='neutral'>    }</span>
 212 |     | <span class='neutral'></span>
 213 |     | <span class='neutral'>    /**</span>
 214 |     | <span class='neutral'>     * @dev Tool to verify that a low level call was successful, and revert if it wasn&#39;t, either by bubbling the</span>
 215 |     | <span class='neutral'>     * revert reason or using the provided one.</span>
 216 |     | <span class='neutral'>     *</span>
 217 |     | <span class='neutral'>     * _Available since v4.3._</span>
 218 |     | <span class='neutral'>     */</span>
 219 |     | <span class='neutral'>    function verifyCallResult(</span>
 220 |     | <span class='neutral'>        bool success,</span>
 221 |     | <span class='neutral'>        bytes memory returndata,</span>
 222 |     | <span class='neutral'>        string memory errorMessage</span>
 223 |     | <span class='neutral'>    ) internal pure returns (bytes memory) {</span>
 224 |     | <span class='neutral'>        if (success) {</span>
 225 |     | <span class='neutral'>            return returndata;</span>
 226 |     | <span class='neutral'>        } else {</span>
 227 |     | <span class='neutral'>            _revert(returndata, errorMessage);</span>
 228 |     | <span class='neutral'>        }</span>
 229 |     | <span class='neutral'>    }</span>
 230 |     | <span class='neutral'></span>
 231 |     | <span class='neutral'>    function _revert(bytes memory returndata, string memory errorMessage) private pure {</span>
 232 |     | <span class='neutral'>        // Look for revert reason and bubble it up if present</span>
 233 |     | <span class='unexecuted'>        if (returndata.length &gt; 0) {</span>
 234 |     | <span class='neutral'>            // The easiest way to bubble the revert reason is using memory via assembly</span>
 235 |     | <span class='neutral'>            /// @solidity memory-safe-assembly</span>
 236 |     | <span class='neutral'>            assembly {</span>
 237 |     | <span class='unexecuted'>                let returndata_size := mload(returndata)</span>
 238 |     | <span class='unexecuted'>                revert(add(32, returndata), returndata_size)</span>
 239 |     | <span class='neutral'>            }</span>
 240 |     | <span class='neutral'>        } else {</span>
 241 |     | <span class='unexecuted'>            revert(errorMessage);</span>
 242 |     | <span class='neutral'>        }</span>
 243 |     | <span class='neutral'>    }</span>
 244 |     | <span class='neutral'>}</span>
 245 |     | <span class='neutral'></span>

</code>
<br />

<b>/Users/mozzer/development/blockchain/ordinalspad/ordify-contracts/lib/openzeppelin-contracts/contracts/utils/Context.sol</b>
<code>
  1 |     | <span class='neutral'>// SPDX-License-Identifier: MIT</span>
  2 |     | <span class='neutral'>// OpenZeppelin Contracts v4.4.1 (utils/Context.sol)</span>
  3 |     | <span class='neutral'></span>
  4 |     | <span class='neutral'>pragma solidity ^0.8.0;</span>
  5 |     | <span class='neutral'></span>
  6 |     | <span class='neutral'>/**</span>
  7 |     | <span class='neutral'> * @dev Provides information about the current execution context, including the</span>
  8 |     | <span class='neutral'> * sender of the transaction and its data. While these are generally available</span>
  9 |     | <span class='neutral'> * via msg.sender and msg.data, they should not be accessed in such a direct</span>
 10 |     | <span class='neutral'> * manner, since when dealing with meta-transactions the account sending and</span>
 11 |     | <span class='neutral'> * paying for execution may not be the actual sender (as far as an application</span>
 12 |     | <span class='neutral'> * is concerned).</span>
 13 |     | <span class='neutral'> *</span>
 14 |     | <span class='neutral'> * This contract is only required for intermediate, library-like contracts.</span>
 15 |     | <span class='neutral'> */</span>
 16 |     | <span class='neutral'>abstract contract Context {</span>
 17 |     | <span class='neutral'>    function _msgSender() internal view virtual returns (address) {</span>
 18 | *   | <span class='executed'>        return msg.sender;</span>
 19 |     | <span class='neutral'>    }</span>
 20 |     | <span class='neutral'></span>
 21 |     | <span class='neutral'>    function _msgData() internal view virtual returns (bytes calldata) {</span>
 22 |     | <span class='neutral'>        return msg.data;</span>
 23 |     | <span class='neutral'>    }</span>
 24 |     | <span class='neutral'>}</span>
 25 |     | <span class='neutral'></span>

</code>
<br />

<b>/Users/mozzer/development/blockchain/ordinalspad/ordify-contracts/lib/openzeppelin-contracts/contracts/utils/math/Math.sol</b>
<code>
   1 |     | <span class='neutral'>// SPDX-License-Identifier: MIT</span>
   2 |     | <span class='neutral'>// OpenZeppelin Contracts (last updated v4.9.0) (utils/math/Math.sol)</span>
   3 |     | <span class='neutral'></span>
   4 |     | <span class='neutral'>pragma solidity ^0.8.0;</span>
   5 |     | <span class='neutral'></span>
   6 |     | <span class='neutral'>/**</span>
   7 |     | <span class='neutral'> * @dev Standard math utilities missing in the Solidity language.</span>
   8 |     | <span class='neutral'> */</span>
   9 |     | <span class='unexecuted'>library Math {</span>
  10 |     | <span class='neutral'>    enum Rounding {</span>
  11 |     | <span class='neutral'>        Down, // Toward negative infinity</span>
  12 |     | <span class='neutral'>        Up, // Toward infinity</span>
  13 |     | <span class='neutral'>        Zero // Toward zero</span>
  14 |     | <span class='neutral'>    }</span>
  15 |     | <span class='neutral'></span>
  16 |     | <span class='neutral'>    /**</span>
  17 |     | <span class='neutral'>     * @dev Returns the largest of two numbers.</span>
  18 |     | <span class='neutral'>     */</span>
  19 |     | <span class='neutral'>    function max(uint256 a, uint256 b) internal pure returns (uint256) {</span>
  20 |     | <span class='neutral'>        return a &gt; b ? a : b;</span>
  21 |     | <span class='neutral'>    }</span>
  22 |     | <span class='neutral'></span>
  23 |     | <span class='neutral'>    /**</span>
  24 |     | <span class='neutral'>     * @dev Returns the smallest of two numbers.</span>
  25 |     | <span class='neutral'>     */</span>
  26 | *   | <span class='executed'>    function min(uint256 a, uint256 b) internal pure returns (uint256) {</span>
  27 | *   | <span class='executed'>        return a &lt; b ? a : b;</span>
  28 |     | <span class='neutral'>    }</span>
  29 |     | <span class='neutral'></span>
  30 |     | <span class='neutral'>    /**</span>
  31 |     | <span class='neutral'>     * @dev Returns the average of two numbers. The result is rounded towards</span>
  32 |     | <span class='neutral'>     * zero.</span>
  33 |     | <span class='neutral'>     */</span>
  34 |     | <span class='neutral'>    function average(uint256 a, uint256 b) internal pure returns (uint256) {</span>
  35 |     | <span class='neutral'>        // (a + b) / 2 can overflow.</span>
  36 |     | <span class='neutral'>        return (a &amp; b) + (a ^ b) / 2;</span>
  37 |     | <span class='neutral'>    }</span>
  38 |     | <span class='neutral'></span>
  39 |     | <span class='neutral'>    /**</span>
  40 |     | <span class='neutral'>     * @dev Returns the ceiling of the division of two numbers.</span>
  41 |     | <span class='neutral'>     *</span>
  42 |     | <span class='neutral'>     * This differs from standard division with `/` in that it rounds up instead</span>
  43 |     | <span class='neutral'>     * of rounding down.</span>
  44 |     | <span class='neutral'>     */</span>
  45 |     | <span class='neutral'>    function ceilDiv(uint256 a, uint256 b) internal pure returns (uint256) {</span>
  46 |     | <span class='neutral'>        // (a + b - 1) / b can overflow on addition, so we distribute.</span>
  47 |     | <span class='neutral'>        return a == 0 ? 0 : (a - 1) / b + 1;</span>
  48 |     | <span class='neutral'>    }</span>
  49 |     | <span class='neutral'></span>
  50 |     | <span class='neutral'>    /**</span>
  51 |     | <span class='neutral'>     * @notice Calculates floor(x * y / denominator) with full precision. Throws if result overflows a uint256 or denominator == 0</span>
  52 |     | <span class='neutral'>     * @dev Original credit to Remco Bloemen under MIT license (https://xn--2-umb.com/21/muldiv)</span>
  53 |     | <span class='neutral'>     * with further edits by Uniswap Labs also under MIT license.</span>
  54 |     | <span class='neutral'>     */</span>
  55 |     | <span class='neutral'>    function mulDiv(uint256 x, uint256 y, uint256 denominator) internal pure returns (uint256 result) {</span>
  56 |     | <span class='neutral'>        unchecked {</span>
  57 |     | <span class='neutral'>            // 512-bit multiply [prod1 prod0] = x * y. Compute the product mod 2^256 and mod 2^256 - 1, then use</span>
  58 |     | <span class='neutral'>            // use the Chinese Remainder Theorem to reconstruct the 512 bit result. The result is stored in two 256</span>
  59 |     | <span class='neutral'>            // variables such that product = prod1 * 2^256 + prod0.</span>
  60 |     | <span class='neutral'>            uint256 prod0; // Least significant 256 bits of the product</span>
  61 |     | <span class='neutral'>            uint256 prod1; // Most significant 256 bits of the product</span>
  62 |     | <span class='neutral'>            assembly {</span>
  63 |     | <span class='neutral'>                let mm := mulmod(x, y, not(0))</span>
  64 |     | <span class='neutral'>                prod0 := mul(x, y)</span>
  65 |     | <span class='neutral'>                prod1 := sub(sub(mm, prod0), lt(mm, prod0))</span>
  66 |     | <span class='neutral'>            }</span>
  67 |     | <span class='neutral'></span>
  68 |     | <span class='neutral'>            // Handle non-overflow cases, 256 by 256 division.</span>
  69 |     | <span class='neutral'>            if (prod1 == 0) {</span>
  70 |     | <span class='neutral'>                // Solidity will revert if denominator == 0, unlike the div opcode on its own.</span>
  71 |     | <span class='neutral'>                // The surrounding unchecked block does not change this fact.</span>
  72 |     | <span class='neutral'>                // See https://docs.soliditylang.org/en/latest/control-structures.html#checked-or-unchecked-arithmetic.</span>
  73 |     | <span class='neutral'>                return prod0 / denominator;</span>
  74 |     | <span class='neutral'>            }</span>
  75 |     | <span class='neutral'></span>
  76 |     | <span class='neutral'>            // Make sure the result is less than 2^256. Also prevents denominator == 0.</span>
  77 |     | <span class='neutral'>            require(denominator &gt; prod1, &quot;Math: mulDiv overflow&quot;);</span>
  78 |     | <span class='neutral'></span>
  79 |     | <span class='neutral'>            ///////////////////////////////////////////////</span>
  80 |     | <span class='neutral'>            // 512 by 256 division.</span>
  81 |     | <span class='neutral'>            ///////////////////////////////////////////////</span>
  82 |     | <span class='neutral'></span>
  83 |     | <span class='neutral'>            // Make division exact by subtracting the remainder from [prod1 prod0].</span>
  84 |     | <span class='neutral'>            uint256 remainder;</span>
  85 |     | <span class='neutral'>            assembly {</span>
  86 |     | <span class='neutral'>                // Compute remainder using mulmod.</span>
  87 |     | <span class='neutral'>                remainder := mulmod(x, y, denominator)</span>
  88 |     | <span class='neutral'></span>
  89 |     | <span class='neutral'>                // Subtract 256 bit number from 512 bit number.</span>
  90 |     | <span class='neutral'>                prod1 := sub(prod1, gt(remainder, prod0))</span>
  91 |     | <span class='neutral'>                prod0 := sub(prod0, remainder)</span>
  92 |     | <span class='neutral'>            }</span>
  93 |     | <span class='neutral'></span>
  94 |     | <span class='neutral'>            // Factor powers of two out of denominator and compute largest power of two divisor of denominator. Always &gt;= 1.</span>
  95 |     | <span class='neutral'>            // See https://cs.stackexchange.com/q/138556/92363.</span>
  96 |     | <span class='neutral'></span>
  97 |     | <span class='neutral'>            // Does not overflow because the denominator cannot be zero at this stage in the function.</span>
  98 |     | <span class='neutral'>            uint256 twos = denominator &amp; (~denominator + 1);</span>
  99 |     | <span class='neutral'>            assembly {</span>
 100 |     | <span class='neutral'>                // Divide denominator by twos.</span>
 101 |     | <span class='neutral'>                denominator := div(denominator, twos)</span>
 102 |     | <span class='neutral'></span>
 103 |     | <span class='neutral'>                // Divide [prod1 prod0] by twos.</span>
 104 |     | <span class='neutral'>                prod0 := div(prod0, twos)</span>
 105 |     | <span class='neutral'></span>
 106 |     | <span class='neutral'>                // Flip twos such that it is 2^256 / twos. If twos is zero, then it becomes one.</span>
 107 |     | <span class='neutral'>                twos := add(div(sub(0, twos), twos), 1)</span>
 108 |     | <span class='neutral'>            }</span>
 109 |     | <span class='neutral'></span>
 110 |     | <span class='neutral'>            // Shift in bits from prod1 into prod0.</span>
 111 |     | <span class='neutral'>            prod0 |= prod1 * twos;</span>
 112 |     | <span class='neutral'></span>
 113 |     | <span class='neutral'>            // Invert denominator mod 2^256. Now that denominator is an odd number, it has an inverse modulo 2^256 such</span>
 114 |     | <span class='neutral'>            // that denominator * inv = 1 mod 2^256. Compute the inverse by starting with a seed that is correct for</span>
 115 |     | <span class='neutral'>            // four bits. That is, denominator * inv = 1 mod 2^4.</span>
 116 |     | <span class='neutral'>            uint256 inverse = (3 * denominator) ^ 2;</span>
 117 |     | <span class='neutral'></span>
 118 |     | <span class='neutral'>            // Use the Newton-Raphson iteration to improve the precision. Thanks to Hensel&#39;s lifting lemma, this also works</span>
 119 |     | <span class='neutral'>            // in modular arithmetic, doubling the correct bits in each step.</span>
 120 |     | <span class='neutral'>            inverse *= 2 - denominator * inverse; // inverse mod 2^8</span>
 121 |     | <span class='neutral'>            inverse *= 2 - denominator * inverse; // inverse mod 2^16</span>
 122 |     | <span class='neutral'>            inverse *= 2 - denominator * inverse; // inverse mod 2^32</span>
 123 |     | <span class='neutral'>            inverse *= 2 - denominator * inverse; // inverse mod 2^64</span>
 124 |     | <span class='neutral'>            inverse *= 2 - denominator * inverse; // inverse mod 2^128</span>
 125 |     | <span class='neutral'>            inverse *= 2 - denominator * inverse; // inverse mod 2^256</span>
 126 |     | <span class='neutral'></span>
 127 |     | <span class='neutral'>            // Because the division is now exact we can divide by multiplying with the modular inverse of denominator.</span>
 128 |     | <span class='neutral'>            // This will give us the correct result modulo 2^256. Since the preconditions guarantee that the outcome is</span>
 129 |     | <span class='neutral'>            // less than 2^256, this is the final result. We don&#39;t need to compute the high bits of the result and prod1</span>
 130 |     | <span class='neutral'>            // is no longer required.</span>
 131 |     | <span class='neutral'>            result = prod0 * inverse;</span>
 132 |     | <span class='neutral'>            return result;</span>
 133 |     | <span class='neutral'>        }</span>
 134 |     | <span class='neutral'>    }</span>
 135 |     | <span class='neutral'></span>
 136 |     | <span class='neutral'>    /**</span>
 137 |     | <span class='neutral'>     * @notice Calculates x * y / denominator with full precision, following the selected rounding direction.</span>
 138 |     | <span class='neutral'>     */</span>
 139 |     | <span class='neutral'>    function mulDiv(uint256 x, uint256 y, uint256 denominator, Rounding rounding) internal pure returns (uint256) {</span>
 140 |     | <span class='neutral'>        uint256 result = mulDiv(x, y, denominator);</span>
 141 |     | <span class='neutral'>        if (rounding == Rounding.Up &amp;&amp; mulmod(x, y, denominator) &gt; 0) {</span>
 142 |     | <span class='neutral'>            result += 1;</span>
 143 |     | <span class='neutral'>        }</span>
 144 |     | <span class='neutral'>        return result;</span>
 145 |     | <span class='neutral'>    }</span>
 146 |     | <span class='neutral'></span>
 147 |     | <span class='neutral'>    /**</span>
 148 |     | <span class='neutral'>     * @dev Returns the square root of a number. If the number is not a perfect square, the value is rounded down.</span>
 149 |     | <span class='neutral'>     *</span>
 150 |     | <span class='neutral'>     * Inspired by Henry S. Warren, Jr.&#39;s &quot;Hacker&#39;s Delight&quot; (Chapter 11).</span>
 151 |     | <span class='neutral'>     */</span>
 152 |     | <span class='neutral'>    function sqrt(uint256 a) internal pure returns (uint256) {</span>
 153 |     | <span class='neutral'>        if (a == 0) {</span>
 154 |     | <span class='neutral'>            return 0;</span>
 155 |     | <span class='neutral'>        }</span>
 156 |     | <span class='neutral'></span>
 157 |     | <span class='neutral'>        // For our first guess, we get the biggest power of 2 which is smaller than the square root of the target.</span>
 158 |     | <span class='neutral'>        //</span>
 159 |     | <span class='neutral'>        // We know that the &quot;msb&quot; (most significant bit) of our target number `a` is a power of 2 such that we have</span>
 160 |     | <span class='neutral'>        // `msb(a) &lt;= a &lt; 2*msb(a)`. This value can be written `msb(a)=2**k` with `k=log2(a)`.</span>
 161 |     | <span class='neutral'>        //</span>
 162 |     | <span class='neutral'>        // This can be rewritten `2**log2(a) &lt;= a &lt; 2**(log2(a) + 1)`</span>
 163 |     | <span class='neutral'>        // → `sqrt(2**k) &lt;= sqrt(a) &lt; sqrt(2**(k+1))`</span>
 164 |     | <span class='neutral'>        // → `2**(k/2) &lt;= sqrt(a) &lt; 2**((k+1)/2) &lt;= 2**(k/2 + 1)`</span>
 165 |     | <span class='neutral'>        //</span>
 166 |     | <span class='neutral'>        // Consequently, `2**(log2(a) / 2)` is a good first approximation of `sqrt(a)` with at least 1 correct bit.</span>
 167 |     | <span class='neutral'>        uint256 result = 1 &lt;&lt; (log2(a) &gt;&gt; 1);</span>
 168 |     | <span class='neutral'></span>
 169 |     | <span class='neutral'>        // At this point `result` is an estimation with one bit of precision. We know the true value is a uint128,</span>
 170 |     | <span class='neutral'>        // since it is the square root of a uint256. Newton&#39;s method converges quadratically (precision doubles at</span>
 171 |     | <span class='neutral'>        // every iteration). We thus need at most 7 iteration to turn our partial result with one bit of precision</span>
 172 |     | <span class='neutral'>        // into the expected uint128 result.</span>
 173 |     | <span class='neutral'>        unchecked {</span>
 174 |     | <span class='neutral'>            result = (result + a / result) &gt;&gt; 1;</span>
 175 |     | <span class='neutral'>            result = (result + a / result) &gt;&gt; 1;</span>
 176 |     | <span class='neutral'>            result = (result + a / result) &gt;&gt; 1;</span>
 177 |     | <span class='neutral'>            result = (result + a / result) &gt;&gt; 1;</span>
 178 |     | <span class='neutral'>            result = (result + a / result) &gt;&gt; 1;</span>
 179 |     | <span class='neutral'>            result = (result + a / result) &gt;&gt; 1;</span>
 180 |     | <span class='neutral'>            result = (result + a / result) &gt;&gt; 1;</span>
 181 |     | <span class='neutral'>            return min(result, a / result);</span>
 182 |     | <span class='neutral'>        }</span>
 183 |     | <span class='neutral'>    }</span>
 184 |     | <span class='neutral'></span>
 185 |     | <span class='neutral'>    /**</span>
 186 |     | <span class='neutral'>     * @notice Calculates sqrt(a), following the selected rounding direction.</span>
 187 |     | <span class='neutral'>     */</span>
 188 |     | <span class='neutral'>    function sqrt(uint256 a, Rounding rounding) internal pure returns (uint256) {</span>
 189 |     | <span class='neutral'>        unchecked {</span>
 190 |     | <span class='neutral'>            uint256 result = sqrt(a);</span>
 191 |     | <span class='neutral'>            return result + (rounding == Rounding.Up &amp;&amp; result * result &lt; a ? 1 : 0);</span>
 192 |     | <span class='neutral'>        }</span>
 193 |     | <span class='neutral'>    }</span>
 194 |     | <span class='neutral'></span>
 195 |     | <span class='neutral'>    /**</span>
 196 |     | <span class='neutral'>     * @dev Return the log in base 2, rounded down, of a positive value.</span>
 197 |     | <span class='neutral'>     * Returns 0 if given 0.</span>
 198 |     | <span class='neutral'>     */</span>
 199 |     | <span class='neutral'>    function log2(uint256 value) internal pure returns (uint256) {</span>
 200 |     | <span class='neutral'>        uint256 result = 0;</span>
 201 |     | <span class='neutral'>        unchecked {</span>
 202 |     | <span class='neutral'>            if (value &gt;&gt; 128 &gt; 0) {</span>
 203 |     | <span class='neutral'>                value &gt;&gt;= 128;</span>
 204 |     | <span class='neutral'>                result += 128;</span>
 205 |     | <span class='neutral'>            }</span>
 206 |     | <span class='neutral'>            if (value &gt;&gt; 64 &gt; 0) {</span>
 207 |     | <span class='neutral'>                value &gt;&gt;= 64;</span>
 208 |     | <span class='neutral'>                result += 64;</span>
 209 |     | <span class='neutral'>            }</span>
 210 |     | <span class='neutral'>            if (value &gt;&gt; 32 &gt; 0) {</span>
 211 |     | <span class='neutral'>                value &gt;&gt;= 32;</span>
 212 |     | <span class='neutral'>                result += 32;</span>
 213 |     | <span class='neutral'>            }</span>
 214 |     | <span class='neutral'>            if (value &gt;&gt; 16 &gt; 0) {</span>
 215 |     | <span class='neutral'>                value &gt;&gt;= 16;</span>
 216 |     | <span class='neutral'>                result += 16;</span>
 217 |     | <span class='neutral'>            }</span>
 218 |     | <span class='neutral'>            if (value &gt;&gt; 8 &gt; 0) {</span>
 219 |     | <span class='neutral'>                value &gt;&gt;= 8;</span>
 220 |     | <span class='neutral'>                result += 8;</span>
 221 |     | <span class='neutral'>            }</span>
 222 |     | <span class='neutral'>            if (value &gt;&gt; 4 &gt; 0) {</span>
 223 |     | <span class='neutral'>                value &gt;&gt;= 4;</span>
 224 |     | <span class='neutral'>                result += 4;</span>
 225 |     | <span class='neutral'>            }</span>
 226 |     | <span class='neutral'>            if (value &gt;&gt; 2 &gt; 0) {</span>
 227 |     | <span class='neutral'>                value &gt;&gt;= 2;</span>
 228 |     | <span class='neutral'>                result += 2;</span>
 229 |     | <span class='neutral'>            }</span>
 230 |     | <span class='neutral'>            if (value &gt;&gt; 1 &gt; 0) {</span>
 231 |     | <span class='neutral'>                result += 1;</span>
 232 |     | <span class='neutral'>            }</span>
 233 |     | <span class='neutral'>        }</span>
 234 |     | <span class='neutral'>        return result;</span>
 235 |     | <span class='neutral'>    }</span>
 236 |     | <span class='neutral'></span>
 237 |     | <span class='neutral'>    /**</span>
 238 |     | <span class='neutral'>     * @dev Return the log in base 2, following the selected rounding direction, of a positive value.</span>
 239 |     | <span class='neutral'>     * Returns 0 if given 0.</span>
 240 |     | <span class='neutral'>     */</span>
 241 |     | <span class='neutral'>    function log2(uint256 value, Rounding rounding) internal pure returns (uint256) {</span>
 242 |     | <span class='neutral'>        unchecked {</span>
 243 |     | <span class='neutral'>            uint256 result = log2(value);</span>
 244 |     | <span class='neutral'>            return result + (rounding == Rounding.Up &amp;&amp; 1 &lt;&lt; result &lt; value ? 1 : 0);</span>
 245 |     | <span class='neutral'>        }</span>
 246 |     | <span class='neutral'>    }</span>
 247 |     | <span class='neutral'></span>
 248 |     | <span class='neutral'>    /**</span>
 249 |     | <span class='neutral'>     * @dev Return the log in base 10, rounded down, of a positive value.</span>
 250 |     | <span class='neutral'>     * Returns 0 if given 0.</span>
 251 |     | <span class='neutral'>     */</span>
 252 |     | <span class='neutral'>    function log10(uint256 value) internal pure returns (uint256) {</span>
 253 |     | <span class='neutral'>        uint256 result = 0;</span>
 254 |     | <span class='neutral'>        unchecked {</span>
 255 |     | <span class='neutral'>            if (value &gt;= 10 ** 64) {</span>
 256 |     | <span class='neutral'>                value /= 10 ** 64;</span>
 257 |     | <span class='neutral'>                result += 64;</span>
 258 |     | <span class='neutral'>            }</span>
 259 |     | <span class='neutral'>            if (value &gt;= 10 ** 32) {</span>
 260 |     | <span class='neutral'>                value /= 10 ** 32;</span>
 261 |     | <span class='neutral'>                result += 32;</span>
 262 |     | <span class='neutral'>            }</span>
 263 |     | <span class='neutral'>            if (value &gt;= 10 ** 16) {</span>
 264 |     | <span class='neutral'>                value /= 10 ** 16;</span>
 265 |     | <span class='neutral'>                result += 16;</span>
 266 |     | <span class='neutral'>            }</span>
 267 |     | <span class='neutral'>            if (value &gt;= 10 ** 8) {</span>
 268 |     | <span class='neutral'>                value /= 10 ** 8;</span>
 269 |     | <span class='neutral'>                result += 8;</span>
 270 |     | <span class='neutral'>            }</span>
 271 |     | <span class='neutral'>            if (value &gt;= 10 ** 4) {</span>
 272 |     | <span class='neutral'>                value /= 10 ** 4;</span>
 273 |     | <span class='neutral'>                result += 4;</span>
 274 |     | <span class='neutral'>            }</span>
 275 |     | <span class='neutral'>            if (value &gt;= 10 ** 2) {</span>
 276 |     | <span class='neutral'>                value /= 10 ** 2;</span>
 277 |     | <span class='neutral'>                result += 2;</span>
 278 |     | <span class='neutral'>            }</span>
 279 |     | <span class='neutral'>            if (value &gt;= 10 ** 1) {</span>
 280 |     | <span class='neutral'>                result += 1;</span>
 281 |     | <span class='neutral'>            }</span>
 282 |     | <span class='neutral'>        }</span>
 283 |     | <span class='neutral'>        return result;</span>
 284 |     | <span class='neutral'>    }</span>
 285 |     | <span class='neutral'></span>
 286 |     | <span class='neutral'>    /**</span>
 287 |     | <span class='neutral'>     * @dev Return the log in base 10, following the selected rounding direction, of a positive value.</span>
 288 |     | <span class='neutral'>     * Returns 0 if given 0.</span>
 289 |     | <span class='neutral'>     */</span>
 290 |     | <span class='neutral'>    function log10(uint256 value, Rounding rounding) internal pure returns (uint256) {</span>
 291 |     | <span class='neutral'>        unchecked {</span>
 292 |     | <span class='neutral'>            uint256 result = log10(value);</span>
 293 |     | <span class='neutral'>            return result + (rounding == Rounding.Up &amp;&amp; 10 ** result &lt; value ? 1 : 0);</span>
 294 |     | <span class='neutral'>        }</span>
 295 |     | <span class='neutral'>    }</span>
 296 |     | <span class='neutral'></span>
 297 |     | <span class='neutral'>    /**</span>
 298 |     | <span class='neutral'>     * @dev Return the log in base 256, rounded down, of a positive value.</span>
 299 |     | <span class='neutral'>     * Returns 0 if given 0.</span>
 300 |     | <span class='neutral'>     *</span>
 301 |     | <span class='neutral'>     * Adding one to the result gives the number of pairs of hex symbols needed to represent `value` as a hex string.</span>
 302 |     | <span class='neutral'>     */</span>
 303 |     | <span class='neutral'>    function log256(uint256 value) internal pure returns (uint256) {</span>
 304 |     | <span class='neutral'>        uint256 result = 0;</span>
 305 |     | <span class='neutral'>        unchecked {</span>
 306 |     | <span class='neutral'>            if (value &gt;&gt; 128 &gt; 0) {</span>
 307 |     | <span class='neutral'>                value &gt;&gt;= 128;</span>
 308 |     | <span class='neutral'>                result += 16;</span>
 309 |     | <span class='neutral'>            }</span>
 310 |     | <span class='neutral'>            if (value &gt;&gt; 64 &gt; 0) {</span>
 311 |     | <span class='neutral'>                value &gt;&gt;= 64;</span>
 312 |     | <span class='neutral'>                result += 8;</span>
 313 |     | <span class='neutral'>            }</span>
 314 |     | <span class='neutral'>            if (value &gt;&gt; 32 &gt; 0) {</span>
 315 |     | <span class='neutral'>                value &gt;&gt;= 32;</span>
 316 |     | <span class='neutral'>                result += 4;</span>
 317 |     | <span class='neutral'>            }</span>
 318 |     | <span class='neutral'>            if (value &gt;&gt; 16 &gt; 0) {</span>
 319 |     | <span class='neutral'>                value &gt;&gt;= 16;</span>
 320 |     | <span class='neutral'>                result += 2;</span>
 321 |     | <span class='neutral'>            }</span>
 322 |     | <span class='neutral'>            if (value &gt;&gt; 8 &gt; 0) {</span>
 323 |     | <span class='neutral'>                result += 1;</span>
 324 |     | <span class='neutral'>            }</span>
 325 |     | <span class='neutral'>        }</span>
 326 |     | <span class='neutral'>        return result;</span>
 327 |     | <span class='neutral'>    }</span>
 328 |     | <span class='neutral'></span>
 329 |     | <span class='neutral'>    /**</span>
 330 |     | <span class='neutral'>     * @dev Return the log in base 256, following the selected rounding direction, of a positive value.</span>
 331 |     | <span class='neutral'>     * Returns 0 if given 0.</span>
 332 |     | <span class='neutral'>     */</span>
 333 |     | <span class='neutral'>    function log256(uint256 value, Rounding rounding) internal pure returns (uint256) {</span>
 334 |     | <span class='neutral'>        unchecked {</span>
 335 |     | <span class='neutral'>            uint256 result = log256(value);</span>
 336 |     | <span class='neutral'>            return result + (rounding == Rounding.Up &amp;&amp; 1 &lt;&lt; (result &lt;&lt; 3) &lt; value ? 1 : 0);</span>
 337 |     | <span class='neutral'>        }</span>
 338 |     | <span class='neutral'>    }</span>
 339 |     | <span class='neutral'>}</span>
 340 |     | <span class='neutral'></span>

</code>
<br />

<b>/Users/mozzer/development/blockchain/ordinalspad/ordify-contracts/src/Staking.sol</b>
<code>
   1 |     | <span class='neutral'>// SPDX-License-Identifier: MIT</span>
   2 |     | <span class='neutral'>pragma solidity 0.8.19;</span>
   3 |     | <span class='neutral'></span>
   4 |     | <span class='neutral'>import {IERC20} from &quot;@openzeppelin/contracts/token/ERC20/IERC20.sol&quot;;</span>
   5 |     | <span class='neutral'>import {SafeERC20} from &quot;@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol&quot;;</span>
   6 |     | <span class='neutral'>import {Ownable} from &quot;@openzeppelin/contracts/access/Ownable.sol&quot;;</span>
   7 |     | <span class='neutral'>import &quot;@openzeppelin/contracts/security/ReentrancyGuard.sol&quot;;</span>
   8 |     | <span class='neutral'>import &quot;@openzeppelin/contracts/utils/math/Math.sol&quot;;</span>
   9 |     | <span class='neutral'></span>
  10 |     | <span class='neutral'>/**</span>
  11 |     | <span class='neutral'> *  @dev Structs to store user staking data.</span>
  12 |     | <span class='neutral'> */</span>
  13 |     | <span class='neutral'>struct Deposit {</span>
  14 |     | <span class='neutral'>    uint8 stakingDefinitionId;</span>
  15 |     | <span class='neutral'>    uint8 status; // [DEPOSIT_STATUS_NOT_STAKING, DEPOSIT_STATUS_STAKING, DEPOSIT_STATUS_STAKING_WITHDRAWN]</span>
  16 |     | <span class='neutral'>    uint16 rate;</span>
  17 |     | <span class='neutral'>    uint8 withdrawFeePercentage;</span>
  18 |     | <span class='neutral'>    uint64 depositTime;</span>
  19 |     | <span class='neutral'>    uint64 endTime;</span>
  20 |     | <span class='neutral'>    uint256 depositAmount;</span>
  21 |     | <span class='neutral'>}</span>
  22 |     | <span class='neutral'></span>
  23 |     | <span class='neutral'>/**</span>
  24 |     | <span class='neutral'> *  @dev Struct to store staking definition basic information</span>
  25 |     | <span class='neutral'> */</span>
  26 |     | <span class='neutral'>struct StakingDefinition {</span>
  27 |     | <span class='neutral'>    uint8 uniqueIdentifier;</span>
  28 |     | <span class='neutral'>    bool enabled;</span>
  29 |     | <span class='neutral'>    uint16 rate;</span>
  30 |     | <span class='neutral'>    uint8 withdrawFeePercentage;</span>
  31 |     | <span class='neutral'>    uint64 withdrawFeeUpdateOn;</span>
  32 |     | <span class='neutral'>    uint32 lockDuration; // in seconds</span>
  33 |     | <span class='neutral'>    bool exists;</span>
  34 |     | <span class='neutral'>    uint8 globalWithdrawFeePercentage;</span>
  35 |     | <span class='neutral'>    bool globalWithdrawFeePercentageEnabled;</span>
  36 |     | <span class='neutral'>    uint32 numberOfActiveStakings;</span>
  37 |     | <span class='neutral'>    string name;    </span>
  38 |     | <span class='neutral'>}</span>
  39 |     | <span class='neutral'></span>
  40 |     | <span class='neutral'>/**</span>
  41 |     | <span class='neutral'> *  @dev Struct to create staking definitions</span>
  42 |     | <span class='neutral'> */</span>
  43 |     | <span class='neutral'>struct StakingDefinitionCreate {</span>
  44 |     | <span class='neutral'>    uint16 rate;</span>
  45 |     | <span class='neutral'>    uint8 withdrawFeePercentage;</span>
  46 |     | <span class='neutral'>    uint32 lockDuration; // in seconds</span>
  47 |     | <span class='neutral'>    string name;    </span>
  48 |     | <span class='neutral'>}</span>
  49 |     | <span class='neutral'></span>
  50 |     | <span class='neutral'>/**</span>
  51 |     | <span class='neutral'> * @dev Struct to get withdrawFeeState</span>
  52 |     | <span class='neutral'>*/</span>
  53 |     | <span class='neutral'>struct WithdrawFeeState {</span>
  54 |     | <span class='neutral'>    uint8 stakingDefinitionId;</span>
  55 |     | <span class='neutral'>    uint8 globalFee;</span>
  56 |     | <span class='neutral'>    bool globalFeeEnabled;</span>
  57 |     | <span class='neutral'>    uint8 depositRecordedFee;</span>
  58 |     | <span class='neutral'>    uint8 depositStatus;</span>
  59 |     | <span class='neutral'>    uint8 withdrawFeeUsed;</span>
  60 |     | <span class='neutral'>}</span>
  61 |     | <span class='neutral'></span>
  62 |     | <span class='neutral'>/**</span>
  63 |     | <span class='neutral'> * @title Staking - stake tokens and earn rewards based on defined staking defintions</span>
  64 |     | <span class='neutral'> * @dev Owner can define up to 30 staking definitions, that number is big, real use cases will have up to 10. </span>
  65 |     | <span class='neutral'> * Users can stake their tokens by choosing one of staking definitions which have defined lockDuration, prematured withdraw fee and rewarde yearly rate.</span>
  66 |     | <span class='neutral'> */</span>
  67 | *   | <span class='executed'>contract Staking is Ownable, ReentrancyGuard {</span>
  68 |     | <span class='neutral'>    using SafeERC20 for IERC20;</span>
  69 |     | <span class='neutral'></span>
  70 | *   | <span class='executed'>    uint8 public constant DEPOSIT_STATUS_NOT_STAKING = 0;</span>
  71 | *   | <span class='executed'>    uint8 public constant DEPOSIT_STATUS_STAKING = 1;</span>
  72 | *   | <span class='executed'>    uint8 public constant DEPOSIT_STATUS_STAKING_WITHDRAWN = 2;</span>
  73 |     | <span class='neutral'></span>
  74 | *   | <span class='executed'>    uint8 public constant MAX_STAKING_DEFINITIONS_SIZE = 30;</span>
  75 |     | <span class='neutral'></span>
  76 | *   | <span class='executed'>    bool public isStopped;</span>
  77 |     | <span class='unexecuted'>    address public treasury;</span>
  78 |     | <span class='unexecuted'>    IERC20 public tokenAddress;</span>
  79 | *   | <span class='executed'>    uint8 public totalStakingDefinitions;</span>
  80 |     | <span class='neutral'></span>
  81 | *   | <span class='executed'>    uint256 public stakedBalance;</span>
  82 |     | <span class='unexecuted'>    uint256 public rewardBalance;</span>
  83 | *   | <span class='executed'>    uint256 public totalActiveStakings;</span>
  84 | *   | <span class='executed'>    uint256 public constant INTEREST_RATE_CONVERTER = 100;</span>
  85 | *   | <span class='executed'>    uint256 public constant YEAR_IN_SECONDS = 31536000;</span>
  86 | *   | <span class='executed'>    uint256 public constant PRECISION_MULTIPLIER = 10_000;</span>
  87 |     | <span class='neutral'></span>
  88 |     | <span class='neutral'>    mapping(address =&gt; mapping(uint8 =&gt; Deposit)) private deposits;</span>
  89 |     | <span class='neutral'>    mapping(uint8 =&gt; StakingDefinition) private stakingDefinitions;</span>
  90 |     | <span class='neutral'>    /**</span>
  91 |     | <span class='neutral'>     *  @notice Emitted when user stakes new value of tokens</span>
  92 |     | <span class='neutral'>     */</span>
  93 |     | <span class='neutral'>    event Staked(address indexed staker, uint8 indexed stakeDefinition, uint64 indexed endTime, uint256 stakedAmount);</span>
  94 |     | <span class='neutral'></span>
  95 |     | <span class='neutral'>    /**</span>
  96 |     | <span class='neutral'>     *  @notice Emitted when user withdraws his deposit</span>
  97 |     | <span class='neutral'>     */</span>
  98 |     | <span class='neutral'>    event PaidOut(address indexed staker, uint256 amount, uint256 reward);</span>
  99 |     | <span class='neutral'></span>
 100 |     | <span class='neutral'>    /**</span>
 101 |     | <span class='neutral'>     *  @notice Emitted when rate is changed</span>
 102 |     | <span class='neutral'>     */</span>
 103 |     | <span class='neutral'>    event RateChanged(uint32 newRate);</span>
 104 |     | <span class='neutral'></span>
 105 |     | <span class='neutral'>    /**</span>
 106 |     | <span class='neutral'>     *  @notice Emitted when lock duration is changed</span>
 107 |     | <span class='neutral'>     */</span>
 108 |     | <span class='neutral'>    event LockDurationChanged(uint32 lockDuration);</span>
 109 |     | <span class='neutral'></span>
 110 |     | <span class='neutral'>    /**</span>
 111 |     | <span class='neutral'>     *  @notice Emitted when new amount of rewards is added to contract</span>
 112 |     | <span class='neutral'>     */</span>
 113 |     | <span class='neutral'>    event RewardsAdded(uint256 amount, uint256 time);</span>
 114 |     | <span class='neutral'></span>
 115 |     | <span class='neutral'>    /**</span>
 116 |     | <span class='neutral'>     *  @notice Emitted when contract is paused/unpaused</span>
 117 |     | <span class='neutral'>     */</span>
 118 |     | <span class='neutral'>    event StakingStatusChanged(bool status, uint256 time);</span>
 119 |     | <span class='neutral'></span>
 120 |     | <span class='neutral'>    /**</span>
 121 |     | <span class='neutral'>     *  @notice Emitted when owner changes withdraw fee</span>
 122 |     | <span class='neutral'>     */</span>
 123 |     | <span class='neutral'>    event WithdrawFeeChanged(uint8 indexed stakingDefinitionId, uint8 newFee);</span>
 124 |     | <span class='neutral'></span>
 125 |     | <span class='neutral'>    /**</span>
 126 |     | <span class='neutral'>     *  @notice Emitted when owner changes global withdraw fee</span>
 127 |     | <span class='neutral'>     */</span>
 128 |     | <span class='neutral'>    event GlobalWithdrawFeeSet(uint8 indexed stakingDefinitionId, uint8 newFee);</span>
 129 |     | <span class='neutral'></span>
 130 |     | <span class='neutral'>    /**</span>
 131 |     | <span class='neutral'>     *  @notice Emitted when owner removes global withdraw fee</span>
 132 |     | <span class='neutral'>     */</span>
 133 |     | <span class='neutral'>    event GlobalWithdrawFeeRemoved(uint8 indexed stakingDefinitionId);</span>
 134 |     | <span class='neutral'></span>
 135 |     | <span class='neutral'>    /**</span>
 136 |     | <span class='neutral'>     *  @notice Emitted when owner enables staking definition</span>
 137 |     | <span class='neutral'>     */</span>
 138 |     | <span class='neutral'>    event StakingDefinitionEnabled(uint8 indexed stakingDefinitionId);</span>
 139 |     | <span class='neutral'></span>
 140 |     | <span class='neutral'>    /**</span>
 141 |     | <span class='neutral'>     *  @notice Emitted when owner disables staking definition</span>
 142 |     | <span class='neutral'>     */</span>
 143 |     | <span class='neutral'>    event StakingDefinitionDisabled(uint8 indexed stakingDefinitionId);</span>
 144 |     | <span class='neutral'></span>
 145 |     | <span class='neutral'>    event StakingDefinitionAdded(uint8 indexed stakingDefinitionId);</span>
 146 |     | <span class='neutral'></span>
 147 | *   | <span class='executed'>    modifier withdrawCheck(uint8 stakingDefinitionId, address from) {</span>
 148 | *   | <span class='executed'>        Deposit memory userDeposit = deposits[from][stakingDefinitionId];</span>
 149 | *   | <span class='executed'>        require(userDeposit.status == DEPOSIT_STATUS_STAKING, &quot;no active staking for stakingId&quot;);</span>
 150 |     | <span class='neutral'>        _;</span>
 151 |     | <span class='neutral'>    }</span>
 152 |     | <span class='neutral'></span>
 153 | *   | <span class='executed'>    modifier hasAllowance(address allower, uint256 amount) {</span>
 154 |     | <span class='neutral'>        // Make sure the allower has provided the right allowance.</span>
 155 | *   | <span class='executed'>        uint256 ourAllowance = tokenAddress.allowance(allower, address(this));</span>
 156 | *   | <span class='executed'>        require(ourAllowance &gt;= amount, &quot;allowance too low&quot;);</span>
 157 |     | <span class='neutral'></span>
 158 |     | <span class='neutral'>        _;</span>
 159 |     | <span class='neutral'>    }</span>
 160 |     | <span class='neutral'></span>
 161 |     | <span class='neutral'>    /**</span>
 162 |     | <span class='neutral'>     *  @param _stakingDefinitions definition of different stakings which user can choose</span>
 163 |     | <span class='neutral'>     *  @param _tokenAddress contract address of the token</span>
 164 |     | <span class='neutral'>     */</span>
 165 |     | <span class='unexecuted'>    constructor(</span>
 166 |     | <span class='neutral'>        StakingDefinitionCreate[] memory _stakingDefinitions,</span>
 167 |     | <span class='neutral'>        IERC20 _tokenAddress,</span>
 168 |     | <span class='neutral'>        address _treasury</span>
 169 |     | <span class='neutral'>    ) Ownable() {</span>
 170 |     | <span class='unexecuted'>        require(address(_tokenAddress) != address(0), &quot;token address is 0&quot;);</span>
 171 |     | <span class='unexecuted'>        require(address(_treasury) != address(0), &quot;treasury address is 0&quot;);</span>
 172 |     | <span class='unexecuted'>        require(_stakingDefinitions.length &lt;= MAX_STAKING_DEFINITIONS_SIZE, &quot;too many staking defs&quot;);</span>
 173 |     | <span class='neutral'></span>
 174 |     | <span class='unexecuted'>        for (uint256 i = 0; i &lt; _stakingDefinitions.length; i++) {</span>
 175 |     | <span class='unexecuted'>            StakingDefinitionCreate memory _stakingDefinition = _stakingDefinitions[i];</span>
 176 |     | <span class='neutral'></span>
 177 |     | <span class='unexecuted'>            require(_stakingDefinition.withdrawFeePercentage &lt;= 100, &quot;withdraw perct too big&quot;);</span>
 178 |     | <span class='unexecuted'>            require(_stakingDefinition.rate &lt;= 1000, &quot;rate too big&quot;);</span>
 179 |     | <span class='neutral'>            </span>
 180 |     | <span class='unexecuted'>            uint8 uqIdentifier = uint8(i);</span>
 181 |     | <span class='unexecuted'>            stakingDefinitions[uqIdentifier] = StakingDefinition({</span>
 182 |     | <span class='unexecuted'>                uniqueIdentifier: uqIdentifier,</span>
 183 |     | <span class='unexecuted'>                enabled: true,</span>
 184 |     | <span class='unexecuted'>                rate: _stakingDefinition.rate,</span>
 185 |     | <span class='unexecuted'>                withdrawFeePercentage: _stakingDefinition.withdrawFeePercentage,</span>
 186 |     | <span class='unexecuted'>                withdrawFeeUpdateOn: uint64(block.timestamp),</span>
 187 |     | <span class='unexecuted'>                lockDuration: _stakingDefinition.lockDuration,</span>
 188 |     | <span class='unexecuted'>                exists: true,</span>
 189 |     | <span class='unexecuted'>                globalWithdrawFeePercentage: 0,</span>
 190 |     | <span class='unexecuted'>                globalWithdrawFeePercentageEnabled: false,</span>
 191 |     | <span class='unexecuted'>                numberOfActiveStakings: 0,</span>
 192 |     | <span class='unexecuted'>                name: _stakingDefinition.name</span>
 193 |     | <span class='neutral'>            });</span>
 194 |     | <span class='neutral'></span>
 195 |     | <span class='unexecuted'>            totalStakingDefinitions++;</span>
 196 |     | <span class='neutral'>        }</span>
 197 |     | <span class='unexecuted'>        assert(_stakingDefinitions.length == totalStakingDefinitions);</span>
 198 |     | <span class='neutral'></span>
 199 |     | <span class='unexecuted'>        tokenAddress = _tokenAddress;</span>
 200 |     | <span class='unexecuted'>        treasury = _treasury;</span>
 201 |     | <span class='neutral'>    }</span>
 202 |     | <span class='neutral'></span>
 203 |     | <span class='neutral'>    /**</span>
 204 |     | <span class='neutral'>     *  @notice only owner can add new staking definition</span>
 205 |     | <span class='neutral'>     *  @param _stakingDefinition staking definition to add</span>
 206 |     | <span class='neutral'>     */</span>
 207 | *   | <span class='executed'>    function addStakingDefinition(StakingDefinitionCreate memory _stakingDefinition) external onlyOwner {</span>
 208 | *   | <span class='executed'>        require(totalStakingDefinitions &lt; MAX_STAKING_DEFINITIONS_SIZE, &quot;too many staking defs&quot;);</span>
 209 |     | <span class='neutral'></span>
 210 | *   | <span class='executed'>        uint8 uqIdentifier = totalStakingDefinitions;</span>
 211 | *   | <span class='executed'>        stakingDefinitions[uqIdentifier] = StakingDefinition({</span>
 212 | *   | <span class='executed'>            uniqueIdentifier: uqIdentifier,</span>
 213 | *   | <span class='executed'>            enabled: true,</span>
 214 | *   | <span class='executed'>            rate: _stakingDefinition.rate,</span>
 215 | *   | <span class='executed'>            withdrawFeePercentage: _stakingDefinition.withdrawFeePercentage,</span>
 216 | *   | <span class='executed'>            withdrawFeeUpdateOn: uint64(block.timestamp),</span>
 217 | *   | <span class='executed'>            lockDuration: _stakingDefinition.lockDuration,</span>
 218 | *   | <span class='executed'>            exists: true,</span>
 219 | *   | <span class='executed'>            globalWithdrawFeePercentage: 0,</span>
 220 | *   | <span class='executed'>            globalWithdrawFeePercentageEnabled: false,</span>
 221 | *   | <span class='executed'>            numberOfActiveStakings: 0,</span>
 222 | *   | <span class='executed'>            name: _stakingDefinition.name</span>
 223 |     | <span class='neutral'>        });</span>
 224 |     | <span class='neutral'></span>
 225 | *   | <span class='executed'>        totalStakingDefinitions++;</span>
 226 |     | <span class='neutral'></span>
 227 | *   | <span class='executed'>        emit StakingDefinitionAdded(uqIdentifier);</span>
 228 |     | <span class='neutral'>    }</span>
 229 |     | <span class='neutral'></span>
 230 |     | <span class='neutral'>    /**</span>
 231 |     | <span class='neutral'>     *  @notice only owner can add custom withdraw fee for user to override one form deposit struct</span>
 232 |     | <span class='neutral'>     *  @param _stakingDefinitionId staking definitionId</span>
 233 |     | <span class='neutral'>     *  @param _feePercentage withdraw fee percentage</span>
 234 |     | <span class='neutral'>     */</span>
 235 | *   | <span class='executed'>    function setGlobalWithdrawFeeForStakingDefinition(uint8 _stakingDefinitionId, uint8 _feePercentage) external onlyOwner {</span>
 236 | *   | <span class='executed'>        require(_stakingDefinitionId &lt; totalStakingDefinitions, &quot;_stakingDefinitionId not exist&quot;);</span>
 237 | *   | <span class='executed'>        require(_feePercentage &lt;= 100, &quot;percentage too big&quot;);</span>
 238 |     | <span class='neutral'></span>
 239 | *   | <span class='executed'>        StakingDefinition storage stakingDefinition = stakingDefinitions[_stakingDefinitionId];</span>
 240 | *   | <span class='executed'>        require(stakingDefinition.exists, &quot;stakingDefinition not exist&quot;);</span>
 241 |     | <span class='neutral'></span>
 242 | *   | <span class='executed'>        stakingDefinition.globalWithdrawFeePercentage = _feePercentage;</span>
 243 | *   | <span class='executed'>        stakingDefinition.globalWithdrawFeePercentageEnabled = true;</span>
 244 |     | <span class='neutral'></span>
 245 | *   | <span class='executed'>        emit GlobalWithdrawFeeSet(_stakingDefinitionId, _feePercentage);</span>
 246 |     | <span class='neutral'>    }</span>
 247 |     | <span class='neutral'></span>
 248 |     | <span class='neutral'>    /**</span>
 249 |     | <span class='neutral'>     *  @notice only owner can remove custom withdraw fee for user</span>
 250 |     | <span class='neutral'>     *  @param _stakingDefinitionId staking definitionId</span>
 251 |     | <span class='neutral'>     */</span>
 252 | *   | <span class='executed'>    function removeGlobalWithdrawFeeForStakingDefinition(uint8 _stakingDefinitionId) external onlyOwner {</span>
 253 | *   | <span class='executed'>        require(_stakingDefinitionId &lt; totalStakingDefinitions, &quot;_stakingDefinitionId not exist&quot;);</span>
 254 | *   | <span class='executed'>        StakingDefinition storage stakingDefinition = stakingDefinitions[_stakingDefinitionId];</span>
 255 | *   | <span class='executed'>        require(stakingDefinition.exists, &quot;stakingDefinition not exist&quot;);</span>
 256 |     | <span class='neutral'></span>
 257 | *   | <span class='executed'>        stakingDefinition.globalWithdrawFeePercentage = 1; //cheaper to set it to non zero. On addGlobalWithdrawFeeForStakingDefinition will be overwritten</span>
 258 | *   | <span class='executed'>        stakingDefinition.globalWithdrawFeePercentageEnabled = false;</span>
 259 |     | <span class='neutral'></span>
 260 | *   | <span class='executed'>        emit GlobalWithdrawFeeRemoved(_stakingDefinitionId);</span>
 261 |     | <span class='neutral'>    }</span>
 262 |     | <span class='neutral'></span>
 263 |     | <span class='neutral'>    /**</span>
 264 |     | <span class='neutral'>     *  @notice only owner can change current withdraw fee for stakers</span>
 265 |     | <span class='neutral'>     *  @param _stakingDefinitionId staking definition id</span>
 266 |     | <span class='neutral'>     *  @param _percentage withdraw fee percentage</span>
 267 |     | <span class='neutral'>     */</span>
 268 | *   | <span class='executed'>    function setWithdrawFee(uint8 _stakingDefinitionId, uint8 _percentage) external onlyOwner {</span>
 269 | *   | <span class='executed'>        require(_percentage &lt;= 100, &quot;percentage too big&quot;);</span>
 270 |     | <span class='neutral'></span>
 271 | *   | <span class='executed'>        StakingDefinition storage stakingDefinition = stakingDefinitions[_stakingDefinitionId]; </span>
 272 | *   | <span class='executed'>        require(stakingDefinition.exists, &quot;staking def not exist&quot;);</span>
 273 |     | <span class='neutral'></span>
 274 | *   | <span class='executed'>        stakingDefinition.withdrawFeePercentage = _percentage;</span>
 275 | *   | <span class='executed'>        stakingDefinition.withdrawFeeUpdateOn = uint64(block.timestamp);</span>
 276 |     | <span class='neutral'>        </span>
 277 | *   | <span class='executed'>        emit WithdrawFeeChanged(_stakingDefinitionId, _percentage);</span>
 278 |     | <span class='neutral'>    }</span>
 279 |     | <span class='neutral'></span>
 280 |     | <span class='neutral'>    /**</span>
 281 |     | <span class='neutral'>     *  @notice only owner can enable or disable staking definition</span>
 282 |     | <span class='neutral'>     *  @param _stakingDefinitionId staking definitionId</span>
 283 |     | <span class='neutral'>     */</span>
 284 | *   | <span class='executed'>    function enableStakingDefinition(uint8 _stakingDefinitionId) external onlyOwner {</span>
 285 | *   | <span class='executed'>        require(_stakingDefinitionId &lt; totalStakingDefinitions, &quot;_stakingDefinitionId not exist&quot;);</span>
 286 |     | <span class='neutral'></span>
 287 | *   | <span class='executed'>        StakingDefinition storage stakingDefinition = stakingDefinitions[_stakingDefinitionId];</span>
 288 | *   | <span class='executed'>        require(stakingDefinition.exists, &quot;stakingDefinition not exist&quot;);</span>
 289 |     | <span class='neutral'></span>
 290 | *   | <span class='executed'>        stakingDefinition.enabled = true;</span>
 291 |     | <span class='neutral'>        </span>
 292 | *   | <span class='executed'>        emit StakingDefinitionEnabled(_stakingDefinitionId);</span>
 293 |     | <span class='neutral'>    }</span>
 294 |     | <span class='neutral'></span>
 295 |     | <span class='neutral'>    /**</span>
 296 |     | <span class='neutral'>     *  @notice only owner can disable staking definition</span>
 297 |     | <span class='neutral'>     *  @param _stakingDefinitionId staking definitionId</span>
 298 |     | <span class='neutral'>     */</span>
 299 | *   | <span class='executed'>    function disableStakingDefinition(uint8 _stakingDefinitionId) external onlyOwner {</span>
 300 | *   | <span class='executed'>        require(_stakingDefinitionId &lt; totalStakingDefinitions, &quot;_stakingDefinitionId not exist&quot;);</span>
 301 |     | <span class='neutral'></span>
 302 | *   | <span class='executed'>        StakingDefinition storage stakingDefinition = stakingDefinitions[_stakingDefinitionId];</span>
 303 | *   | <span class='executed'>        require(stakingDefinition.exists, &quot;stakingDefinition not exist&quot;);</span>
 304 |     | <span class='neutral'></span>
 305 | *   | <span class='executed'>        stakingDefinition.enabled = false;</span>
 306 |     | <span class='neutral'>        </span>
 307 | *   | <span class='executed'>        emit StakingDefinitionDisabled(_stakingDefinitionId);</span>
 308 |     | <span class='neutral'>    }</span>
 309 |     | <span class='neutral'></span>
 310 |     | <span class='neutral'>    /**</span>
 311 |     | <span class='neutral'>     *  @notice only owner can change current name </span>
 312 |     | <span class='neutral'>     *  @param _stakingDefinitionId id of staking definition</span>
 313 |     | <span class='neutral'>     *  @param _name name of the staking contract</span>
 314 |     | <span class='neutral'>     */</span>
 315 |     | <span class='unexecuted'>    function setName(uint8 _stakingDefinitionId, string calldata _name) external onlyOwner {</span>
 316 |     | <span class='unexecuted'>        StakingDefinition storage stakingDefinition = stakingDefinitions[_stakingDefinitionId]; </span>
 317 |     | <span class='unexecuted'>        require(stakingDefinition.exists, &quot;staking def not exist&quot;);</span>
 318 |     | <span class='neutral'></span>
 319 |     | <span class='unexecuted'>        stakingDefinition.name = _name;</span>
 320 |     | <span class='neutral'>    }</span>
 321 |     | <span class='neutral'></span>
 322 |     | <span class='neutral'>    /**</span>
 323 |     | <span class='neutral'>     *  @notice only owner can change current name </span>
 324 |     | <span class='neutral'>     *  @param _tresury tresury where withdraw fee will go</span>
 325 |     | <span class='neutral'>     */</span>
 326 |     | <span class='unexecuted'>    function setTreasury(address _tresury) external onlyOwner {</span>
 327 |     | <span class='unexecuted'>        treasury = _tresury;</span>
 328 |     | <span class='neutral'>    }</span>
 329 |     | <span class='neutral'></span>
 330 |     | <span class='neutral'>    /**</span>
 331 |     | <span class='neutral'>     *  @notice to set new interest rates for staking definition</span>
 332 |     | <span class='neutral'>     *  @param _stakingDefinitionId id of staking definition</span>
 333 |     | <span class='neutral'>     *  @param _rate New effective interest rate</span>
 334 |     | <span class='neutral'>     */</span>
 335 | *   | <span class='executed'>    function setRate(uint8 _stakingDefinitionId, uint16 _rate) external onlyOwner {</span>
 336 | *   | <span class='executed'>        StakingDefinition storage stakingDefinition = stakingDefinitions[_stakingDefinitionId]; </span>
 337 | *   | <span class='executed'>        require(stakingDefinition.exists, &quot;staking def not exist&quot;);</span>
 338 | *   | <span class='executed'>        require(_rate &lt;= 1000, &quot;rate too big&quot;);</span>
 339 |     | <span class='neutral'></span>
 340 | *   | <span class='executed'>        stakingDefinition.rate = _rate;</span>
 341 |     | <span class='neutral'></span>
 342 | *   | <span class='executed'>        emit RateChanged(_rate);</span>
 343 |     | <span class='neutral'>    }</span>
 344 |     | <span class='neutral'></span>
 345 |     | <span class='neutral'>    /**</span>
 346 |     | <span class='neutral'>     *  @notice to set new interest rates for staking definition</span>
 347 |     | <span class='neutral'>     *  @param _stakingDefinitionId id of staking definition</span>
 348 |     | <span class='neutral'>     *  @param _lockDuration New locak duration for new deposits which will be created</span>
 349 |     | <span class='neutral'>     *  @dev lockduration is in seconds. 2^32 - 1, max duration, which is ~106years in seconds.</span>
 350 |     | <span class='neutral'>     */</span>
 351 | *   | <span class='executed'>    function setLockDuration(uint8 _stakingDefinitionId, uint32 _lockDuration) external onlyOwner {</span>
 352 | *   | <span class='executed'>        StakingDefinition storage stakingDefinition = stakingDefinitions[_stakingDefinitionId]; </span>
 353 | *   | <span class='executed'>        require(stakingDefinition.exists, &quot;staking def not exist&quot;);</span>
 354 |     | <span class='neutral'></span>
 355 | *   | <span class='executed'>        stakingDefinition.lockDuration = _lockDuration;</span>
 356 |     | <span class='neutral'></span>
 357 | *   | <span class='executed'>        emit LockDurationChanged(_lockDuration);</span>
 358 |     | <span class='neutral'>    }</span>
 359 |     | <span class='neutral'></span>
 360 |     | <span class='neutral'>    /**</span>
 361 |     | <span class='neutral'>     *  @param _status contract status</span>
 362 |     | <span class='neutral'>     *  @dev if isStopped is is set to true contract will be stopped,</span>
 363 |     | <span class='neutral'>     */</span>
 364 | *   | <span class='executed'>    function changeIsStoppedStatus(bool _status) external onlyOwner {</span>
 365 | *   | <span class='executed'>        isStopped = _status;</span>
 366 |     | <span class='neutral'></span>
 367 | *   | <span class='executed'>        emit StakingStatusChanged(_status, block.timestamp);</span>
 368 |     | <span class='neutral'>    }</span>
 369 |     | <span class='neutral'></span>
 370 |     | <span class='neutral'>    /**</span>
 371 |     | <span class='neutral'>     *  @param amount Amount to be staked</span>
 372 |     | <span class='neutral'>     *  @param _stakingDefinitionId id of staking definition</span>
 373 |     | <span class='neutral'>     *  @dev to stake &#39;amount&#39; value of tokens</span>
 374 |     | <span class='neutral'>     *  once the user has given allowance to the staking contract user can call this function.</span>
 375 |     | <span class='neutral'>     */</span>
 376 | *   | <span class='executed'>    function stake(uint8 _stakingDefinitionId, uint256 amount) external nonReentrant hasAllowance(_msgSender(), amount) {</span>
 377 | *   | <span class='executed'>        require(amount &gt; 0, &quot;amount is zero&quot;);</span>
 378 | *   | <span class='executed'>        require(!isStopped, &quot;staking is stopped&quot;);</span>
 379 |     | <span class='neutral'></span>
 380 | *   | <span class='executed'>        StakingDefinition storage stakingDefinition = stakingDefinitions[_stakingDefinitionId]; </span>
 381 | *   | <span class='executed'>        require(stakingDefinition.exists, &quot;staking def not exist&quot;);</span>
 382 | *   | <span class='executed'>        require(stakingDefinition.enabled, &quot;staking def not enabled&quot;);</span>
 383 |     | <span class='neutral'></span>
 384 | *   | <span class='executed'>        address from = _msgSender();</span>
 385 |     | <span class='neutral'></span>
 386 | *   | <span class='executed'>        Deposit storage userDeposit = deposits[from][_stakingDefinitionId];</span>
 387 | *   | <span class='executed'>        bool isThereActiveStaking = userDeposit.status == DEPOSIT_STATUS_STAKING;</span>
 388 |     | <span class='neutral'></span>
 389 | *   | <span class='executed'>        if(isThereActiveStaking) {</span>
 390 | *   | <span class='executed'>            require(userDeposit.endTime &gt; block.timestamp, &quot;maturity expired. please withdraw&quot;);</span>
 391 |     | <span class='neutral'>        }</span>
 392 |     | <span class='neutral'></span>
 393 | *   | <span class='executed'>        tokenAddress.safeTransferFrom(from, address(this), amount);</span>
 394 |     | <span class='neutral'></span>
 395 | *   | <span class='executed'>        uint256 newAmount;</span>
 396 | *   | <span class='executed'>        if (isThereActiveStaking) {</span>
 397 | *   | <span class='executed'>            uint256 currentReward = _calculateInterest(userDeposit, block.timestamp);</span>
 398 | *   | <span class='executed'>            newAmount = amount + deposits[from][_stakingDefinitionId].depositAmount + currentReward;</span>
 399 | *   | <span class='executed'>            stakedBalance = stakedBalance + amount + currentReward;</span>
 400 |     | <span class='neutral'>        } else {</span>
 401 | *   | <span class='executed'>            newAmount = amount;</span>
 402 | *   | <span class='executed'>            totalActiveStakings += 1;</span>
 403 | *   | <span class='executed'>            stakingDefinition.numberOfActiveStakings += 1;</span>
 404 | *   | <span class='executed'>            stakedBalance = stakedBalance + amount;</span>
 405 |     | <span class='neutral'>        }</span>
 406 |     | <span class='neutral'></span>
 407 | *   | <span class='executed'>        userDeposit.stakingDefinitionId = _stakingDefinitionId;</span>
 408 | *   | <span class='executed'>        userDeposit.status = DEPOSIT_STATUS_STAKING;</span>
 409 | *   | <span class='executed'>        userDeposit.rate = stakingDefinition.rate;</span>
 410 | *   | <span class='executed'>        userDeposit.withdrawFeePercentage = stakingDefinition.withdrawFeePercentage;</span>
 411 | *   | <span class='executed'>        userDeposit.depositTime = uint64(block.timestamp);</span>
 412 | *   | <span class='executed'>        userDeposit.endTime = uint64(block.timestamp + stakingDefinition.lockDuration);</span>
 413 | *   | <span class='executed'>        userDeposit.depositAmount = newAmount;</span>
 414 |     | <span class='neutral'></span>
 415 | *   | <span class='executed'>        emit Staked(from, _stakingDefinitionId, userDeposit.endTime, amount);</span>
 416 |     | <span class='neutral'>    }</span>
 417 |     | <span class='neutral'></span>
 418 |     | <span class='neutral'>    /**</span>
 419 |     | <span class='neutral'>     * @notice user who is staking can withdraw their deposit. </span>
 420 |     | <span class='neutral'>     * @dev based on user state, if there is premature withdrawal fee will be calculated and if there are rewards, </span>
 421 |     | <span class='neutral'>     * it will be added to amount sent to user</span>
 422 |     | <span class='neutral'>     * @param _stakingDefinitionId id of staking definition </span>
 423 |     | <span class='neutral'>     */</span>
 424 | *   | <span class='executed'>    function withdraw(uint8 _stakingDefinitionId) nonReentrant external withdrawCheck(_stakingDefinitionId, _msgSender()) {</span>
 425 | *   | <span class='executed'>        address from = _msgSender();</span>
 426 |     | <span class='neutral'></span>
 427 | *   | <span class='executed'>        StakingDefinition storage stakingDefinition = stakingDefinitions[_stakingDefinitionId]; </span>
 428 | *   | <span class='executed'>        Deposit storage userDeposit = deposits[from][_stakingDefinitionId];</span>
 429 |     | <span class='neutral'></span>
 430 | *   | <span class='executed'>        uint256 endTime = Math.min(block.timestamp, userDeposit.endTime);</span>
 431 | *   | <span class='executed'>        uint256 reward = _calculateInterest(userDeposit, endTime);</span>
 432 |     | <span class='neutral'></span>
 433 | *   | <span class='executed'>        require(rewardBalance &gt;= reward, &quot;rewardBalance is too low&quot;);</span>
 434 |     | <span class='neutral'></span>
 435 | *   | <span class='executed'>        uint256 penalty = calculateWithdrawFee(_stakingDefinitionId, from);</span>
 436 |     | <span class='neutral'></span>
 437 | *   | <span class='executed'>        uint256 amount = userDeposit.depositAmount;</span>
 438 | *   | <span class='executed'>        uint256 amountAfterPenalty = amount - penalty;</span>
 439 |     | <span class='neutral'></span>
 440 | *   | <span class='executed'>        require(stakedBalance &gt;= amount, &quot;stakedBalance less than depositAmount&quot;);</span>
 441 | *   | <span class='executed'>        require(rewardBalance &gt;= reward, &quot;rewardBalance less than reward&quot;);</span>
 442 |     | <span class='neutral'></span>
 443 | *   | <span class='executed'>        stakedBalance = stakedBalance - amount;</span>
 444 | *   | <span class='executed'>        rewardBalance = rewardBalance - reward;</span>
 445 |     | <span class='neutral'></span>
 446 | *   | <span class='executed'>        userDeposit.status = DEPOSIT_STATUS_STAKING_WITHDRAWN;</span>
 447 | *   | <span class='executed'>        stakingDefinition.numberOfActiveStakings -= 1;</span>
 448 | *   | <span class='executed'>        totalActiveStakings -= 1;</span>
 449 |     | <span class='neutral'></span>
 450 |     | <span class='neutral'>        // send user his deposit</span>
 451 | *   | <span class='executed'>        tokenAddress.safeTransfer(from, amountAfterPenalty + reward);</span>
 452 | *   | <span class='executed'>        if (penalty &gt; 0) {</span>
 453 |     | <span class='neutral'>            // send any penalty to treasury wallet</span>
 454 | *   | <span class='executed'>            tokenAddress.safeTransfer(treasury, penalty);</span>
 455 |     | <span class='neutral'>        }</span>
 456 |     | <span class='neutral'></span>
 457 | *   | <span class='executed'>        emit PaidOut(from, amountAfterPenalty, reward);</span>
 458 |     | <span class='neutral'>    }</span>
 459 |     | <span class='neutral'></span>
 460 |     | <span class='neutral'>    /**</span>
 461 |     | <span class='neutral'>     * @param _stakingDefinitionId id of staking definition</span>
 462 |     | <span class='neutral'>     * @param _userAddress user address</span>
 463 |     | <span class='neutral'>     * @dev returns user deposit struct. </span>
 464 |     | <span class='neutral'>     * User status can be:</span>
 465 |     | <span class='neutral'>     * DEPOSIT_STATUS_NOT_STAKING = 0; DEPOSIT_STATUS_STAKING = 1; DEPOSIT_STATUS_STAKING_WITHDRAWN = 2;</span>
 466 |     | <span class='neutral'>     * 0 is if there is no current staking, 1 is if there is active deposit and 2 is if tehre is paidout deposit.</span>
 467 |     | <span class='neutral'>     */</span>
 468 | *   | <span class='executed'>    function getUserDeposit(uint8 _stakingDefinitionId, address _userAddress) external view returns (Deposit memory userDeposit) {</span>
 469 | *   | <span class='executed'>        userDeposit = deposits[_userAddress][_stakingDefinitionId];</span>
 470 |     | <span class='neutral'>    }</span>
 471 |     | <span class='neutral'></span>
 472 |     | <span class='neutral'>    /**</span>
 473 |     | <span class='neutral'>     *  @param _stakingDefinitionId id of staking definition</span>
 474 |     | <span class='neutral'>     *  @param _userAddress user address</span>
 475 |     | <span class='neutral'>     *  @dev return flag if user is having active staking deposit</span>
 476 |     | <span class='neutral'>     */</span>
 477 | *   | <span class='executed'>    function doesUserHaveActiveStake(uint8 _stakingDefinitionId, address _userAddress) public view returns (bool) {</span>
 478 | *   | <span class='executed'>        Deposit memory userDeposit = deposits[_userAddress][_stakingDefinitionId];</span>
 479 |     | <span class='neutral'></span>
 480 | *   | <span class='executed'>        return userDeposit.status == DEPOSIT_STATUS_STAKING;</span>
 481 |     | <span class='neutral'>    }</span>
 482 |     | <span class='neutral'></span>
 483 |     | <span class='neutral'>    /**</span>
 484 |     | <span class='neutral'>     * @dev get user staking definition for byUniqueId</span>
 485 |     | <span class='neutral'>     * @param _stakingDefinitionId id of staking definition </span>
 486 |     | <span class='neutral'>    */ </span>
 487 | *   | <span class='executed'>    function getStakingDefinition(uint8 _stakingDefinitionId) public view returns (StakingDefinition memory) {</span>
 488 | *   | <span class='executed'>        StakingDefinition memory stakingDefinition = stakingDefinitions[_stakingDefinitionId]; </span>
 489 | *   | <span class='executed'>        require(stakingDefinition.exists, &quot;SD: staking def not exist&quot;);</span>
 490 |     | <span class='neutral'></span>
 491 | *   | <span class='executed'>        return stakingDefinition;</span>
 492 |     | <span class='neutral'>    }</span>
 493 |     | <span class='neutral'></span>
 494 |     | <span class='neutral'>    /**</span>
 495 |     | <span class='neutral'>        @dev get contract token state</span>
 496 |     | <span class='neutral'>    */ </span>
 497 | *   | <span class='executed'>    function getContractState() public view returns (uint256 recordedStakingBalance, uint256 recordedRewardBalance, uint256 actualTokenBalance) {</span>
 498 | *   | <span class='executed'>        recordedStakingBalance = stakedBalance;</span>
 499 | *   | <span class='executed'>        recordedRewardBalance = rewardBalance;</span>
 500 | *   | <span class='executed'>        actualTokenBalance = tokenAddress.balanceOf(address(this));</span>
 501 |     | <span class='neutral'>    }</span>
 502 |     | <span class='neutral'></span>
 503 |     | <span class='neutral'>    /**</span>
 504 |     | <span class='neutral'>     * @notice Calcule withdraw penalty for user if deposit is withdrawn now</span>
 505 |     | <span class='neutral'>     * @param _stakingDefinitionId id of staking definition </span>
 506 |     | <span class='neutral'>     * @param user which is staking. If it is no staking fee is 0</span>
 507 |     | <span class='neutral'>     */</span>
 508 | *   | <span class='executed'>    function calculateWithdrawFee(uint8 _stakingDefinitionId, address user) public view returns (uint256 withdrawFee) {</span>
 509 | *   | <span class='executed'>        StakingDefinition memory stakingDefinition = stakingDefinitions[_stakingDefinitionId];</span>
 510 | *   | <span class='executed'>        require(stakingDefinition.exists, &quot;stakingDefinition not exist&quot;);</span>
 511 |     | <span class='neutral'></span>
 512 | *   | <span class='executed'>        Deposit memory userDeposit = deposits[user][_stakingDefinitionId];</span>
 513 | *   | <span class='executed'>        if (block.timestamp &gt; userDeposit.endTime) {</span>
 514 | *   | <span class='executed'>            return 0;</span>
 515 |     | <span class='neutral'>        }</span>
 516 | *   | <span class='executed'>        WithdrawFeeState memory withdrawFeeState = withdrawFeePercentageState(stakingDefinition.uniqueIdentifier, user);</span>
 517 |     | <span class='neutral'></span>
 518 | *   | <span class='executed'>        withdrawFee = (userDeposit.depositAmount * withdrawFeeState.withdrawFeeUsed * PRECISION_MULTIPLIER) / (INTEREST_RATE_CONVERTER * PRECISION_MULTIPLIER);</span>
 519 |     | <span class='neutral'>    }</span>
 520 |     | <span class='neutral'></span>
 521 |     | <span class='neutral'>    /**</span>
 522 |     | <span class='neutral'>     * @dev Calcule withdraw fee state. We will get details what fee is used for sent user and staking definition</span>
 523 |     | <span class='neutral'>     *  at the moment and all other values, like globalFee, deposit recored fee.</span>
 524 |     | <span class='neutral'>     * @param _stakingDefinitionId id of staking definition </span>
 525 |     | <span class='neutral'>     * @param user which is staking.</span>
 526 |     | <span class='neutral'>     */</span>
 527 | *   | <span class='executed'>    function withdrawFeePercentageState(uint8 _stakingDefinitionId, address user) public view returns (WithdrawFeeState memory withdrawFeeState) {</span>
 528 | *   | <span class='executed'>        StakingDefinition memory stakingDefinition = stakingDefinitions[_stakingDefinitionId];</span>
 529 | *   | <span class='executed'>        require(stakingDefinition.exists, &quot;stakingDefinition not exist&quot;);</span>
 530 |     | <span class='neutral'></span>
 531 | *   | <span class='executed'>        Deposit memory userDeposit = deposits[user][_stakingDefinitionId];</span>
 532 | *   | <span class='executed'>        uint8 withdrawFeePercentage = stakingDefinition.globalWithdrawFeePercentageEnabled ? stakingDefinition.globalWithdrawFeePercentage : userDeposit.withdrawFeePercentage;</span>
 533 |     | <span class='neutral'></span>
 534 | *   | <span class='executed'>        return WithdrawFeeState({</span>
 535 | *   | <span class='executed'>            stakingDefinitionId: stakingDefinition.uniqueIdentifier,</span>
 536 | *   | <span class='executed'>            globalFee: stakingDefinition.globalWithdrawFeePercentage,</span>
 537 | *   | <span class='executed'>            globalFeeEnabled: stakingDefinition.globalWithdrawFeePercentageEnabled,</span>
 538 | *   | <span class='executed'>            depositRecordedFee: userDeposit.withdrawFeePercentage,</span>
 539 | *   | <span class='executed'>            depositStatus: userDeposit.status,</span>
 540 | *   | <span class='executed'>            withdrawFeeUsed: withdrawFeePercentage</span>
 541 |     | <span class='neutral'>        });        </span>
 542 |     | <span class='neutral'>    }</span>
 543 |     | <span class='neutral'></span>
 544 |     | <span class='neutral'>    /**</span>
 545 |     | <span class='neutral'>     *  @param rewardAmount rewards to be added to the staking contract</span>
 546 |     | <span class='neutral'>     *  @dev to add rewards to the staking contract</span>
 547 |     | <span class='neutral'>     *  once the allowance is given to this contract for &#39;rewardAmount&#39; by the user</span>
 548 |     | <span class='neutral'>     */</span>
 549 | *   | <span class='executed'>    function addReward(uint256 rewardAmount) external nonReentrant hasAllowance(_msgSender(), rewardAmount) {</span>
 550 | *   | <span class='executed'>        require(rewardAmount &gt; 0, &quot;rewardAmount is zero&quot;);</span>
 551 |     | <span class='neutral'></span>
 552 | *   | <span class='executed'>        tokenAddress.safeTransferFrom(_msgSender(), address(this), rewardAmount);</span>
 553 | *   | <span class='executed'>        rewardBalance = rewardBalance + rewardAmount;</span>
 554 |     | <span class='neutral'></span>
 555 | *   | <span class='executed'>        emit RewardsAdded(rewardAmount, block.timestamp);</span>
 556 |     | <span class='neutral'>    }</span>
 557 |     | <span class='neutral'></span>
 558 |     | <span class='neutral'>    /**</span>
 559 |     | <span class='neutral'>     * @notice rescue any token accidentally sent to this contract</span>
 560 |     | <span class='neutral'>     */</span>
 561 | *   | <span class='executed'>    function emergencyWithdrawToken(IERC20 token) external onlyOwner {</span>
 562 | *   | <span class='executed'>        token.safeTransfer(_msgSender(), token.balanceOf(address(this)));</span>
 563 |     | <span class='neutral'>    }</span>
 564 |     | <span class='neutral'></span>
 565 |     | <span class='neutral'>    /** </span>
 566 |     | <span class='neutral'>     * @param _stakingDefinitionId id of staking definition </span>
 567 |     | <span class='neutral'>     * @param user User wallet address</span>
 568 |     | <span class='neutral'>     * @return totalRewards Rewards from staking if user waits for maturity/end date</span>
 569 |     | <span class='neutral'>     * @return currentRewards Rewards from staking if user decide to withdraw right now</span>
 570 |     | <span class='neutral'>     */</span>
 571 | *   | <span class='executed'>    function calculateRewards(uint8 _stakingDefinitionId, address user) external view returns (uint256 totalRewards, uint256 currentRewards) {</span>
 572 | *   | <span class='executed'>        Deposit memory userDeposit = deposits[user][_stakingDefinitionId];</span>
 573 |     | <span class='neutral'></span>
 574 | *   | <span class='executed'>        totalRewards = _calculateInterest(userDeposit, userDeposit.endTime);</span>
 575 | *   | <span class='executed'>        currentRewards = _calculateInterest(userDeposit, Math.min(block.timestamp, userDeposit.endTime));</span>
 576 |     | <span class='neutral'>    }</span>
 577 |     | <span class='neutral'></span>
 578 |     | <span class='neutral'>    /**</span>
 579 |     | <span class='neutral'>     * @notice As uniswap sync() methodforce rewardBalance to include any token balance added accidentally</span>
 580 |     | <span class='neutral'>     */</span>
 581 | *   | <span class='executed'>    function sync() external onlyOwner nonReentrant {</span>
 582 | *   | <span class='executed'>        uint256 actualTokenBalance = tokenAddress.balanceOf(address(this));</span>
 583 | *   | <span class='executed'>        require(actualTokenBalance &gt;= stakedBalance + rewardBalance, &quot;invalid balance state for sync&quot;);</span>
 584 |     | <span class='neutral'></span>
 585 | *   | <span class='executed'>        rewardBalance = actualTokenBalance - stakedBalance;</span>
 586 |     | <span class='neutral'>    }</span>
 587 |     | <span class='neutral'></span>
 588 | *   | <span class='executed'>    function _calculateInterest(Deposit memory deposit, uint256 endTime) private pure returns (uint256 interest) {</span>
 589 | *   | <span class='executed'>        if (!(deposit.status == DEPOSIT_STATUS_STAKING)) return 0;</span>
 590 | *   | <span class='executed'>        if (endTime &lt;= deposit.depositTime) return 0;</span>
 591 |     | <span class='neutral'></span>
 592 | *   | <span class='executed'>        uint256 timePassed = endTime - deposit.depositTime;</span>
 593 |     | <span class='neutral'></span>
 594 | *   | <span class='executed'>        uint256 totalRewardCalculationDividend = deposit.depositAmount * deposit.rate * timePassed * PRECISION_MULTIPLIER;</span>
 595 | *   | <span class='executed'>        uint256 totalRewardCalculationDivisor = YEAR_IN_SECONDS * INTEREST_RATE_CONVERTER * PRECISION_MULTIPLIER;</span>
 596 | *   | <span class='executed'>        interest = totalRewardCalculationDividend / totalRewardCalculationDivisor;</span>
 597 |     | <span class='neutral'>    }</span>
 598 |     | <span class='neutral'>}</span>
 599 |     | <span class='neutral'></span>

</code>
<br />

<b>/Users/mozzer/development/blockchain/ordinalspad/ordify-contracts/test/echidna/assertion/staking/StakingEchidna.sol</b>
<code>
   1 |     | <span class='neutral'>// SPDX-License Identifier:MIT</span>
   2 |     | <span class='neutral'>pragma solidity 0.8.19;</span>
   3 |     | <span class='neutral'></span>
   4 |     | <span class='neutral'>import {Staking, Deposit, StakingDefinition, StakingDefinitionCreate, WithdrawFeeState} from &quot;../../../../src/Staking.sol&quot;;</span>
   5 |     | <span class='neutral'>import {IERC20} from &quot;@openzeppelin/contracts/token/ERC20/IERC20.sol&quot;;</span>
   6 |     | <span class='neutral'>import {ERC20} from &quot;@openzeppelin/contracts/token/ERC20/ERC20.sol&quot;;</span>
   7 |     | <span class='neutral'>interface IHevm {</span>
   8 |     | <span class='neutral'>    function prank(address) external;</span>
   9 |     | <span class='neutral'>}</span>
  10 |     | <span class='neutral'></span>
  11 | *r  | <span class='executed'>contract StakingEchidna {</span>
  12 |     | <span class='unexecuted'>    address echidnaUser1 = address(0x10000);</span>
  13 |     | <span class='unexecuted'>    address echidnaUser2 = address(0x20000);</span>
  14 |     | <span class='unexecuted'>    address echidnaUser3 = address(0x30000);</span>
  15 |     | <span class='unexecuted'>    address echidnaUser4 = address(0x40000);</span>
  16 |     | <span class='unexecuted'>    address echidnaUser5 = address(0x50000);</span>
  17 |     | <span class='unexecuted'>    address echidnaUser6 = address(0x60000);</span>
  18 |     | <span class='unexecuted'>    address echidnaUser7 = address(0x70000);</span>
  19 |     | <span class='unexecuted'>    address echidnaUser8 = address(0x80000);</span>
  20 |     | <span class='unexecuted'>    address echidnaUser9 = address(0x90000);</span>
  21 |     | <span class='unexecuted'>    address echidnaUser10 = address(0x11000);</span>
  22 |     | <span class='neutral'></span>
  23 |     | <span class='neutral'>    address[] private senders;</span>
  24 |     | <span class='neutral'></span>
  25 |     | <span class='unexecuted'>    address internal treasury = address(0x44000);</span>
  26 |     | <span class='neutral'></span>
  27 |     | <span class='unexecuted'>    address constant HEVM_ADDRESS = 0x7109709ECfa91a80626fF3989D68f67F5b1DD12D;</span>
  28 |     | <span class='unexecuted'>    IHevm hevm = IHevm(HEVM_ADDRESS);</span>
  29 |     | <span class='neutral'></span>
  30 | *   | <span class='executed'>    Staking public staking;</span>
  31 | *   | <span class='executed'>    IERC20 public token;</span>
  32 |     | <span class='neutral'></span>
  33 |     | <span class='unexecuted'>    bool private pass = true;</span>
  34 |     | <span class='unexecuted'>    uint private createdAt = block.timestamp;</span>
  35 |     | <span class='neutral'></span>
  36 |     | <span class='unexecuted'>    uint256 initialBlockTime = block.timestamp;</span>
  37 |     | <span class='neutral'></span>
  38 |     | <span class='neutral'>    uint256 totalRewardLocalCalculation;</span>
  39 |     | <span class='neutral'></span>
  40 |     | <span class='neutral'>    event TestProggres(</span>
  41 |     | <span class='neutral'>        string msg,</span>
  42 |     | <span class='neutral'>        uint256 amount</span>
  43 |     | <span class='neutral'>    );</span>
  44 |     | <span class='neutral'>    event TestProggres(</span>
  45 |     | <span class='neutral'>        string msg,</span>
  46 |     | <span class='neutral'>        address value</span>
  47 |     | <span class='neutral'>    );</span>
  48 |     | <span class='neutral'>    event TestProggres(</span>
  49 |     | <span class='neutral'>        string msg,</span>
  50 |     | <span class='neutral'>        bool value</span>
  51 |     | <span class='neutral'>    );</span>
  52 |     | <span class='neutral'>    event TestProggres(</span>
  53 |     | <span class='neutral'>        string msg,</span>
  54 |     | <span class='neutral'>        string value</span>
  55 |     | <span class='neutral'>    );</span>
  56 |     | <span class='neutral'></span>
  57 |     | <span class='unexecuted'>    constructor() {</span>
  58 |     | <span class='neutral'>        // addresses for staking and token are taken from init.json file. or easier in script folder from latest json transactions, before it is converted ofr echdna init json.</span>
  59 |     | <span class='unexecuted'>        staking = Staking(0x9F89357652B4a314627aC221B7dDC2f0221C5DDE);</span>
  60 |     | <span class='unexecuted'>        token = IERC20(0x22E42989E18Af0C3099d08BF40588B8f314009E2);</span>
  61 |     | <span class='neutral'></span>
  62 |     | <span class='unexecuted'>        senders.push(echidnaUser1);</span>
  63 |     | <span class='unexecuted'>        senders.push(echidnaUser2);</span>
  64 |     | <span class='unexecuted'>        senders.push(echidnaUser3);</span>
  65 |     | <span class='unexecuted'>        senders.push(echidnaUser4);</span>
  66 |     | <span class='unexecuted'>        senders.push(echidnaUser5);</span>
  67 |     | <span class='unexecuted'>        senders.push(echidnaUser6);</span>
  68 |     | <span class='unexecuted'>        senders.push(echidnaUser7);</span>
  69 |     | <span class='unexecuted'>        senders.push(echidnaUser8);</span>
  70 |     | <span class='unexecuted'>        senders.push(echidnaUser9);</span>
  71 |     | <span class='unexecuted'>        senders.push(echidnaUser10);</span>
  72 |     | <span class='neutral'>        </span>
  73 |     | <span class='neutral'>        // token.approve(address(staking), 1_000_000e18);</span>
  74 |     | <span class='neutral'>        // staking.addReward(1_000_000e18);</span>
  75 |     | <span class='neutral'>    }</span>
  76 |     | <span class='neutral'></span>
  77 | *   | <span class='executed'>    function test_staking(uint8 stakingDefinitionId, uint256 _amount) public {</span>
  78 | *   | <span class='executed'>        address sender = msg.sender;</span>
  79 |     | <span class='neutral'></span>
  80 | *r  | <span class='executed'>        require(!staking.isStopped());</span>
  81 | *r  | <span class='executed'>        require(stakingDefinitionId &lt;= staking.totalStakingDefinitions());</span>
  82 | *r  | <span class='executed'>        StakingDefinition memory stakingDefinition = staking.getStakingDefinition(stakingDefinitionId);</span>
  83 | *r  | <span class='executed'>        require(stakingDefinition.enabled);</span>
  84 |     | <span class='neutral'></span>
  85 | *   | <span class='executed'>        emit TestProggres(&quot;sender&quot;, sender);</span>
  86 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.name&quot;, stakingDefinition.name);</span>
  87 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinitionId&quot;, stakingDefinitionId);</span>
  88 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.uniqueIdentifier&quot;, stakingDefinition.uniqueIdentifier);</span>
  89 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.rate&quot;, stakingDefinition.rate);</span>
  90 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.lockDuration&quot;, stakingDefinition.lockDuration);</span>
  91 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.withdrawFeePercentage&quot;, stakingDefinition.withdrawFeePercentage);</span>
  92 |     | <span class='neutral'></span>
  93 | *   | <span class='executed'>        uint256 tokenBalance = token.balanceOf(sender);</span>
  94 | *r  | <span class='executed'>        require(_amount &lt;= tokenBalance);</span>
  95 | *r  | <span class='executed'>        require(_amount &gt; 0);</span>
  96 |     | <span class='neutral'></span>
  97 | *   | <span class='executed'>        hevm.prank(sender);</span>
  98 | *   | <span class='executed'>        token.approve(address(staking), _amount);</span>
  99 |     | <span class='neutral'></span>
 100 | *   | <span class='executed'>        Deposit memory depositSenderBefore = staking.getUserDeposit(stakingDefinitionId, sender);</span>
 101 | *   | <span class='executed'>        emit TestProggres(&quot;depositSenderBefore.depositTime&quot;, depositSenderBefore.depositTime);</span>
 102 | *   | <span class='executed'>        emit TestProggres(&quot;depositSenderBefore.endTime&quot;, depositSenderBefore.endTime);</span>
 103 | *   | <span class='executed'>        emit TestProggres(&quot;depositSenderBefore.depositAmount&quot;, depositSenderBefore.depositAmount);</span>
 104 | *   | <span class='executed'>        emit TestProggres(&quot;depositSenderBefore.status&quot;, depositSenderBefore.status);</span>
 105 |     | <span class='neutral'></span>
 106 | *   | <span class='executed'>        if(depositSenderBefore.status == staking.DEPOSIT_STATUS_NOT_STAKING()) {</span>
 107 | *   | <span class='executed'>            assert(depositSenderBefore.depositAmount == 0);</span>
 108 | *   | <span class='executed'>        } else if(depositSenderBefore.status == staking.DEPOSIT_STATUS_STAKING()) {</span>
 109 | *   | <span class='executed'>            assert(depositSenderBefore.depositAmount &gt; 0);</span>
 110 | *   | <span class='executed'>        } else if(depositSenderBefore.status == staking.DEPOSIT_STATUS_STAKING_WITHDRAWN()) {</span>
 111 | *   | <span class='executed'>            assert(depositSenderBefore.depositAmount &gt; 0);</span>
 112 |     | <span class='neutral'>        }</span>
 113 |     | <span class='neutral'></span>
 114 | *   | <span class='executed'>        (, uint256 currentRewards) =staking.calculateRewards(stakingDefinitionId, sender);</span>
 115 |     | <span class='neutral'></span>
 116 | *   | <span class='executed'>        hevm.prank(sender);</span>
 117 | *r  | <span class='executed'>        staking.stake(stakingDefinitionId, _amount);</span>
 118 |     | <span class='neutral'></span>
 119 | *   | <span class='executed'>        totalRewardLocalCalculation += currentRewards;</span>
 120 |     | <span class='neutral'></span>
 121 | *   | <span class='executed'>        Deposit memory depositSenderAfter = staking.getUserDeposit(stakingDefinitionId, sender);</span>
 122 | *   | <span class='executed'>        emit TestProggres(&quot;block.timestamp&quot;, block.timestamp);</span>
 123 | *   | <span class='executed'>        emit TestProggres(&quot;depositSenderAfter.depositTime&quot;, depositSenderAfter.depositTime);</span>
 124 | *   | <span class='executed'>        emit TestProggres(&quot;depositSenderAfter.endTime&quot;, depositSenderAfter.endTime);</span>
 125 | *   | <span class='executed'>        emit TestProggres(&quot;depositSenderAfter.depositAmount&quot;, depositSenderAfter.depositAmount);</span>
 126 | *   | <span class='executed'>        emit TestProggres(&quot;depositSenderAfter.status&quot;, depositSenderAfter.status);</span>
 127 |     | <span class='neutral'>        </span>
 128 | *   | <span class='executed'>        if(depositSenderBefore.status == staking.DEPOSIT_STATUS_NOT_STAKING() || depositSenderBefore.status == staking.DEPOSIT_STATUS_STAKING_WITHDRAWN()) {</span>
 129 | *   | <span class='executed'>            emit TestProggres(&quot;checking&quot;, &quot;assert(depositSenderAfter.depositAmount == _amount)&quot;);</span>
 130 | *   | <span class='executed'>            assert(depositSenderAfter.depositAmount == _amount);</span>
 131 |     | <span class='neutral'>        } else {</span>
 132 | *   | <span class='executed'>            emit TestProggres(&quot;checking&quot;, &quot;assert(depositSenderBefore.depositAmount + _amount + currentRewards == depositSenderAfter.depositAmount);&quot;);</span>
 133 | *   | <span class='executed'>            assert(depositSenderBefore.depositAmount + _amount + currentRewards == depositSenderAfter.depositAmount);</span>
 134 |     | <span class='neutral'>        }</span>
 135 | *   | <span class='executed'>        emit TestProggres(&quot;checking&quot;, &quot;assert(depositSenderAfter.status == staking.DEPOSIT_STATUS_STAKING());&quot;);</span>
 136 | *   | <span class='executed'>        assert(depositSenderAfter.status == staking.DEPOSIT_STATUS_STAKING());</span>
 137 |     | <span class='neutral'></span>
 138 | *   | <span class='executed'>        uint256 totalDeposits = calculateTotalDeposits();</span>
 139 |     | <span class='neutral'></span>
 140 | *   | <span class='executed'>        emit TestProggres(&quot;totalDeposits&quot;, totalDeposits);</span>
 141 | *   | <span class='executed'>        emit TestProggres(&quot;stakedBalance&quot;, staking.stakedBalance());</span>
 142 |     | <span class='neutral'></span>
 143 | *   | <span class='executed'>        assert(staking.stakedBalance() == totalDeposits);</span>
 144 |     | <span class='neutral'>    }</span>
 145 |     | <span class='neutral'></span>
 146 | *   | <span class='executed'>    function test_early_withdraw(uint8 stakingDefinitionId) public {</span>
 147 | *   | <span class='executed'>        address sender = msg.sender;</span>
 148 |     | <span class='neutral'></span>
 149 | *r  | <span class='executed'>        require(stakingDefinitionId &lt;= staking.totalStakingDefinitions());</span>
 150 | *r  | <span class='executed'>        StakingDefinition memory stakingDefinition = staking.getStakingDefinition(stakingDefinitionId);</span>
 151 | *   | <span class='executed'>        emit TestProggres(&quot;sender&quot;, sender);</span>
 152 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.name&quot;, stakingDefinition.name);</span>
 153 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinitionId&quot;, stakingDefinitionId);</span>
 154 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.uniqueIdentifier&quot;, stakingDefinition.uniqueIdentifier);</span>
 155 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.rate&quot;, stakingDefinition.rate);</span>
 156 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.lockDuration&quot;, stakingDefinition.lockDuration);</span>
 157 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.withdrawFeePercentage&quot;, stakingDefinition.withdrawFeePercentage);</span>
 158 |     | <span class='neutral'></span>
 159 | *r  | <span class='executed'>        require(staking.doesUserHaveActiveStake(stakingDefinitionId, sender));</span>
 160 | *   | <span class='executed'>        Deposit memory depositSender = staking.getUserDeposit(stakingDefinitionId, sender);</span>
 161 |     | <span class='neutral'></span>
 162 | *r  | <span class='executed'>        require(block.timestamp &lt; depositSender.endTime);</span>
 163 | *r  | <span class='executed'>        require(block.timestamp &gt; depositSender.depositTime);</span>
 164 |     | <span class='neutral'>        </span>
 165 | *   | <span class='executed'>        emit TestProggres(&quot;block.timestamp&quot;, block.timestamp);</span>
 166 | *   | <span class='executed'>        emit TestProggres(&quot;depositSender.depositTime&quot;, depositSender.depositTime);</span>
 167 | *   | <span class='executed'>        emit TestProggres(&quot;depositSender.endTime&quot;, depositSender.endTime);</span>
 168 | *   | <span class='executed'>        emit TestProggres(&quot;depositSender.depositAmount&quot;, depositSender.depositAmount);</span>
 169 |     | <span class='neutral'></span>
 170 | *   | <span class='executed'>        uint256 balanceBefore = token.balanceOf(sender);</span>
 171 | *   | <span class='executed'>        uint256 balanceBeforeTreasury = token.balanceOf(treasury);</span>
 172 |     | <span class='neutral'></span>
 173 | *   | <span class='executed'>        emit TestProggres(&quot;balanceBefore&quot;, balanceBefore);</span>
 174 | *   | <span class='executed'>        emit TestProggres(&quot;balanceBeforeTreasury&quot;, balanceBeforeTreasury);</span>
 175 |     | <span class='neutral'></span>
 176 | *   | <span class='executed'>        WithdrawFeeState memory withdrawFeeState = staking.withdrawFeePercentageState(stakingDefinition.uniqueIdentifier, sender);</span>
 177 | *   | <span class='executed'>        emit TestProggres(&quot;withdrawFeeState.stakingDefinitionId&quot;, withdrawFeeState.stakingDefinitionId);</span>
 178 | *   | <span class='executed'>        emit TestProggres(&quot;withdrawFeeState.globalFee&quot;, withdrawFeeState.globalFee);</span>
 179 | *   | <span class='executed'>        emit TestProggres(&quot;withdrawFeeState.globalFeeEnabled&quot;, withdrawFeeState.globalFeeEnabled);</span>
 180 | *   | <span class='executed'>        emit TestProggres(&quot;withdrawFeeState.depositRecordedFee&quot;, withdrawFeeState.depositRecordedFee);</span>
 181 | *   | <span class='executed'>        emit TestProggres(&quot;withdrawFeeState.depositStatus&quot;, withdrawFeeState.depositStatus);</span>
 182 | *   | <span class='executed'>        emit TestProggres(&quot;withdrawFeeState.withdrawFeeUsed&quot;, withdrawFeeState.withdrawFeeUsed);</span>
 183 | *   | <span class='executed'>        if(withdrawFeeState.globalFeeEnabled) {</span>
 184 | *   | <span class='executed'>            assert(withdrawFeeState.withdrawFeeUsed == withdrawFeeState.globalFee);</span>
 185 | *   | <span class='executed'>        } else if(depositSender.depositTime &gt; stakingDefinition.withdrawFeeUpdateOn) {</span>
 186 | *   | <span class='executed'>            assert(withdrawFeeState.withdrawFeeUsed == stakingDefinition.withdrawFeePercentage);</span>
 187 |     | <span class='neutral'>        } else {</span>
 188 | *   | <span class='executed'>            assert(withdrawFeeState.withdrawFeeUsed == depositSender.withdrawFeePercentage);</span>
 189 |     | <span class='neutral'>        }</span>
 190 |     | <span class='neutral'></span>
 191 | *   | <span class='executed'>        (uint256 totalRewards, uint256 currentRewards) =staking.calculateRewards(stakingDefinitionId, sender);</span>
 192 | *   | <span class='executed'>        uint256 withdrawFee = staking.calculateWithdrawFee(stakingDefinitionId, sender);</span>
 193 | *   | <span class='executed'>        emit TestProggres(&quot;totalRewards&quot;, totalRewards);</span>
 194 | *   | <span class='executed'>        emit TestProggres(&quot;currentRewards&quot;, currentRewards);</span>
 195 | *   | <span class='executed'>        emit TestProggres(&quot;withdrawFee&quot;, withdrawFee);</span>
 196 |     | <span class='neutral'></span>
 197 | *   | <span class='executed'>        hevm.prank(sender);</span>
 198 | *r  | <span class='executed'>        staking.withdraw(stakingDefinitionId);</span>
 199 |     | <span class='neutral'></span>
 200 | *   | <span class='executed'>        uint256 balanceAfter = token.balanceOf(sender);</span>
 201 | *   | <span class='executed'>        uint256 balanceAfterTreasury = token.balanceOf(treasury);</span>
 202 |     | <span class='neutral'></span>
 203 | *   | <span class='executed'>        emit TestProggres(&quot;balanceAfter&quot;, balanceAfter);</span>
 204 | *   | <span class='executed'>        emit TestProggres(&quot;balanceAfterTreasury&quot;, balanceAfterTreasury);</span>
 205 |     | <span class='neutral'></span>
 206 | *   | <span class='executed'>        emit TestProggres(&quot;balanceAfter - balanceBefore&quot;, balanceAfter - balanceBefore);</span>
 207 | *   | <span class='executed'>        emit TestProggres(&quot;depositSender.depositAmount + currentRewards - withdrawFee&quot;, depositSender.depositAmount + currentRewards - withdrawFee);</span>
 208 | *   | <span class='executed'>        emit TestProggres(&quot;balanceAfterTreasury - balanceBeforeTreasury&quot;, balanceAfterTreasury - balanceBeforeTreasury);</span>
 209 |     | <span class='neutral'></span>
 210 | *   | <span class='executed'>        assert(balanceAfter &gt;= balanceBefore);</span>
 211 | *   | <span class='executed'>        assert(balanceAfter - balanceBefore == depositSender.depositAmount + currentRewards - withdrawFee);</span>
 212 | *   | <span class='executed'>        if(withdrawFee &gt; 0) {</span>
 213 | *   | <span class='executed'>            assert(balanceAfterTreasury &gt; balanceBeforeTreasury);</span>
 214 |     | <span class='neutral'>        } else {</span>
 215 | *   | <span class='executed'>            assert(balanceAfterTreasury == balanceBeforeTreasury);</span>
 216 |     | <span class='neutral'>        }</span>
 217 | *   | <span class='executed'>        assert(balanceAfterTreasury - balanceBeforeTreasury == withdrawFee);</span>
 218 |     | <span class='neutral'></span>
 219 | *   | <span class='executed'>        Deposit memory depositSenderAfter = staking.getUserDeposit(stakingDefinitionId, sender);</span>
 220 | *   | <span class='executed'>        assert(depositSenderAfter.status == staking.DEPOSIT_STATUS_STAKING_WITHDRAWN());</span>
 221 |     | <span class='neutral'></span>
 222 | *   | <span class='executed'>        uint256 totalDeposits = calculateTotalDeposits();</span>
 223 |     | <span class='neutral'></span>
 224 | *   | <span class='executed'>        emit TestProggres(&quot;totalDeposits&quot;, totalDeposits);</span>
 225 | *   | <span class='executed'>        emit TestProggres(&quot;stakedBalance&quot;, staking.stakedBalance());</span>
 226 |     | <span class='neutral'></span>
 227 | *   | <span class='executed'>        assert(staking.stakedBalance() == totalDeposits);</span>
 228 |     | <span class='neutral'>    }</span>
 229 |     | <span class='neutral'></span>
 230 | *   | <span class='executed'>    function test_matured_withdraw(uint8 stakingDefinitionId) public {</span>
 231 | *   | <span class='executed'>        address sender = msg.sender;</span>
 232 |     | <span class='neutral'></span>
 233 | *r  | <span class='executed'>        require(stakingDefinitionId &lt;= staking.totalStakingDefinitions());</span>
 234 | *   | <span class='executed'>        emit TestProggres(&quot;sender&quot;, sender);</span>
 235 |     | <span class='neutral'></span>
 236 | *r  | <span class='executed'>        StakingDefinition memory stakingDefinition = staking.getStakingDefinition(stakingDefinitionId);</span>
 237 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.name&quot;, stakingDefinition.name);</span>
 238 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinitionId&quot;, stakingDefinitionId);</span>
 239 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.uniqueIdentifier&quot;, stakingDefinition.uniqueIdentifier);</span>
 240 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.rate&quot;, stakingDefinition.rate);</span>
 241 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.lockDuration&quot;, stakingDefinition.lockDuration);</span>
 242 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.withdrawFeePercentage&quot;, stakingDefinition.withdrawFeePercentage);</span>
 243 |     | <span class='neutral'></span>
 244 | *r  | <span class='executed'>        require(staking.doesUserHaveActiveStake(stakingDefinitionId, sender));</span>
 245 | *   | <span class='executed'>        Deposit memory depositSender = staking.getUserDeposit(stakingDefinitionId, sender);</span>
 246 |     | <span class='neutral'></span>
 247 | *r  | <span class='executed'>        require(block.timestamp &gt; depositSender.endTime);</span>
 248 |     | <span class='neutral'>        </span>
 249 | *   | <span class='executed'>        emit TestProggres(&quot;block.timestamp&quot;, block.timestamp);</span>
 250 | *   | <span class='executed'>        emit TestProggres(&quot;depositSender.depositTime&quot;, depositSender.depositTime);</span>
 251 | *   | <span class='executed'>        emit TestProggres(&quot;depositSender.endTime&quot;, depositSender.endTime);</span>
 252 | *   | <span class='executed'>        emit TestProggres(&quot;depositSender.depositAmount&quot;, depositSender.depositAmount);</span>
 253 |     | <span class='neutral'></span>
 254 | *   | <span class='executed'>        uint256 balanceBefore = token.balanceOf(sender);</span>
 255 | *   | <span class='executed'>        uint256 balanceBeforeTreasury = token.balanceOf(treasury);</span>
 256 |     | <span class='neutral'></span>
 257 | *   | <span class='executed'>        emit TestProggres(&quot;balanceBefore&quot;, balanceBefore);</span>
 258 | *   | <span class='executed'>        emit TestProggres(&quot;balanceBeforeTreasury&quot;, balanceBeforeTreasury);</span>
 259 |     | <span class='neutral'></span>
 260 | *   | <span class='executed'>        WithdrawFeeState memory withdrawFeeState = staking.withdrawFeePercentageState(stakingDefinition.uniqueIdentifier, sender);</span>
 261 | *   | <span class='executed'>        emit TestProggres(&quot;withdrawFeeState.stakingDefinitionId&quot;, withdrawFeeState.stakingDefinitionId);</span>
 262 | *   | <span class='executed'>        emit TestProggres(&quot;withdrawFeeState.globalFee&quot;, withdrawFeeState.globalFee);</span>
 263 | *   | <span class='executed'>        emit TestProggres(&quot;withdrawFeeState.globalFeeEnabled&quot;, withdrawFeeState.globalFeeEnabled);</span>
 264 | *   | <span class='executed'>        emit TestProggres(&quot;withdrawFeeState.depositRecordedFee&quot;, withdrawFeeState.depositRecordedFee);</span>
 265 | *   | <span class='executed'>        emit TestProggres(&quot;withdrawFeeState.depositStatus&quot;, withdrawFeeState.depositStatus);</span>
 266 | *   | <span class='executed'>        emit TestProggres(&quot;withdrawFeeState.withdrawFeeUsed&quot;, withdrawFeeState.withdrawFeeUsed);</span>
 267 | *   | <span class='executed'>        if(withdrawFeeState.globalFeeEnabled) {</span>
 268 | *   | <span class='executed'>            assert(withdrawFeeState.withdrawFeeUsed == withdrawFeeState.globalFee);</span>
 269 | *   | <span class='executed'>        } else if(depositSender.depositTime &gt; stakingDefinition.withdrawFeeUpdateOn) {</span>
 270 | *   | <span class='executed'>            assert(withdrawFeeState.withdrawFeeUsed == stakingDefinition.withdrawFeePercentage);</span>
 271 |     | <span class='neutral'>        } else {</span>
 272 | *   | <span class='executed'>            assert(withdrawFeeState.withdrawFeeUsed == depositSender.withdrawFeePercentage);</span>
 273 |     | <span class='neutral'>        }</span>
 274 |     | <span class='neutral'></span>
 275 | *   | <span class='executed'>        (uint256 totalRewards, uint256 currentRewards) =staking.calculateRewards(stakingDefinitionId, sender);</span>
 276 | *   | <span class='executed'>        uint256 withdrawFee = staking.calculateWithdrawFee(stakingDefinitionId, sender);</span>
 277 | *   | <span class='executed'>        emit TestProggres(&quot;totalRewards&quot;, totalRewards);</span>
 278 | *   | <span class='executed'>        emit TestProggres(&quot;currentRewards&quot;, currentRewards);</span>
 279 | *   | <span class='executed'>        emit TestProggres(&quot;withdrawFee&quot;, withdrawFee);</span>
 280 | *   | <span class='executed'>        assert(withdrawFee == 0);</span>
 281 | *   | <span class='executed'>        assert(currentRewards == totalRewards);</span>
 282 |     | <span class='neutral'></span>
 283 | *   | <span class='executed'>        uint256 totalParticipantsBefore = staking.totalActiveStakings();</span>
 284 | *   | <span class='executed'>        emit TestProggres(&quot;totalParticipantsBefore&quot;, totalParticipantsBefore);</span>
 285 | *   | <span class='executed'>        assert(totalParticipantsBefore &gt; 0);</span>
 286 |     | <span class='neutral'></span>
 287 | *   | <span class='executed'>        hevm.prank(sender);</span>
 288 | *r  | <span class='executed'>        staking.withdraw(stakingDefinitionId);</span>
 289 |     | <span class='neutral'></span>
 290 | *   | <span class='executed'>        uint256 balanceAfter = token.balanceOf(sender);</span>
 291 | *   | <span class='executed'>        uint256 balanceAfterTreasury = token.balanceOf(treasury);</span>
 292 |     | <span class='neutral'></span>
 293 | *   | <span class='executed'>        emit TestProggres(&quot;balanceAfter&quot;, balanceAfter);</span>
 294 | *   | <span class='executed'>        emit TestProggres(&quot;balanceAfterTreasury&quot;, balanceAfterTreasury);</span>
 295 |     | <span class='neutral'></span>
 296 | *   | <span class='executed'>        emit TestProggres(&quot;balanceAfter - balanceBefore&quot;, balanceAfter - balanceBefore);</span>
 297 | *   | <span class='executed'>        emit TestProggres(&quot;depositSender.depositAmount + currentRewards - withdrawFee&quot;, depositSender.depositAmount + currentRewards - withdrawFee);</span>
 298 | *   | <span class='executed'>        emit TestProggres(&quot;balanceAfterTreasury - balanceBeforeTreasury&quot;, balanceAfterTreasury - balanceBeforeTreasury);</span>
 299 |     | <span class='neutral'></span>
 300 | *   | <span class='executed'>        assert(balanceAfter &gt; balanceBefore);</span>
 301 | *   | <span class='executed'>        assert(balanceAfter - balanceBefore == depositSender.depositAmount + currentRewards - withdrawFee);</span>
 302 | *   | <span class='executed'>        assert(balanceAfterTreasury == balanceBeforeTreasury);</span>
 303 | *   | <span class='executed'>        assert(balanceAfterTreasury - balanceBeforeTreasury == withdrawFee);</span>
 304 |     | <span class='neutral'></span>
 305 | *   | <span class='executed'>        Deposit memory depositSenderAfter = staking.getUserDeposit(stakingDefinitionId, sender);</span>
 306 | *   | <span class='executed'>        assert(depositSenderAfter.status == staking.DEPOSIT_STATUS_STAKING_WITHDRAWN());</span>
 307 |     | <span class='neutral'></span>
 308 | *   | <span class='executed'>        uint256 totalParticipantsAfter = staking.totalActiveStakings();</span>
 309 | *   | <span class='executed'>        emit TestProggres(&quot;totalParticipantsAfter&quot;, totalParticipantsAfter);</span>
 310 | *   | <span class='executed'>        assert(totalParticipantsAfter == totalParticipantsBefore - 1);</span>
 311 |     | <span class='neutral'></span>
 312 | *   | <span class='executed'>        uint256 totalDeposits = calculateTotalDeposits();</span>
 313 | *   | <span class='executed'>        emit TestProggres(&quot;totalDeposits&quot;, totalDeposits);</span>
 314 | *   | <span class='executed'>        emit TestProggres(&quot;stakedBalance&quot;, staking.stakedBalance());</span>
 315 |     | <span class='neutral'></span>
 316 | *   | <span class='executed'>        assert(staking.stakedBalance() == totalDeposits);</span>
 317 |     | <span class='neutral'>    }</span>
 318 |     | <span class='neutral'></span>
 319 | *   | <span class='executed'>    function test_add_reward(uint256 rewardAmount) public {</span>
 320 | *   | <span class='executed'>        uint256 tokenBalance = token.balanceOf(address(this));</span>
 321 | *r  | <span class='executed'>        require(rewardAmount &lt;= tokenBalance);</span>
 322 |     | <span class='neutral'></span>
 323 | *   | <span class='executed'>        (</span>
 324 | *   | <span class='executed'>            uint256 recordedStakingBalanceBefore, </span>
 325 | *   | <span class='executed'>            uint256 recordedRewardBalanceBefore,</span>
 326 | *   | <span class='executed'>            uint256 actualTokenBalanceBefore</span>
 327 | *   | <span class='executed'>        ) = staking.getContractState();</span>
 328 |     | <span class='neutral'></span>
 329 | *   | <span class='executed'>        emit TestProggres(&quot;recordedStakingBalanceBefore&quot;, recordedStakingBalanceBefore);</span>
 330 | *   | <span class='executed'>        emit TestProggres(&quot;recordedRewardBalanceBefore&quot;, recordedRewardBalanceBefore);</span>
 331 | *   | <span class='executed'>        emit TestProggres(&quot;actualTokenBalanceBefore&quot;, actualTokenBalanceBefore);</span>
 332 |     | <span class='neutral'></span>
 333 | *   | <span class='executed'>        token.approve(address(staking), rewardAmount);</span>
 334 | *r  | <span class='executed'>        staking.addReward(rewardAmount);</span>
 335 | *   | <span class='executed'>        (</span>
 336 | *   | <span class='executed'>            uint256 recordedStakingBalanceAfter, </span>
 337 | *   | <span class='executed'>            uint256 recordedRewardBalanceAfter,</span>
 338 | *   | <span class='executed'>            uint256 actualTokenBalanceAfter</span>
 339 | *   | <span class='executed'>        ) = staking.getContractState();</span>
 340 |     | <span class='neutral'></span>
 341 | *   | <span class='executed'>        emit TestProggres(&quot;recordedStakingBalanceAfter&quot;, recordedStakingBalanceAfter);</span>
 342 | *   | <span class='executed'>        emit TestProggres(&quot;recordedRewardBalanceAfter&quot;, recordedRewardBalanceAfter);</span>
 343 | *   | <span class='executed'>        emit TestProggres(&quot;actualTokenBalanceAfter&quot;, actualTokenBalanceAfter);</span>
 344 |     | <span class='neutral'></span>
 345 | *   | <span class='executed'>        assert(recordedRewardBalanceBefore + rewardAmount == recordedRewardBalanceAfter);</span>
 346 | *   | <span class='executed'>        assert(actualTokenBalanceBefore + rewardAmount == actualTokenBalanceAfter);</span>
 347 | *   | <span class='executed'>        assert(recordedStakingBalanceBefore == recordedStakingBalanceAfter);</span>
 348 |     | <span class='neutral'>    }</span>
 349 |     | <span class='neutral'></span>
 350 | *   | <span class='executed'>    function test_transfer_tokens_to_staking_and_sync(uint256 rewardAmount) public {</span>
 351 | *   | <span class='executed'>        uint256 tokenBalance = token.balanceOf(address(this));</span>
 352 | *r  | <span class='executed'>        require(rewardAmount &lt;= tokenBalance);</span>
 353 | *r  | <span class='executed'>        require(rewardAmount &gt; 0);</span>
 354 |     | <span class='neutral'></span>
 355 | *   | <span class='executed'>        (</span>
 356 | *   | <span class='executed'>            uint256 recordedStakingBalanceBefore, </span>
 357 | *   | <span class='executed'>            uint256 recordedRewardBalanceBefore,</span>
 358 | *   | <span class='executed'>            uint256 actualTokenBalanceBefore</span>
 359 | *   | <span class='executed'>        ) = staking.getContractState();</span>
 360 |     | <span class='neutral'></span>
 361 | *   | <span class='executed'>        emit TestProggres(&quot;recordedStakingBalanceBefore&quot;, recordedStakingBalanceBefore);</span>
 362 | *   | <span class='executed'>        emit TestProggres(&quot;recordedRewardBalanceBefore&quot;, recordedRewardBalanceBefore);</span>
 363 | *   | <span class='executed'>        emit TestProggres(&quot;actualTokenBalanceBefore&quot;, actualTokenBalanceBefore);</span>
 364 | *   | <span class='executed'>        emit TestProggres(&quot;XXXX =&gt; totalRewardLocalCalculation&quot;, totalRewardLocalCalculation);</span>
 365 |     | <span class='neutral'>        </span>
 366 | *   | <span class='executed'>        assert(recordedStakingBalanceBefore - totalRewardLocalCalculation == actualTokenBalanceBefore - recordedRewardBalanceBefore);</span>
 367 |     | <span class='neutral'></span>
 368 | *   | <span class='executed'>        token.transfer(address(staking), rewardAmount);</span>
 369 | *   | <span class='executed'>        (</span>
 370 | *   | <span class='executed'>            uint256 recordedStakingBalanceAfterTransfer, </span>
 371 | *   | <span class='executed'>            uint256 recordedRewardBalanceAfterTransfer,</span>
 372 | *   | <span class='executed'>            uint256 actualTokenBalanceAfterTransfer</span>
 373 | *   | <span class='executed'>        ) = staking.getContractState();</span>
 374 |     | <span class='neutral'></span>
 375 | *   | <span class='executed'>        emit TestProggres(&quot;recordedStakingBalanceAfterTransfer&quot;, recordedStakingBalanceAfterTransfer);</span>
 376 | *   | <span class='executed'>        emit TestProggres(&quot;recordedRewardBalanceAfterTransfer&quot;, recordedRewardBalanceAfterTransfer);</span>
 377 | *   | <span class='executed'>        emit TestProggres(&quot;actualTokenBalanceAfterTransfer&quot;, actualTokenBalanceAfterTransfer);</span>
 378 |     | <span class='neutral'></span>
 379 | *   | <span class='executed'>        assert(recordedRewardBalanceBefore == recordedRewardBalanceAfterTransfer);</span>
 380 | *   | <span class='executed'>        assert(actualTokenBalanceBefore + rewardAmount == actualTokenBalanceAfterTransfer);</span>
 381 | *   | <span class='executed'>        assert(recordedStakingBalanceBefore == recordedStakingBalanceAfterTransfer);</span>
 382 |     | <span class='neutral'></span>
 383 | *r  | <span class='executed'>        staking.sync();</span>
 384 |     | <span class='neutral'></span>
 385 | *   | <span class='executed'>        (</span>
 386 | *   | <span class='executed'>            uint256 recordedStakingBalanceAfterSync, </span>
 387 | *   | <span class='executed'>            uint256 recordedRewardBalanceAfterSync,</span>
 388 | *   | <span class='executed'>            uint256 actualTokenBalanceAfterSync</span>
 389 | *   | <span class='executed'>        ) = staking.getContractState();</span>
 390 |     | <span class='neutral'></span>
 391 | *   | <span class='executed'>        emit TestProggres(&quot;recordedStakingBalanceAfterSync&quot;, recordedStakingBalanceAfterSync);</span>
 392 | *   | <span class='executed'>        emit TestProggres(&quot;recordedRewardBalanceAfterSync&quot;, recordedRewardBalanceAfterSync);</span>
 393 | *   | <span class='executed'>        emit TestProggres(&quot;actualTokenBalanceAfterSync&quot;, actualTokenBalanceAfterSync);</span>
 394 | *   | <span class='executed'>        emit TestProggres(&quot;rewardAmount&quot;, rewardAmount);</span>
 395 |     | <span class='neutral'></span>
 396 | *   | <span class='executed'>        assert(actualTokenBalanceAfterTransfer == actualTokenBalanceAfterSync);</span>
 397 | *   | <span class='executed'>        assert(recordedStakingBalanceAfterTransfer == recordedStakingBalanceAfterSync);</span>
 398 | *   | <span class='executed'>        assert(actualTokenBalanceAfterTransfer - recordedStakingBalanceAfterTransfer == recordedRewardBalanceAfterSync);</span>
 399 | *   | <span class='executed'>        assert(recordedRewardBalanceAfterSync &gt;= recordedRewardBalanceAfterTransfer);</span>
 400 | *   | <span class='executed'>        assert(actualTokenBalanceAfterTransfer == recordedRewardBalanceAfterSync + recordedStakingBalanceAfterSync);</span>
 401 |     | <span class='neutral'></span>
 402 |     | <span class='neutral'>        // totalRewardLocalCalculation needs to be calculated, as that is total amount added to stakingBalance but without transfering tokens,</span>
 403 |     | <span class='neutral'>        // this happens on adding new staking and you have existing one, then currentRewards are included as well in new amount.</span>
 404 | *   | <span class='executed'>        assert(actualTokenBalanceAfterTransfer == (recordedRewardBalanceAfterTransfer + rewardAmount + recordedStakingBalanceAfterSync) - totalRewardLocalCalculation);</span>
 405 |     | <span class='neutral'>        </span>
 406 |     | <span class='neutral'>        // now we reset extra reward amount as it is setteld with sync</span>
 407 | *   | <span class='executed'>        totalRewardLocalCalculation = 0; </span>
 408 |     | <span class='neutral'>    }</span>
 409 |     | <span class='neutral'></span>
 410 | *   | <span class='executed'>    function test_setGlobalWithdrawFeeForStakingDefinition(uint8 stakingDefinitionId, uint8 withdrawFee) public {</span>
 411 | *r  | <span class='executed'>        require(stakingDefinitionId &lt;= staking.totalStakingDefinitions());</span>
 412 | *r  | <span class='executed'>        require(withdrawFee &lt;= 100);</span>
 413 |     | <span class='neutral'></span>
 414 | *r  | <span class='executed'>        StakingDefinition memory stakingDefinition = staking.getStakingDefinition(stakingDefinitionId);</span>
 415 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.name&quot;, stakingDefinition.name);</span>
 416 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinitionId&quot;, stakingDefinitionId);</span>
 417 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.uniqueIdentifier&quot;, stakingDefinition.uniqueIdentifier);</span>
 418 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.rate&quot;, stakingDefinition.rate);</span>
 419 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.lockDuration&quot;, stakingDefinition.lockDuration);</span>
 420 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.withdrawFeePercentage&quot;, stakingDefinition.withdrawFeePercentage);</span>
 421 |     | <span class='neutral'>        </span>
 422 |     | <span class='neutral'></span>
 423 | *   | <span class='executed'>        staking.setGlobalWithdrawFeeForStakingDefinition(stakingDefinition.uniqueIdentifier, withdrawFee);</span>
 424 |     | <span class='neutral'>    }</span>
 425 |     | <span class='neutral'></span>
 426 | *   | <span class='executed'>    function test_removeGlobalWithdrawFeeForStakingDefinition(uint8 stakingDefinitionId) public {</span>
 427 | *r  | <span class='executed'>        require(stakingDefinitionId &lt;= staking.totalStakingDefinitions());</span>
 428 |     | <span class='neutral'></span>
 429 | *r  | <span class='executed'>        StakingDefinition memory stakingDefinition = staking.getStakingDefinition(stakingDefinitionId);</span>
 430 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.name&quot;, stakingDefinition.name);</span>
 431 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinitionId&quot;, stakingDefinitionId);</span>
 432 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.uniqueIdentifier&quot;, stakingDefinition.uniqueIdentifier);</span>
 433 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.rate&quot;, stakingDefinition.rate);</span>
 434 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.lockDuration&quot;, stakingDefinition.lockDuration);</span>
 435 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.withdrawFeePercentage&quot;, stakingDefinition.withdrawFeePercentage);</span>
 436 |     | <span class='neutral'>        </span>
 437 |     | <span class='neutral'></span>
 438 | *   | <span class='executed'>        staking.removeGlobalWithdrawFeeForStakingDefinition(stakingDefinition.uniqueIdentifier);</span>
 439 |     | <span class='neutral'>    }</span>
 440 |     | <span class='neutral'></span>
 441 | *   | <span class='executed'>    function test_setWithdrawFee(uint8 stakingDefinitionId, uint8 withdrawFee) public {</span>
 442 | *r  | <span class='executed'>        require(stakingDefinitionId &lt;= staking.totalStakingDefinitions());</span>
 443 | *r  | <span class='executed'>        require(withdrawFee &lt;= 100);</span>
 444 |     | <span class='neutral'></span>
 445 | *r  | <span class='executed'>        StakingDefinition memory stakingDefinition = staking.getStakingDefinition(stakingDefinitionId);</span>
 446 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.name&quot;, stakingDefinition.name);</span>
 447 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinitionId&quot;, stakingDefinitionId);</span>
 448 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.uniqueIdentifier&quot;, stakingDefinition.uniqueIdentifier);</span>
 449 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.rate&quot;, stakingDefinition.rate);</span>
 450 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.lockDuration&quot;, stakingDefinition.lockDuration);</span>
 451 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.withdrawFeePercentage&quot;, stakingDefinition.withdrawFeePercentage);</span>
 452 |     | <span class='neutral'>        </span>
 453 |     | <span class='neutral'></span>
 454 | *   | <span class='executed'>        staking.setWithdrawFee(stakingDefinition.uniqueIdentifier, withdrawFee);</span>
 455 |     | <span class='neutral'>    }</span>
 456 |     | <span class='neutral'></span>
 457 | *   | <span class='executed'>    function test_enableStakingDefinition(uint8 stakingDefinitionId) public {</span>
 458 | *r  | <span class='executed'>        require(stakingDefinitionId &lt;= staking.totalStakingDefinitions());</span>
 459 |     | <span class='neutral'></span>
 460 | *r  | <span class='executed'>        StakingDefinition memory stakingDefinition = staking.getStakingDefinition(stakingDefinitionId);</span>
 461 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.name&quot;, stakingDefinition.name);</span>
 462 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinitionId&quot;, stakingDefinitionId);</span>
 463 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.uniqueIdentifier&quot;, stakingDefinition.uniqueIdentifier);</span>
 464 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.rate&quot;, stakingDefinition.rate);</span>
 465 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.lockDuration&quot;, stakingDefinition.lockDuration);</span>
 466 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.withdrawFeePercentage&quot;, stakingDefinition.withdrawFeePercentage);</span>
 467 |     | <span class='neutral'>        </span>
 468 | *   | <span class='executed'>        staking.enableStakingDefinition(stakingDefinition.uniqueIdentifier);</span>
 469 |     | <span class='neutral'></span>
 470 | *   | <span class='executed'>        StakingDefinition memory stakingDefinitionAfter = staking.getStakingDefinition(stakingDefinitionId);</span>
 471 | *   | <span class='executed'>        assert(stakingDefinitionAfter.enabled == true);</span>
 472 |     | <span class='neutral'>    }</span>
 473 |     | <span class='neutral'></span>
 474 | *   | <span class='executed'>    function test_setLockDuration(uint8 stakingDefinitionId, uint32 _lockDuration) public {</span>
 475 | *r  | <span class='executed'>        require(stakingDefinitionId &lt;= staking.totalStakingDefinitions());</span>
 476 | *r  | <span class='executed'>        require(_lockDuration &lt;= 9120); // 380 days</span>
 477 |     | <span class='neutral'></span>
 478 | *r  | <span class='executed'>        StakingDefinition memory stakingDefinition = staking.getStakingDefinition(stakingDefinitionId);</span>
 479 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.name&quot;, stakingDefinition.name);</span>
 480 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinitionId&quot;, stakingDefinitionId);</span>
 481 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.uniqueIdentifier&quot;, stakingDefinition.uniqueIdentifier);</span>
 482 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.rate&quot;, stakingDefinition.rate);</span>
 483 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.lockDuration&quot;, stakingDefinition.lockDuration);</span>
 484 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.withdrawFeePercentage&quot;, stakingDefinition.withdrawFeePercentage);</span>
 485 |     | <span class='neutral'>        </span>
 486 | *   | <span class='executed'>        staking.setLockDuration(stakingDefinition.uniqueIdentifier, uint32(_lockDuration * 3600));</span>
 487 |     | <span class='neutral'></span>
 488 | *   | <span class='executed'>        StakingDefinition memory stakingDefinitionAfter = staking.getStakingDefinition(stakingDefinitionId);</span>
 489 |     | <span class='neutral'></span>
 490 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinitionAfter.name&quot;, stakingDefinitionAfter.name);</span>
 491 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinitionId&quot;, stakingDefinitionId);</span>
 492 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinitionAfter.uniqueIdentifier&quot;, stakingDefinitionAfter.uniqueIdentifier);</span>
 493 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinitionAfter.rate&quot;, stakingDefinitionAfter.rate);</span>
 494 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinitionAfter.lockDuration&quot;, stakingDefinitionAfter.lockDuration);</span>
 495 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinitionAfter.withdrawFeePercentage&quot;, stakingDefinitionAfter.withdrawFeePercentage);</span>
 496 |     | <span class='neutral'></span>
 497 | *   | <span class='executed'>        assert(stakingDefinitionAfter.lockDuration == uint32(_lockDuration * 3600));</span>
 498 |     | <span class='neutral'>    }</span>
 499 |     | <span class='neutral'></span>
 500 | *   | <span class='executed'>    function test_setRate(uint8 stakingDefinitionId, uint8 _rate) public {</span>
 501 | *r  | <span class='executed'>        require(stakingDefinitionId &lt;= staking.totalStakingDefinitions());</span>
 502 | *r  | <span class='executed'>        require(_rate &lt;= 200);</span>
 503 |     | <span class='neutral'></span>
 504 | *r  | <span class='executed'>        StakingDefinition memory stakingDefinition = staking.getStakingDefinition(stakingDefinitionId);</span>
 505 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.name&quot;, stakingDefinition.name);</span>
 506 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinitionId&quot;, stakingDefinitionId);</span>
 507 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.uniqueIdentifier&quot;, stakingDefinition.uniqueIdentifier);</span>
 508 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.rate&quot;, stakingDefinition.rate);</span>
 509 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.lockDuration&quot;, stakingDefinition.lockDuration);</span>
 510 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.withdrawFeePercentage&quot;, stakingDefinition.withdrawFeePercentage);</span>
 511 |     | <span class='neutral'>        </span>
 512 | *   | <span class='executed'>        staking.setRate(stakingDefinition.uniqueIdentifier, _rate);</span>
 513 |     | <span class='neutral'></span>
 514 | *   | <span class='executed'>        StakingDefinition memory stakingDefinitionAfter = staking.getStakingDefinition(stakingDefinitionId);</span>
 515 |     | <span class='neutral'></span>
 516 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinitionAfter.name&quot;, stakingDefinitionAfter.name);</span>
 517 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinitionId&quot;, stakingDefinitionId);</span>
 518 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinitionAfter.uniqueIdentifier&quot;, stakingDefinitionAfter.uniqueIdentifier);</span>
 519 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinitionAfter.rate&quot;, stakingDefinitionAfter.rate);</span>
 520 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinitionAfter.lockDuration&quot;, stakingDefinitionAfter.lockDuration);</span>
 521 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinitionAfter.withdrawFeePercentage&quot;, stakingDefinitionAfter.withdrawFeePercentage);</span>
 522 |     | <span class='neutral'></span>
 523 | *   | <span class='executed'>        assert(stakingDefinitionAfter.rate == _rate);</span>
 524 |     | <span class='neutral'>    }</span>
 525 |     | <span class='neutral'></span>
 526 | *   | <span class='executed'>    function test_setRate(bool _isStopped) public {</span>
 527 | *   | <span class='executed'>        emit TestProggres(&quot;isStopped&quot;, staking.isStopped());</span>
 528 | *   | <span class='executed'>        staking.changeIsStoppedStatus(_isStopped);</span>
 529 | *   | <span class='executed'>        emit TestProggres(&quot;isStopped&quot;, staking.isStopped());</span>
 530 |     | <span class='neutral'></span>
 531 | *   | <span class='executed'>        assert(staking.isStopped() == _isStopped);</span>
 532 |     | <span class='neutral'>    }</span>
 533 |     | <span class='neutral'></span>
 534 | *   | <span class='executed'>    function test_disableStakingDefinition(uint8 stakingDefinitionId) public {</span>
 535 | *r  | <span class='executed'>        require(stakingDefinitionId &lt;= staking.totalStakingDefinitions());</span>
 536 |     | <span class='neutral'></span>
 537 | *r  | <span class='executed'>        StakingDefinition memory stakingDefinition = staking.getStakingDefinition(stakingDefinitionId);</span>
 538 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.name&quot;, stakingDefinition.name);</span>
 539 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinitionId&quot;, stakingDefinitionId);</span>
 540 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.uniqueIdentifier&quot;, stakingDefinition.uniqueIdentifier);</span>
 541 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.rate&quot;, stakingDefinition.rate);</span>
 542 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.lockDuration&quot;, stakingDefinition.lockDuration);</span>
 543 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.withdrawFeePercentage&quot;, stakingDefinition.withdrawFeePercentage);</span>
 544 |     | <span class='neutral'>        </span>
 545 | *   | <span class='executed'>        staking.disableStakingDefinition(stakingDefinition.uniqueIdentifier);</span>
 546 |     | <span class='neutral'></span>
 547 | *   | <span class='executed'>        StakingDefinition memory stakingDefinitionAfter = staking.getStakingDefinition(stakingDefinitionId);</span>
 548 | *   | <span class='executed'>        assert(stakingDefinitionAfter.enabled == false);</span>
 549 |     | <span class='neutral'>    }</span>
 550 |     | <span class='neutral'></span>
 551 | *   | <span class='executed'>    function test_addStakingDefinition(uint16 _rate, uint8 _withdrawFeePercentage, uint32 _lockDuration) public {</span>
 552 | *r  | <span class='executed'>        require(_rate &lt;= 200);</span>
 553 | *r  | <span class='executed'>        require(_withdrawFeePercentage &lt;= 100);</span>
 554 | *r  | <span class='executed'>        require(_lockDuration &lt;= 9120); // 380 days</span>
 555 |     | <span class='neutral'></span>
 556 | *   | <span class='executed'>        uint8 newId = staking.totalStakingDefinitions();</span>
 557 | *   | <span class='executed'>        uint16 rate = uint16(_rate);</span>
 558 | *   | <span class='executed'>        string memory name = string(abi.encodePacked(&quot;Test staking &quot;, _lockDuration));</span>
 559 | *   | <span class='executed'>        uint8 withdrawFeePercentage =  uint8(_withdrawFeePercentage);</span>
 560 | *   | <span class='executed'>        uint32 lockDuration =  uint32(_lockDuration * 3600);</span>
 561 |     | <span class='neutral'></span>
 562 | *   | <span class='executed'>        staking.addStakingDefinition(</span>
 563 | *   | <span class='executed'>            StakingDefinitionCreate({</span>
 564 |     | <span class='neutral'>                rate: rate,</span>
 565 |     | <span class='neutral'>                withdrawFeePercentage: withdrawFeePercentage,</span>
 566 |     | <span class='neutral'>                lockDuration: lockDuration,</span>
 567 |     | <span class='neutral'>                name: name</span>
 568 |     | <span class='neutral'>            })</span>
 569 |     | <span class='neutral'>        );</span>
 570 |     | <span class='neutral'></span>
 571 |     | <span class='neutral'></span>
 572 | *   | <span class='executed'>        StakingDefinition memory stakingDefinition = staking.getStakingDefinition(newId);</span>
 573 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.name&quot;, stakingDefinition.name);</span>
 574 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinitionId&quot;, newId);</span>
 575 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.uniqueIdentifier&quot;, stakingDefinition.uniqueIdentifier);</span>
 576 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.rate&quot;, stakingDefinition.rate);</span>
 577 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.lockDuration&quot;, stakingDefinition.lockDuration);</span>
 578 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.withdrawFeePercentage&quot;, stakingDefinition.withdrawFeePercentage); </span>
 579 | *   | <span class='executed'>        emit TestProggres(&quot;stakingDefinition.numberOfActiveStakings&quot;, stakingDefinition.numberOfActiveStakings); </span>
 580 |     | <span class='neutral'></span>
 581 | *   | <span class='executed'>        assert(keccak256(abi.encodePacked(stakingDefinition.name)) == keccak256(abi.encodePacked(name)));</span>
 582 | *   | <span class='executed'>        assert(stakingDefinition.rate == rate);</span>
 583 | *   | <span class='executed'>        assert(stakingDefinition.withdrawFeePercentage == withdrawFeePercentage);</span>
 584 | *   | <span class='executed'>        assert(stakingDefinition.lockDuration == lockDuration);</span>
 585 | *   | <span class='executed'>        assert(stakingDefinition.numberOfActiveStakings == 0);       </span>
 586 |     | <span class='neutral'>    }</span>
 587 |     | <span class='neutral'></span>
 588 | *   | <span class='executed'>    function test_numberOfActiveStakings() public {</span>
 589 | *   | <span class='executed'>        uint256 totalStakingsCalculated;</span>
 590 |     | <span class='neutral'></span>
 591 | *   | <span class='executed'>        for (uint8 stakingDefinitionId = 0; stakingDefinitionId &lt; staking.totalStakingDefinitions(); stakingDefinitionId++) {</span>
 592 | *   | <span class='executed'>            StakingDefinition memory stakingDefinition = staking.getStakingDefinition(stakingDefinitionId);</span>
 593 |     | <span class='neutral'></span>
 594 | *   | <span class='executed'>            emit TestProggres(&quot;stakingDefinition.uniqueIdentifier&quot;, stakingDefinition.uniqueIdentifier);</span>
 595 | *   | <span class='executed'>            emit TestProggres(&quot;stakingDefinition.name&quot;, stakingDefinition.name);</span>
 596 | *   | <span class='executed'>            emit TestProggres(&quot;stakingDefinition.numberOfActiveStakings&quot;, stakingDefinition.numberOfActiveStakings);</span>
 597 |     | <span class='neutral'></span>
 598 | *   | <span class='executed'>            totalStakingsCalculated = totalStakingsCalculated + stakingDefinition.numberOfActiveStakings;</span>
 599 |     | <span class='neutral'>        }</span>
 600 |     | <span class='neutral'></span>
 601 | *   | <span class='executed'>        emit TestProggres(&quot;totalStakingsCalculated&quot;, totalStakingsCalculated);</span>
 602 | *   | <span class='executed'>        emit TestProggres(&quot;totalActiveStakings&quot;, staking.totalActiveStakings());</span>
 603 |     | <span class='neutral'></span>
 604 | *   | <span class='executed'>        assert(totalStakingsCalculated == staking.totalActiveStakings());</span>
 605 |     | <span class='neutral'>    }</span>
 606 |     | <span class='neutral'></span>
 607 | *   | <span class='executed'>    function calculateTotalDeposits() private view returns (uint256) {</span>
 608 | *   | <span class='executed'>        uint256 totalDeposits;</span>
 609 |     | <span class='neutral'></span>
 610 | *   | <span class='executed'>        for (uint8 stakingDefinitionId = 0; stakingDefinitionId &lt; staking.totalStakingDefinitions(); stakingDefinitionId++) {</span>
 611 | *   | <span class='executed'>            for (uint i = 0; i &lt; senders.length; i++) {</span>
 612 | *   | <span class='executed'>                Deposit memory deposit = staking.getUserDeposit(stakingDefinitionId, senders[i]);</span>
 613 | *   | <span class='executed'>                if(deposit.status == staking.DEPOSIT_STATUS_STAKING()) {</span>
 614 | *   | <span class='executed'>                    totalDeposits = totalDeposits + deposit.depositAmount;</span>
 615 |     | <span class='neutral'>                }</span>
 616 |     | <span class='neutral'>            }</span>
 617 |     | <span class='neutral'>        }</span>
 618 |     | <span class='neutral'></span>
 619 | *   | <span class='executed'>        return totalDeposits;</span>
 620 |     | <span class='neutral'>    }</span>
 621 |     | <span class='neutral'>}</span>

</code>
<br />

